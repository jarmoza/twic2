var TWiC=function(t){return t.TopRoundedRect=function(t,e,i,s,o){return"M"+t+","+(e+o)+"a"+o+","+o+" 0 0 1 "+o+","+-o+"h"+(i-2*o)+"a"+o+","+o+" 0 0 1 "+o+","+o+"v"+(s-o)+"h"+-i+"z"},t.BottomRoundedRect=function(t,e,i,s,o){return"M"+t+","+e+"h"+i+"v"+(s-o)+"a"+o+","+o+" 0 0 1 "+-o+","+o+"h"+-(i-2*o)+"a"+o+","+o+" 0 0 1 "+-o+","+-o+"z"},t.LeftRoundedRect=function(t,e,i,s,o){return"M"+(t+o)+","+e+"a"+-o+","+o+" 0 0 0 "+-o+","+o+"v"+(s-2*o)+"a"+o+","+o+" 0 0 0 "+o+","+o+"h"+i+"v"+-s+"z"},t.RightRoundedRect=function(t,e,i,s,o){return"M"+t+","+e+"h"+(i-o)+"a"+o+","+o+" 0 0 1 "+o+","+o+"v"+(s-2*o)+"a"+o+","+o+" 0 0 1 "+-o+","+o+"h"+(o-i)+"z"},t.FullyRoundedRect=function(t,e,i,s,o){return"M"+(t+o)+","+e+"h"+(i-2*o)+"a"+o+","+o+" 0 0 1 "+o+","+o+"v"+(s-2*o)+"a"+-o+","+o+" 0 0 1 "+-o+","+o+"h"+-(i-2*o)+"a"+o+","+o+" 0 0 1 "+-o+","+-o+"v"+-(s-2*o)+"a"+o+","+o+" 0 0 1 "+o+","+-o+"z"},t.Control=function(e,i){this.m_barThickness=e,this.m_orientation=i,this.m_name=t.GetUniqueID(),this.m_coordinates={x:0,y:0},this.m_size={},this.m_div=null,this.m_svg=null,this.m_controlGroup=null,this.m_barPath=null,this.m_barText=null,this.m_nextControlWidgetPos={x:this.m_barThickness>>1,y:.65*this.m_barThickness},this.m_textFirstSet=!1},t.Control.method("GetNextWidgetPos",function(){return this.m_nextControlWidgetPos}),t.Control.method("SetNextWidgetPos",function(t){this.m_nextControlWidgetPos.x=t.x,this.m_nextControlWidgetPos.y=t.y}),t.Control.method("Initialize",function(e){var i=this.GetRectPath();this.m_div=e.append("div").attr("class","div_twic_control").attr("id","div_twic_control_"+this.m_name).style("left",this.m_coordinates.x).style("top",this.m_coordinates.y).style("width",this.m_size.width).style("height",this.m_size.height).style("max-width",this.m_size.width).style("max-height",this.m_size.height).style("background","transparent").style("float","left").style("margin",0),this.m_svg=this.m_div.append("svg").attr("class","svg_twic_control").attr("id","svg_twic_control_"+this.m_name).attr("x",this.m_coordinates.x).attr("y",this.m_coordinates.y).attr("width",this.m_size.width).attr("height",this.m_size.height).attr("viewBox","0 0 "+this.m_size.width+" "+this.m_size.height),this.m_controlGroup=this.m_svg.append("g").attr("class","group_control").attr("id","group_control_"+this.m_name),this.m_barPath=this.m_controlGroup.append("path").attr("d",i).style("opacity",0).attr("fill",t.Level.prototype.s_palette.beige).attr("id","twic_barpath_"+this.m_name),this.AddPanelSizeControls()}),t.Control.method("Update",function(t,e){}),t.Control.method("AddHelp",function(){var e={x:this.m_size.width-50,y:this.m_coordinates.y+10};"M"+this.m_;this.m_helpBox=this.m_controlGroup.append("rect").attr("x",e.x).attr("y",e.y).attr("width",30).attr("height",30).attr("fill",TWiC.Level.prototype.s_palette.darkblue).attr("rx",5).attr("ry",5),this.m_helpBoxText=this.m_controlGroup.append("text").attr("x",e.x).attr("y",e.y).attr("dx",11).attr("dy",23).attr("width",30).attr("height",30).attr("fill",TWiC.Level.prototype.s_palette.lightpurple).attr("rx",5).attr("ry",5).html("?").style("font-family",t.Level.prototype.s_fontFamily).style("font-size",23)}),t.Control.method("AddPanelSizeControls",function(){var e={cx:this.m_nextControlWidgetPos.x+t.Control.prototype.s_sizeControlRadius,cy:this.m_nextControlWidgetPos.y-(t.Control.prototype.s_sizeControlRadius>>1)-(t.Control.prototype.s_sizeControlRadius>>1)};this.m_controlGroup.append("circle").attr("cx",e.cx).attr("cy",e.cy).attr("r",t.Control.prototype.s_sizeControlRadius).attr("fill",t.Level.prototype.s_palette.hide).attr("stroke",t.ShadeBlend(TWiC.DataShape.prototype.s_colorLolight,t.Level.prototype.s_palette.hide)).attr("stroke-width",1),this.m_controlGroup.append("rect").attr("x",e.cx-t.Control.prototype.s_sizeControlRadius-(t.Control.prototype.s_sizeControlRadius>>1)).attr("y",e.cy-t.Control.prototype.s_sizeControlRadius-(t.Control.prototype.s_sizeControlRadius>>1)).attr("width",3*t.Control.prototype.s_sizeControlRadius).attr("height",3*t.Control.prototype.s_sizeControlRadius).style("opacity",0).on(t.Interaction.click,function(){this.m_panel.Hide(!this.m_panel.m_hidden)}.bind(this)).on(t.Interaction.mouseover,function(){this.HighlightPanelSizeControls(!0)}.bind(this)).on(t.Interaction.mouseout,function(){this.HighlightPanelSizeControls(!1)}.bind(this)),this.DrawChevron({x:this.m_nextControlWidgetPos.x+t.Control.prototype.s_sizeControlRadius,y:this.m_nextControlWidgetPos.y-(t.Control.prototype.s_sizeControlRadius>>1)-(t.Control.prototype.s_sizeControlRadius>>1)},"up"),this.DrawChevron({x:this.m_nextControlWidgetPos.x+t.Control.prototype.s_sizeControlRadius,y:this.m_nextControlWidgetPos.y-(t.Control.prototype.s_sizeControlRadius>>1)-(t.Control.prototype.s_sizeControlRadius>>1)},"down"),e={cx:this.m_nextControlWidgetPos.x+4+4*t.Control.prototype.s_sizeControlRadius,cy:this.m_nextControlWidgetPos.y-(t.Control.prototype.s_sizeControlRadius>>1)-(t.Control.prototype.s_sizeControlRadius>>1)},this.m_controlGroup.append("circle").attr("cx",e.cx).attr("cy",e.cy).attr("r",t.Control.prototype.s_sizeControlRadius).attr("fill",t.Level.prototype.s_palette.minimize).attr("stroke",t.ShadeBlend(TWiC.DataShape.prototype.s_colorLolight,t.Level.prototype.s_palette.minimize)).attr("stroke-width",1),this.m_controlGroup.append("rect").attr("x",e.cx-t.Control.prototype.s_sizeControlRadius-(t.Control.prototype.s_sizeControlRadius>>1)).attr("y",e.cy-t.Control.prototype.s_sizeControlRadius-(t.Control.prototype.s_sizeControlRadius>>1)).attr("width",3*t.Control.prototype.s_sizeControlRadius).attr("height",3*t.Control.prototype.s_sizeControlRadius).style("opacity",0).on(t.Interaction.click,function(){this.m_panel.Minimize()}.bind(this)).on(t.Interaction.mouseover,function(){this.HighlightPanelSizeControls(!0)}.bind(this)).on(t.Interaction.mouseout,function(){this.HighlightPanelSizeControls(!1)}.bind(this)),this.DrawMinus({x:this.m_nextControlWidgetPos.x+4+4*t.Control.prototype.s_sizeControlRadius,y:this.m_nextControlWidgetPos.y-(t.Control.prototype.s_sizeControlRadius>>1)-(t.Control.prototype.s_sizeControlRadius>>1)}),e={cx:this.m_nextControlWidgetPos.x+8+7*t.Control.prototype.s_sizeControlRadius,cy:this.m_nextControlWidgetPos.y-(t.Control.prototype.s_sizeControlRadius>>1)-(t.Control.prototype.s_sizeControlRadius>>1)},this.m_controlGroup.append("circle").attr("cx",e.cx).attr("cy",e.cy).attr("r",t.Control.prototype.s_sizeControlRadius).attr("fill",t.Level.prototype.s_palette.maximize).attr("stroke",t.ShadeBlend(TWiC.DataShape.prototype.s_colorLolight,t.Level.prototype.s_palette.maximize)).attr("stroke-width",1),this.m_controlGroup.append("rect").attr("x",e.cx-t.Control.prototype.s_sizeControlRadius-(t.Control.prototype.s_sizeControlRadius>>1)).attr("y",e.cy-t.Control.prototype.s_sizeControlRadius-(t.Control.prototype.s_sizeControlRadius>>1)).attr("width",3*t.Control.prototype.s_sizeControlRadius).attr("height",3*t.Control.prototype.s_sizeControlRadius).style("opacity",0).on(t.Interaction.click,function(){this.m_panel.Maximize()}.bind(this)).on(t.Interaction.mouseover,function(){this.HighlightPanelSizeControls(!0)}.bind(this)).on(t.Interaction.mouseout,function(){this.HighlightPanelSizeControls(!1)}.bind(this)),this.DrawPlus({x:this.m_nextControlWidgetPos.x+8+7*t.Control.prototype.s_sizeControlRadius,y:this.m_nextControlWidgetPos.y-(t.Control.prototype.s_sizeControlRadius>>1)-(t.Control.prototype.s_sizeControlRadius>>1)}),this.SetNextWidgetPos({x:this.m_nextControlWidgetPos.x+8+9*t.Control.prototype.s_sizeControlRadius,y:this.GetNextWidgetPos().y})}),t.Control.method("AddSearch",function(){this.m_searchDiv=this.m_div.append("div").attr("class","control").attr("id","searchbar_"+this.m_panel.m_name).style("position","absolute").style("left",this.m_container.m_size.width-150).style("top",10),this.m_searchForm=this.m_searchDiv.append("form").attr("class","control_form").attr("id","searchform_"+this.m_panel.m_name).attr("action","").attr("method","post"),this.m_searchInput=this.m_searchForm.append("p").attr("class","control_title").append("input").attr("class","control_input").attr("id","searchinput_"+this.m_panel.m_name).attr("type","text").attr("value","")}),t.Control.method("AddText",function(t){t(this)}),t.Control.method("DetermineDimensions",function(){switch(this.m_orientation){case"top":this.m_size={width:this.m_panel.m_size.width,height:this.m_barThickness};break;case"bottom":this.m_size={width:this.m_panel.m_size.width,height:this.m_barThickness};break;case"left":this.m_size={width:this.m_barThickness,height:this.m_panel.m_size.height};break;case"right":this.m_size={width:this.m_barThickness,height:this.m_panel.m_size.height}}}),t.Control.method("DrawChevron",function(e,i){var s=t.Control.prototype.s_sizeControlRadius;switch(i){case"up":this.m_hideHighlightLU=this.m_controlGroup.append("line").attr("x1",e.x-(s>>1)-(s>>3)).attr("y1",e.y+(s>>1)).attr("x2",e.x).attr("y2",e.y-(s>>1)).attr("stroke",t.Level.prototype.s_palette.hide_highlight).attr("stroke-width",2).style("opacity",0),this.m_hideHighlightRU=this.m_controlGroup.append("line").attr("x1",e.x).attr("y1",e.y-(s>>1)).attr("x2",e.x+(s>>1)+(s>>3)).attr("y2",e.y+(s>>1)).attr("stroke",t.Level.prototype.s_palette.hide_highlight).attr("stroke-width",2).style("opacity",0);break;case"down":this.m_hideHighlightLD=this.m_controlGroup.append("line").attr("x1",e.x-(s>>1)-(s>>3)).attr("y1",e.y-(s>>2)).attr("x2",e.x).attr("y2",e.y+(s>>1)+(s>>3)).attr("stroke",t.Level.prototype.s_palette.hide_highlight).attr("stroke-width",2).style("opacity",0),this.m_hideHighlightRD=this.m_controlGroup.append("line").attr("x1",e.x).attr("y1",e.y+(s>>1)+(s>>3)).attr("x2",e.x+(s>>1)+(s>>3)).attr("y2",e.y-(s>>2)).attr("stroke",t.Level.prototype.s_palette.hide_highlight).attr("stroke-width",2).style("opacity",0)}}),t.Control.method("DrawMinus",function(e){var i=t.Control.prototype.s_sizeControlRadius;this.m_minHighlight=this.m_controlGroup.append("line").attr("x1",e.x-(i>>1)-(i>>2)).attr("y1",e.y).attr("x2",e.x+(i>>1)+(i>>2)).attr("y2",e.y).attr("stroke",t.Level.prototype.s_palette.min_highlight).attr("stroke-width",2).style("opacity",0)}),t.Control.method("DrawPlus",function(e){var i=t.Control.prototype.s_sizeControlRadius;this.m_maxHighlightH=this.m_controlGroup.append("line").attr("x1",e.x-(i>>1)-(i>>3)).attr("y1",e.y).attr("x2",e.x+(i>>1)+(i>>3)).attr("y2",e.y).attr("stroke",t.Level.prototype.s_palette.max_highlight).attr("stroke-width",2).style("opacity",0),this.m_maxHighlightV=this.m_controlGroup.append("line").attr("x1",e.x).attr("y1",e.y-(i>>1)-(i>>3)).attr("x2",e.x).attr("y2",e.y+(i>>1)+(i>>3)).attr("stroke",t.Level.prototype.s_palette.max_highlight).attr("stroke-width",2).style("opacity",0)}),t.Control.method("GetRectPath",function(){switch(this.m_orientation){case"top":var e=t.TopRoundedRect(this.m_coordinates.x,this.m_coordinates.y,this.m_size.width,this.m_size.height,t.Control.prototype.s_borderRadius);break;case"bottom":var e=t.BottomRoundedRect(this.m_coordinates.x,this.m_coordinates.y,this.m_size.width,this.m_size.height,t.Control.prototype.s_borderRadius);break;case"left":var e=t.LeftRoundedRect(this.m_coordinates.x,this.m_coordinates.y,this.m_size.width,this.m_size.height,t.Control.prototype.s_borderRadius);break;case"right":var e=t.RightRoundedRect(this.m_coordinates.x,this.m_coordinates.y,this.m_size.width,this.m_size.height,t.Control.prototype.s_borderRadius)}return e}),t.Control.method("HighlightPanelSizeControls",function(t){t?(this.m_panel.m_hidden?(this.m_hideHighlightLD.style("opacity",1),this.m_hideHighlightRD.style("opacity",1),this.m_hideHighlightLU.style("opacity",0),this.m_hideHighlightRU.style("opacity",0)):(this.m_hideHighlightLU.style("opacity",1),this.m_hideHighlightRU.style("opacity",1),this.m_hideHighlightLD.style("opacity",0),this.m_hideHighlightRD.style("opacity",0)),this.m_minHighlight.style("opacity",1),this.m_maxHighlightH.style("opacity",1),this.m_maxHighlightV.style("opacity",1)):(this.m_hideHighlightLD.style("opacity",0),this.m_hideHighlightRD.style("opacity",0),this.m_hideHighlightLU.style("opacity",0),this.m_hideHighlightRU.style("opacity",0),this.m_minHighlight.style("opacity",0),this.m_maxHighlightH.style("opacity",0),this.m_maxHighlightV.style("opacity",0))}),t.Control.method("SetContainer",function(t){this.m_container=t,this.m_panel=this.m_container.m_panel}),t.Control.method("SetPosition",function(t){this.m_coordinates.x=t.x,this.m_coordinates.y=t.y}),t.Control.method("SetSize",function(t){this.m_size.width=t.width,this.m_size.height=t.height}),t.Control.method("UpdateBarPath",function(t){this.m_barPath.attr("d",t)}),t.Control.prototype.s_defaultThickness=50,t.Control.prototype.s_borderRadius=15,t.Control.prototype.s_sizeControlRadius=9,t}(TWiC||{}),TWiC=function(t){return t.DataShape=function(t,e,i,s,o){this.m_coordinates=t,this.m_size=e,this.m_name=i,this.m_level=s,this.m_panel=o},t.DataShape.method("AllowInteractions",function(e){var i=!1;switch(e){case t.Interaction.dblclick:i=this.m_allowDblclick;break;default:i=!0}return i}),t.DataShape.method("Draw",function(t){}),t.DataShape.method("GenerateDataTiles",function(){return null}),t.DataShape.method("Load",function(){}),t.DataShape.method("ReappendShape",function(){this.m_shapeGroup.node().parentNode.parentNode.appendChild(this.m_shapeGroup.node().parentNode)}),t.DataShape.prototype.s_colorHighlight=.5,t.DataShape.prototype.s_colorMidlight=-.25,t.DataShape.prototype.s_colorLolight=-.5,t.DataShape.prototype.s_unhighlightedOpacity=.3,t.DataShape.prototype.s_semihighlightedOpacity=.3,t.TopicBullseye=function(e,i,s,o,a,n,r,l,h,m){t.DataShape.apply(this,arguments),this.m_linkedViews=n,this.m_numberCircles=r,this.m_fullTopicListRef=l,this.m_topTopics=[],this.m_topicProportionSum=0;for(var p=0;p<this.m_numberCircles;p++)this.m_topTopics.push([]);for(p in l){for(var _=0;_<this.m_numberCircles;_++)l[p][0]==_+1&&(this.m_topTopics[_]=[p,l[p][1]]);this.m_topicProportionSum+=l[p][1]}if(this.m_allowDblclick=!0,this.m_radius=this.m_size,this.m_scaledRadius=!1,this.m_shapeGroup=null,this.m_title=h,this.m_shapeChar=t.TopicBullseye.prototype.s_shapeChar,this.m_isCorpusBullseye=m,this.m_isCorpusBullseye){this.m_textCount=0;for(var c=this.m_level.m_corpusInfo.corpus_info[1].length,p=0;c>p;p++)this.m_textCount+=this.m_level.m_corpusMap.children[p].children.length}else this.m_textCount=this.m_level.m_corpusMap.children[parseInt(h)].children.length},t.TopicBullseye.inherits(t.DataShape),t.TopicBullseye.method("AddTextTag",function(e,i,s,o,a,n){var r=void 0===n?this.m_shapeGroup:n;this.m_textTag=r.append("text").attr("class",this.m_panel.s_datashapeTextClassName).attr("dx","0").attr("dy","0").attr("fill",s).style("font-family",t.Level.prototype.s_fontFamily).style("font-size",i).style("position","relative");textFlow(e,this.m_textTag[0][0],this.m_panel.m_svg.attr("width"),i,t.TopicBar.prototype.s_textInfo.yIncrement,!1);this.m_textTag.selectAll("tspan").attr("x",o.x).attr("y",o.y).style("opacity",a)}),t.TopicBullseye.method("Draw",function(e,i){var s=this.m_size;if(this.m_scaledRadius){var o=this.m_isCorpusBullseye?50:this.m_textCount;s=Math.max(this.m_size,this.m_size+o*this.m_level.m_corpusInfo.corpus_info[1][this.m_topTopics[0][0]]),this.m_size=this.m_radius=s}var a=s/this.m_numberCircles;this.m_shapeGroup=e.append("g").attr("class","group_twic_datashape_smoothzooming").attr("id","twic_clustercircle_"+this.m_level.m_objectCount),this.m_level.m_objectCount+=1;for(var n=this.m_numberCircles-1;n>=0;n--){var r={color:this.m_level.m_topicColors[this.m_topTopics[n][0]],topicID:this.m_topTopics[n][0],prop:this.m_topTopics[n][1],texts:i,shapeRef:this};if(1==this.m_numberCircles?r.locolor=this.m_level.m_topicColors[this.m_topTopics[n][0]]:r.locolor=this.m_level.m_topicColorsLoBlend[this.m_topTopics[n][0]],n>0)var l=d3.svg.arc().innerRadius(s-a).outerRadius(s).startAngle(0).endAngle(2*Math.PI),h=this.m_shapeGroup.append("path").attr("d",l).attr("transform","translate("+this.m_coordinates.x.toString()+","+this.m_coordinates.y.toString()+")");else var h=this.m_shapeGroup.append("circle").attr("cx",this.m_coordinates.x).attr("cy",this.m_coordinates.y).attr("r",s);h.datum(r).attr("class",this.m_panel.s_datashapeClassName).attr("id",function(t){return"topic-"+t.topicID}).style("fill",function(t){return t.color}).style("opacity",1).on(t.Interaction.mouseover,function(e){t.TopicBullseye.prototype.MouseBehavior(this,e,t.Interaction.mouseover),this.m_panel.ReappendShapes(),this.ReappendShape()}.bind(this)).on(t.Interaction.mouseout,function(e){t.TopicBullseye.prototype.MouseBehavior(this,null,t.Interaction.mouseout)}.bind(this)).on(t.Interaction.click,function(e){this.m_clickTimerID?(clearTimeout(this.m_clickTimerID),this.m_clickTimerID=null,t.TopicBullseye.prototype.MouseBehavior(this,e,t.Interaction.dblclick)):this.m_clickTimerID=setTimeout(function(e){this.m_clickTimerID=null,t.TopicBullseye.prototype.MouseBehavior(this,e,t.Interaction.click)}.bind(this,e),250)}.bind(this)),s-=a}}),t.TopicBullseye.method("GenerateDataTiles",function(){var e={dataTileGroups:[],panelTitle:t.DataBar.prototype.s_defaultTitle,panelTitleID:"",dist2avg:0};return this.m_level.m_corpusMap.name==this.m_name?e.panelTitle=this.m_name:isNaN(parseInt(this.m_name))?t.CorpusClusterView.prototype.s_infoFlavorText==this.m_name?e.panelTitle=this.m_name:t.TextClusterView.prototype.s_infoFlavorText==this.m_name&&(e.panelTitle=this.m_name,e.panelTitleID=this.m_panel.m_clusterIndex):(e.panelTitle="Topic Cluster",e.panelTitleID=this.m_name,e.dist2avg=this.m_panel.m_adjustedDistances[parseInt(this.m_title)]-(this.m_panel.b_adjustDistances?this.m_panel.m_linkDistLimits.min:0),e.dist2avg=Math.abs(e.dist2avg)),dataTiles}),t.TopicBullseye.method("SetPanelNodeIndex",function(t){this.m_panelNodeIndex=t}),t.TopicBullseye.method("SetScaledRadius",function(t){this.m_scaledRadius=t}),t.TopicBullseye.method("SetX",function(t){this.m_coordinates.x=t,this.m_shapeGroup.selectAll("path").attr("transform","translate("+this.m_coordinates.x.toString()+","+this.m_coordinates.y.toString()+")"),this.m_shapeGroup.selectAll("circle").attr("cx",this.m_coordinates.x)}),t.TopicBullseye.method("SetY",function(t){this.m_coordinates.y=t,this.m_shapeGroup.selectAll("path").attr("transform","translate("+this.m_coordinates.x.toString()+","+this.m_coordinates.y.toString()+")"),this.m_shapeGroup.selectAll("circle").attr("cy",this.m_coordinates.y)}),t.TopicBullseye.method("SetTextCount",function(t){this.m_textCount=t}),t.TopicBullseye.prototype.MouseBehavior=function(e,i,s){if(-1==e.m_level.m_highlightedTopic)switch(s){case t.Interaction.mouseover:e.m_panel.Update(i,t.Interaction.mouseover);for(var o=0;o<e.m_panel.m_linkedViews.length;o++)t.Interaction.mouseover==e.m_panel.m_linkedViews[o].update&&e.m_panel.m_linkedViews[o].panel.Update(i,t.Interaction.mouseover);break;case t.Interaction.click:e.m_panel.Update(i,t.Interaction.mouseover),e.m_panel.Pause(!0);for(var o=0;o<e.m_panel.m_linkedViews.length;o++)t.Interaction.mouseover==e.m_panel.m_linkedViews[o].update&&(e.m_panel.m_linkedViews[o].panel instanceof t.DataBar&&e.m_panel.m_linkedViews[o].panel.Update({shapeRef:e},t.Interaction.click),e.m_panel.m_linkedViews[o].panel.Update(i,t.Interaction.mouseover)),e.m_panel.m_linkedViews[o].panel.Pause(!0);break;case t.Interaction.dblclick:e.m_panel.Update(i,t.Interaction.mouseover),e.m_panel.Pause(!0);for(var o=0;o<e.m_panel.m_linkedViews.length;o++)t.Interaction.mouseover==e.m_panel.m_linkedViews[o].update&&(e.m_panel.m_linkedViews[o].panel instanceof t.DataBar&&e.m_panel.m_linkedViews[o].panel.Update({shapeRef:e},t.Interaction.click),e.m_panel.m_linkedViews[o].panel.Update(i,t.Interaction.mouseover)),e.m_panel.m_linkedViews[o].panel.Pause(!0);e.AllowInteractions(t.Interaction.dblclick)&&e.m_panel.Update(e,t.Interaction.dblclick);break;case t.Interaction.mouseout:}else if(e.m_panel.IsPaused())switch(s){case t.Interaction.mouseover:break;case t.Interaction.click:if(i.topicID==e.m_level.m_highlightedTopic&&e==e.m_level.GetDataBar().GetCurrentShape()){e.m_panel.Pause(!1),e.m_panel.Update(null,t.Interaction.mouseover);for(var o=0;o<e.m_panel.m_linkedViews.length;o++)e.m_panel.m_linkedViews[o].panel.Pause(!1),e.m_panel.m_linkedViews[o].panel.Update(null,t.Interaction.mouseover)}else{e.m_panel.Pause(!1),e.m_panel.Update(null,t.Interaction.mouseover),e.m_panel.Update(i,t.Interaction.mouseover),e.m_panel.Pause(!0);for(var o=0;o<e.m_panel.m_linkedViews.length;o++)t.Interaction.mouseover==e.m_panel.m_linkedViews[o].update&&(e.m_panel.m_linkedViews[o].panel.Pause(!1),e.m_panel.m_linkedViews[o].panel.Update(null,t.Interaction.mouseover),e.m_panel.m_linkedViews[o].panel instanceof t.DataBar&&e.m_panel.m_linkedViews[o].panel.Update({shapeRef:e},t.Interaction.click),e.m_panel.m_linkedViews[o].panel.Update(i,t.Interaction.mouseover)),e.m_panel.m_linkedViews[o].panel.Pause(!0)}break;case t.Interaction.dblclick:for(var o=0;o<e.m_panel.m_linkedViews.length;o++)if(e.m_panel.m_linkedViews[o].panel instanceof t.DataBar){e.m_panel.m_linkedViews[o].panel.Update({shapeRef:e},t.Interaction.click);break}e.AllowInteractions(t.Interaction.dblclick)&&(e.m_panel.Pause(!1),e.m_panel.Update(e,t.Interaction.dblclick),e.m_panel.Pause(!0));break;case t.Interaction.mouseout:}else switch(s){case t.Interaction.mouseover:e.m_panel.Update(i,t.Interaction.mouseover);for(var o=0;o<e.m_panel.m_linkedViews.length;o++)t.Interaction.mouseover==e.m_panel.m_linkedViews[o].update&&e.m_panel.m_linkedViews[o].panel.Update(i,t.Interaction.mouseover);break;case t.Interaction.click:for(var o=0;o<e.m_panel.m_linkedViews.length;o++)if(e.m_panel.m_linkedViews[o].panel instanceof t.DataBar){e.m_panel.m_linkedViews[o].panel.Update({shapeRef:e},t.Interaction.click);break}e.m_panel.Pause(!0);for(var o=0;o<e.m_panel.m_linkedViews.length;o++)e.m_panel.m_linkedViews[o].panel.Pause(!0);break;case t.Interaction.dblclick:e.m_panel.Update(i,t.Interaction.mouseover),e.m_panel.Pause(!0);for(var o=0;o<e.m_panel.m_linkedViews.length;o++)t.Interaction.mouseover==e.m_panel.m_linkedViews[o].update&&(e.m_panel.m_linkedViews[o].panel instanceof t.DataBar&&e.m_panel.m_linkedViews[o].panel.Update({shapeRef:e},t.Interaction.click),e.m_panel.m_linkedViews[o].panel.Update(i,t.Interaction.mouseover)),e.m_panel.m_linkedViews[o].panel.Pause(!0);e.AllowInteractions(t.Interaction.dblclick)&&e.m_panel.Update(e,t.Interaction.dblclick);break;case t.Interaction.mouseout:e.m_panel.Update(null,t.Interaction.mouseover);for(var o=0;o<e.m_panel.m_linkedViews.length;o++)e.m_panel.m_linkedViews[o].panel.Update(null,t.Interaction.mouseover)}},"b"==t.TopicBullseye.prototype.s_shapeChar,t.TopicRectangle=function(e,i,s,o,a,n,r,l){t.DataShape.apply(this,arguments),this.m_data=null,this.m_tipLines=[],this.m_showingTip=!1,this.m_tip=null,this.m_size.width=this.m_size.width*t.TopicRectangle.prototype.multiplier,this.m_size.height=this.m_size.height*t.TopicRectangle.prototype.multiplier,this.m_clusterIndex=r,this.startingPosition={x:this.m_coordinates.x,y:this.m_coordinates.y},this.m_clusterRectShapeGroup=null,this.m_shapeChar=t.TopicRectangle.prototype.s_shapeChar,this.m_allowDblclick=!0,this.m_fileID=s;for(var h=0,m=0;m<this.m_level.m_corpusMap.children[this.m_clusterIndex].children.length;m++)if(this.m_name==this.m_level.m_corpusMap.children[this.m_clusterIndex].children[m].name){h=m;break}var p=this.m_level.m_corpusMap.children[this.m_clusterIndex].children[h].topics;this.m_fullTopicListRef=p,this.m_topicProportionSum=0;for(m in p)this.m_topicProportionSum+=p[m][1];this.m_numberRects=l;var _=Object.keys(p).sort(function(t,e){return p[t][1]-p[e][1]});this.m_topTopics=[];for(var m=_.length-1,c=0;m>=0&&c<this.m_numberRects;m--,c++)this.m_topTopics.push([_[m],p[_[m]][1]])},t.TopicRectangle.inherits(t.DataShape),t.TopicRectangle.method("AddTextTag",function(e,i,s,o,a){this.m_textTag=this.m_shapeGroup.append("text").attr("class",this.m_panel.s_datashapeTextClassName).attr("dx","0").attr("dy","0").attr("fill",s).style("font-family",t.Level.prototype.s_fontFamily).style("font-size",i).style("position","relative");textFlow(e,this.m_textTag[0][0],this.m_panel.m_svg.attr("width"),i,t.TopicBar.prototype.s_textInfo.yIncrement,!1);this.m_textTag.selectAll("tspan").attr("x",o.x).attr("y",o.y).style("opacity",a)}),t.TopicRectangle.method("BuildTipLines",function(){var t=[];for(text_line_index=0,this.m_data.lines_and_colors.forEach(function(e){t.push([text_line_index,e[0].trim()]),text_line_index+=1}),line_index=0;line_index<t.length;line_index++){var e="",i=this.m_data.lines_and_colors[line_index][0].trim().split(" "),s=Object.keys(this.m_data.lines_and_colors[line_index][1]).length;for(word_index=0;word_index<s;word_index++)e=-1==this.m_data.lines_and_colors[line_index][1][word_index]?e+" "+i[word_index]:e+' <font color="'+this.m_level.m_topicColors[this.m_data.lines_and_colors[line_index][1][word_index]]+'">'+i[word_index]+"</font>";this.m_tipLines.push(e)}}),t.TopicRectangle.method("CalculateSize",function(){var e=this.m_data.lines_and_colors.length;e>t.TopicRectangle.prototype.s_maxLinesInRect&&(e=t.TopicRectangle.prototype.s_maxLinesInRect),this.m_size={width:0,height:e*(t.TopicRectangle.prototype.strokeWidth+t.TopicRectangle.prototype.spaceBetweenLines)+4*t.TopicRectangle.prototype.borderWidth-2*t.TopicRectangle.prototype.spaceBetweenLines};for(var i=0;e>i;i++){var s=Object.keys(this.m_data.lines_and_colors[i][0]).length*t.TopicRectangle.prototype.wordLength;s>this.m_size.width&&(this.m_size.width=s)}this.m_radius=Math.sqrt((this.m_size.width>>1)*(this.m_size.width>>1)+(this.m_size.height>>1)*(this.m_size.height>>1)),this.m_size.width+=4*t.TopicRectangle.prototype.spaceAroundText,this.m_coordinates.x-=this.m_size.width>>1,this.m_coordinates.y-=this.m_size.height>>1}),t.TopicRectangle.method("CreateHighlightRectangles",function(e){this.m_clusterRectShapeGroup=e.append("g").attr("class","group_twic_datashape_smoothzooming").attr("id","twic_clusterrect_"+this.m_level.m_objectCount),this.m_level.m_objectCount+=1;for(var i=this.m_numberRects-1,s=0;i>0;i--,s++){var o={color:this.m_level.m_topicColors[this.m_topTopics[i][0]],topicID:this.m_topTopics[i][0],prop:this.m_topTopics[i][1],file_id:this.m_name,shapeRef:this};1==this.m_numberRects?o.locolor=this.m_level.m_topicColors[this.m_topTopics[i][0]]:o.locolor=this.m_level.m_topicColorsLoBlend[this.m_topTopics[i][0]];var a=i*t.TopicRectangle.prototype.s_borderRadius;this.m_clusterRectShapeGroup.append("rect").datum(o).attr("class",this.m_panel.s_datashapeClassName).attr("x",this.m_coordinates.x-i*t.TopicRectangle.prototype.s_borderRadius).attr("y",this.m_coordinates.y-i*t.TopicRectangle.prototype.s_borderRadius).attr("width",this.m_size.width+2*i*t.TopicRectangle.prototype.borderWidth).attr("height",this.m_size.height+2*i*t.TopicRectangle.prototype.borderWidth).attr("rx",a).attr("ry",a).attr("stroke",function(t){return t.locolor}).attr("stroke-width",t.TopicRectangle.prototype.borderWidth).attr("stroke-opacity",1).attr("stroke-join","round").attr("fill-opacity",0).on(t.Interaction.mouseover,function(e){this.m_panel.IsPaused()||this.m_shapeGroup.style("opacity",1),t.TopicRectangle.prototype.MouseBehavior(this,e,t.Interaction.mouseover),this.m_clusterRectShapeGroup.node().parentNode.parentNode.parentNode.parentNode.appendChild(this.m_clusterRectShapeGroup.node().parentNode.parentNode.parentNode)}.bind(this)).on(t.Interaction.mouseout,function(e){t.TopicRectangle.prototype.MouseBehavior(this,null,t.Interaction.mouseout)}.bind(this)).on(t.Interaction.click,function(e){this.m_clickTimerID?(clearTimeout(this.m_clickTimerID),this.m_clickTimerID=null,t.TopicRectangle.prototype.MouseBehavior(this,e,t.Interaction.dblclick)):this.m_clickTimerID=setTimeout(function(e){this.m_clickTimerID=null,t.TopicRectangle.prototype.MouseBehavior(this,e,t.Interaction.click)}.bind(this,e),250)}.bind(this))}}),t.TopicRectangle.method("Draw",function(){this.m_node=this.m_panel.m_clusterSvgGroup.append("g").attr("class","node").attr("id","textrect_node_"+this.m_name).style("position","absolute"),this.m_shapeGroup=this.m_node.append("g").attr("class",this.m_panel.s_datashapeClassName).style("position","absolute").datum(this.m_data).style("opacity",1);var e=this.m_shapeGroup.append("g").attr("id","g_clusterrectgroup_"+this.m_name);this.CreateHighlightRectangles(e);var i={color:this.m_level.m_topicColors[this.m_clusterIndex],topicID:this.m_clusterIndex,shapeRef:this};1==this.m_numberRects?i.locolor=this.m_level.m_topicColors[this.m_clusterIndex]:i.locolor=this.m_level.m_topicColorsLoBlend[this.m_clusterIndex];var s=this.m_shapeGroup.append("g").attr("class",this.m_panel.s_datashapeClassName).attr("id","text_rect_group_"+this.m_clusterIndex).datum(i).on(t.Interaction.mouseover,function(e){t.TopicRectangle.prototype.MouseBehavior(this,e,t.Interaction.mouseover);var i=d3.select("#textrect_node_"+this.m_name);i.node().parentNode.appendChild(i.node())}.bind(this)).on(t.Interaction.mouseout,function(e){t.TopicRectangle.prototype.MouseBehavior(this,null,t.Interaction.mouseout)}.bind(this)).on(t.Interaction.click,function(e){console.log("Topic rectangle click event"),this.m_clickTimerID?(console.log("Clear time out"),clearTimeout(this.m_clickTimerID),this.m_clickTimerID=null,t.TopicRectangle.prototype.MouseBehavior(this,e,t.Interaction.dblclick)):(console.log("setTimeout case"),this.m_clickTimerID=setTimeout(function(e){console.log("setTimeout callback"),this.m_clickTimerID=null,t.TopicRectangle.prototype.MouseBehavior(this,e,t.Interaction.click)}.bind(this,e),250))}.bind(this));this.m_textRect=s.append("rect").attr("class","text_info_rect").datum(i).attr("x",this.m_coordinates.x).attr("y",this.m_coordinates.y).attr("width",this.m_size.width).attr("height",this.m_size.height).attr("rx",t.TopicRectangle.prototype.cornerRadius).attr("ry",t.TopicRectangle.prototype.cornerRadius).style("stroke-width",t.TopicRectangle.prototype.borderWidth).style("stroke",this.m_level.m_topicColors[this.m_clusterIndex]).style("fill",t.TopicRectangle.prototype.fillColor).style("position","absolute"),this.m_startingPosition={x:this.m_coordinates.x+t.TopicRectangle.prototype.spaceAroundText,y:this.m_coordinates.y+t.TopicRectangle.prototype.spaceBetweenLines};for(var o=0;o<this.m_data.lines_and_colors.length&&o<t.TopicRectangle.prototype.s_maxLinesInRect;o++){for(var a=[],n=this.m_data.lines_and_colors[o][0].length,r=0;n>r;r++)a.push({l:o,w:r});s.append("g").attr("class","line"+o).style("position","absolute").selectAll("path").data(a).enter().append("path").attr("class",t.TopicRectangle.prototype.s_datashapeClassName).style("stroke",function(e){var i=this.m_data.lines_and_colors[e.l][1][e.w];return void 0==i?t.TopicRectangle.prototype.defaultFontColor:this.m_level.m_topicColors[i]}.bind(this)).style("stroke-width",t.TopicRectangle.prototype.strokeWidth+"px").attr("d",function(e){"0"==e.w&&(this.m_startingPosition.x=2*t.TopicRectangle.prototype.spaceAroundText+this.m_coordinates.x,e.l>0?this.m_startingPosition.y+=t.TopicRectangle.prototype.spaceBetweenLines+t.TopicRectangle.prototype.strokeWidth:this.m_startingPosition.y+=t.TopicRectangle.prototype.spaceAroundText);var i="M "+this.m_startingPosition.x+","+this.m_startingPosition.y+" "+(this.m_startingPosition.x+t.TopicRectangle.prototype.wordLength)+","+this.m_startingPosition.y;return this.m_startingPosition.x+=t.TopicRectangle.prototype.wordLength,i}.bind(this)).style("position","absolute").style("opacity",function(t){this.m_data.lines_and_colors[t.l][1][t.w];return 1}.bind(this))}}),t.TopicRectangle.method("IsPointInRect",function(t){return t[0]>this.m_coordinates.x&&t[0]<this.m_size.width&&t[1]>this.m_coordinates.y&&t[1]<this.m_size.height}),t.TopicRectangle.method("Load",function(){this.m_level.m_queue.defer(function(e){d3.json(t.TopicRectangle.prototype.jsonDirectory+this.m_name+".json",function(t,i){this.m_data=i.document,this.CalculateSize(),e(null,this.m_data)}.bind(this))}.bind(this))}),t.TopicRectangle.method("LoadURL",function(t){this.m_level.m_queue.defer(function(e){d3.json(t,function(t,i){
this.m_data=i.document,this.CalculateSize(),e(null,this.m_data)}.bind(this))}.bind(this))}),t.TopicRectangle.method("SetPanelNodeIndex",function(t){this.m_panelNodeIndex=t}),t.TopicRectangle.method("SetTitle",function(t){this.m_title=t}),t.TopicRectangle.prototype.MouseBehavior=function(e,i,s){if(console.log("Topic Rectangle MouseBehavior"),-1==e.m_level.m_highlightedTopic)switch(s){case t.Interaction.mouseover:e.m_panel.Update(i,t.Interaction.mouseover);for(var o=0;o<e.m_panel.m_linkedViews.length;o++)t.Interaction.mouseover==e.m_panel.m_linkedViews[o].update&&e.m_panel.m_linkedViews[o].panel.Update(i,t.Interaction.mouseover);break;case t.Interaction.click:e.m_panel.Update(i,t.Interaction.mouseover),e.m_panel.Pause(!0);for(var o=0;o<e.m_panel.m_linkedViews.length;o++)t.Interaction.mouseover==e.m_panel.m_linkedViews[o].update&&(e.m_panel.m_linkedViews[o].panel instanceof t.DataBar&&e.m_panel.m_linkedViews[o].panel.Update({shapeRef:e},t.Interaction.click),e.m_panel.m_linkedViews[o].panel.Update(i,t.Interaction.mouseover)),e.m_panel.m_linkedViews[o].panel.Pause(!0);break;case t.Interaction.dblclick:console.log("Unhighlighted doubleclick case"),e.m_panel.Update(i,t.Interaction.mouseover),e.m_panel.Pause(!0);for(var o=0;o<e.m_panel.m_linkedViews.length;o++)t.Interaction.mouseover==e.m_panel.m_linkedViews[o].update&&(e.m_panel.m_linkedViews[o].panel instanceof t.DataBar&&e.m_panel.m_linkedViews[o].panel.Update({shapeRef:e},t.Interaction.click),e.m_panel.m_linkedViews[o].panel.Update(i,t.Interaction.mouseover)),e.m_panel.m_linkedViews[o].panel.Pause(!0);if(e.AllowInteractions(t.Interaction.dblclick))if(e.m_panel.IsUnderlyingPanelOpen()){for(var o=0;o<e.m_panel.m_linkedViews.length;o++)if(t.Interaction.dblclick==e.m_panel.m_linkedViews[o].update){e.m_panel.m_linkedViews[o].panel.Pause(!1);var a=void 0===e.m_panel.m_clusterIndex?e.m_topTopics[0][0]:e.m_panel.m_clusterIndex;e.m_panel.m_linkedViews[o].panel.Update({json:e.m_data,clusterIndex:a,topicID:i.topicID,color:e.m_level.m_topicColors[i.topicID]},t.Interaction.dblclick),e.m_panel.m_linkedViews[o].panel.Pause(!0)}}else{var a=void 0===e.m_panel.m_clusterIndex?e.m_topTopics[0][0]:e.m_panel.m_clusterIndex;e.m_level.Update({json:e.m_data,clusterIndex:a,topicID:i.topicID,color:e.m_level.m_topicColors[i.topicID]},t.Interaction.dblclick)}break;case t.Interaction.mouseout:}else if(e.m_panel.IsPaused())switch(s){case t.Interaction.mouseover:break;case t.Interaction.click:if(i.topicID==e.m_level.m_highlightedTopic&&e==e.m_level.GetDataBar().GetCurrentShape()){e.m_panel.Pause(!1),e.m_panel.Update(null,t.Interaction.mouseover);for(var o=0;o<e.m_panel.m_linkedViews.length;o++)e.m_panel.m_linkedViews[o].panel.Pause(!1),e.m_panel.m_linkedViews[o].panel.Update(null,t.Interaction.mouseover)}else{e.m_panel.Pause(!1),e.m_panel.Update(null,t.Interaction.mouseover),e.m_panel.Update(i,t.Interaction.mouseover),e.m_panel.Pause(!0);for(var o=0;o<e.m_panel.m_linkedViews.length;o++)t.Interaction.mouseover==e.m_panel.m_linkedViews[o].update&&(e.m_panel.m_linkedViews[o].panel.Pause(!1),e.m_panel.m_linkedViews[o].panel.Update(null,t.Interaction.mouseover),e.m_panel.m_linkedViews[o].panel instanceof t.DataBar&&e.m_panel.m_linkedViews[o].panel.Update({shapeRef:e},t.Interaction.click),e.m_panel.m_linkedViews[o].panel.Update(i,t.Interaction.mouseover)),e.m_panel.m_linkedViews[o].panel.Pause(!0)}break;case t.Interaction.dblclick:console.log("Highlighted doubleclick case");for(var o=0;o<e.m_panel.m_linkedViews.length;o++)if(e.m_panel.m_linkedViews[o].panel instanceof t.DataBar){e.m_panel.m_linkedViews[o].panel.Update({shapeRef:e},t.Interaction.click);break}if(e.AllowInteractions(t.Interaction.dblclick))if(e.m_panel.IsUnderlyingPanelOpen()){for(var o=0;o<e.m_panel.m_linkedViews.length;o++)if(t.Interaction.dblclick==e.m_panel.m_linkedViews[o].update){e.m_panel.m_linkedViews[o].panel.Pause(!1);var a=void 0===e.m_panel.m_clusterIndex?e.m_topTopics[0][0]:e.m_panel.m_clusterIndex;e.m_panel.m_linkedViews[o].panel.Update({json:e.m_data,clusterIndex:a,topicID:e.m_level.m_highlightedTopic,color:e.m_level.m_topicColors[e.m_level.m_highlightedTopic]},t.Interaction.dblclick),e.m_panel.m_linkedViews[o].panel.Pause(!0)}}else{var a=void 0===e.m_panel.m_clusterIndex?e.m_topTopics[0][0]:e.m_panel.m_clusterIndex;e.m_level.Update({json:e.m_data,clusterIndex:a,topicID:e.m_level.m_highlightedTopic,color:e.m_level.m_topicColors[e.m_level.m_highlightedTopic]},t.Interaction.dblclick)}break;case t.Interaction.mouseout:}else switch(s){case t.Interaction.mouseover:e.m_panel.Update(i,t.Interaction.mouseover);for(var o=0;o<e.m_panel.m_linkedViews.length;o++)t.Interaction.mouseover==e.m_panel.m_linkedViews[o].update&&e.m_panel.m_linkedViews[o].panel.Update(i,t.Interaction.mouseover);break;case t.Interaction.click:for(var o=0;o<e.m_panel.m_linkedViews.length;o++)if(e.m_panel.m_linkedViews[o].panel instanceof t.DataBar){e.m_panel.m_linkedViews[o].panel.Update({shapeRef:e},t.Interaction.click);break}e.m_panel.Pause(!0);for(var o=0;o<e.m_panel.m_linkedViews.length;o++)e.m_panel.m_linkedViews[o].panel.Pause(!0);break;case t.Interaction.dblclick:e.m_panel.Update(i,t.Interaction.mouseover);for(var o=0;o<e.m_panel.m_linkedViews.length;o++)t.Interaction.mouseover==e.m_panel.m_linkedViews[o].update&&(e.m_panel.m_linkedViews[o].panel instanceof t.DataBar&&e.m_panel.m_linkedViews[o].panel.Update({shapeRef:e},t.Interaction.click),e.m_panel.m_linkedViews[o].panel.Update(i,t.Interaction.mouseover)),e.m_panel.m_linkedViews[o].panel.Pause(!0);if(e.AllowInteractions(t.Interaction.dblclick))if(e.m_panel.IsUnderlyingPanelOpen()){for(var o=0;o<e.m_panel.m_linkedViews.length;o++)if(t.Interaction.dblclick==e.m_panel.m_linkedViews[o].update){e.m_panel.m_linkedViews[o].panel.Pause(!1);var a=void 0===e.m_panel.m_clusterIndex?e.m_topTopics[0][0]:e.m_panel.m_clusterIndex;e.m_panel.m_linkedViews[o].panel.Update({json:e.m_data,clusterIndex:a,topicID:i.topicID},t.Interaction.dblclick),e.m_panel.m_linkedViews[o].panel.Pause(!0)}}else{var a=void 0===e.m_panel.m_clusterIndex?e.m_topTopics[0][0]:e.m_panel.m_clusterIndex;e.m_level.Update({json:e.m_data,clusterIndex:a,topicID:i.topicID},t.Interaction.dblclick)}e.m_panel.Pause(!0);break;case t.Interaction.mouseout:e.m_panel.Update(null,t.Interaction.mouseover);for(var o=0;o<e.m_panel.m_linkedViews.length;o++)e.m_panel.m_linkedViews[o].panel.Update(null,t.Interaction.mouseover)}},t.TopicRectangle.prototype.multiplier=2,t.TopicRectangle.prototype.spaceAroundText=2*t.TopicRectangle.prototype.multiplier,t.TopicRectangle.prototype.borderWidth=2*t.TopicRectangle.prototype.multiplier,t.TopicRectangle.prototype.cornerRadius=.025,t.TopicRectangle.prototype.s_borderRadius=4,t.TopicRectangle.prototype.fillColor=t.Level.prototype.s_palette.darkblue,t.TopicRectangle.prototype.strokeWidth=2*t.TopicRectangle.prototype.multiplier,t.TopicRectangle.prototype.wordLength=2*t.TopicRectangle.prototype.multiplier,t.TopicRectangle.prototype.spaceBetweenLines=2*t.TopicRectangle.prototype.multiplier,t.TopicRectangle.prototype.defaultFontColor=t.Level.prototype.s_palette.gold,t.TopicRectangle.prototype.jsonDirectory=TWiC.Level.prototype.s_jsonDirectory+"texts/",t.TopicRectangle.prototype.s_shapeChar="r",t.TopicRectangle.prototype.s_maxLinesInRect=10,t.TopicText=function(e,i,s,o,a,n,r){t.DataShape.apply(this,arguments),this.m_linkedViews=n,this.m_data=r},t.TopicText.inherits(t.DataShape),t.TopicText.method("Draw",function(e){for(var i=this.m_coordinates.y,s=this.m_size.height+t.Panel.prototype.s_borderRadius,o=t.TopicBar.prototype.s_textInfo.yIncrement,a=0;a<this.m_data.json.line_count;a++)i+=o,i>this.m_panel.m_size.height&&(s+=o);var n=e.append("foreignObject").attr("width",this.m_size.width).attr("height",s);n.append("xhtml:body").style("background-color",t.Level.prototype.s_palette.darkblue).html(this.m_data.json.full_text),this.m_panel.m_div.attr("height",s).selectAll(".text_coloredword").on(t.Interaction.click,function(e){t.TopicText.prototype.MouseBehavior(this,e,t.Interaction.click),this.UnhighlightTilesInDataBar(),this.FindAndHighlightInDataBar(e);var i=this.GetDataBarRef();i.Pause(!i.IsPaused()),d3.event.stopPropagation()}.bind(this)).on(t.Interaction.mouseover,function(e){t.TopicText.prototype.MouseBehavior(this,e,t.Interaction.mouseover),this.GetDataBarRef().IsPaused()||this.FindAndHighlightInDataBar(e)}.bind(this)).on(t.Interaction.mouseout,function(e){t.TopicText.prototype.MouseBehavior(this,null,t.Interaction.mouseout),this.GetDataBarRef().IsPaused()||this.UnhighlightTilesInDataBar()}.bind(this)),this.m_panel.m_div.selectAll(".text_word").on(t.Interaction.click,function(e){-1!=this.m_level.m_highlightedTopic&&(t.TopicText.prototype.MouseBehavior(null,t.Interaction.click),this.UnhighlightTilesInDataBar(),d3.event.stopPropagation())}.bind(this))}),t.TopicText.method("OldDraw",function(e){e.append("p").append("span").style("font-family",t.Level.prototype.s_fontFamily).style("font-size",22).html("&nbsp;");for(var i=this.m_coordinates.y,s=this.m_size.height+t.Panel.prototype.s_borderRadius,o=t.TopicBar.prototype.s_textInfo.yIncrement,a=0;a<this.m_data.json.lines_and_colors.length;a++){console.log("New novel line"),words=this.m_data.json.lines_and_colors[a][0].split(" ");var n,r=this.m_coordinates.x,l=e.append("p").attr("class","text_p");l.append("span").attr("class","text_edgespan").html("&nbsp;&nbsp;&nbsp;&nbsp;");for(var h=0;h<words.length;h++)if("-1"==this.m_data.json.lines_and_colors[a][1][h]||void 0==this.m_data.json.lines_and_colors[a][1][h])n=l.append("span").attr("class","text_word").html(words[h]+"&nbsp;"),r+=.66*n[0][0].offsetWidth;else{var m=this.m_level.m_topicColorsLoBlend[this.m_data.json.lines_and_colors[a][1][h]];n=l.append("span").attr("class","text_coloredword").datum({topicID:this.m_data.json.lines_and_colors[a][1][h],locolor:m,color:this.m_level.m_topicColors[this.m_data.json.lines_and_colors[a][1][h]],word:words[h]}).style("color",this.m_level.m_topicColors[this.m_data.json.lines_and_colors[a][1][h]]).html(words[h]+"&nbsp;"),r+=.66*n[0][0].offsetWidth}i+=o,i>this.m_panel.m_size.height&&(s+=o),e.append("br")}this.m_panel.m_div.selectAll(".text_coloredword").attr("height",s).on(t.Interaction.click,function(e){t.TopicText.prototype.MouseBehavior(this,e,t.Interaction.click),d3.event.stopPropagation()}.bind(this)).on(t.Interaction.mouseover,function(e){t.TopicText.prototype.MouseBehavior(this,e,t.Interaction.mouseover)}.bind(this)).on(t.Interaction.mouseout,function(e){t.TopicText.prototype.MouseBehavior(this,null,t.Interaction.mouseout)}.bind(this)),this.m_panel.m_div.selectAll(".text_word").on(t.Interaction.click,function(e){-1!=this.m_level.m_highlightedTopic&&(t.TopicText.prototype.MouseBehavior(null,t.Interaction.click),d3.event.stopPropagation())}.bind(this))}),t.TopicText.method("GetDataBarRef",function(){for(var e=null,i=0;i<this.m_panel.m_linkedViews.length;i++)if(this.m_panel.m_linkedViews[i].panel instanceof t.DataBar){e=this.m_panel.m_linkedViews[i].panel;break}return e}),t.TopicText.method("FindAndHighlightInDataBar",function(t){var e=this.GetDataBarRef(),i=e.m_wordWeightDataTiles,s=t.word.trim();s=s.replace(/\b\W/,""),s=s.replace(/\W\b/,""),s=s.trim(),s=s.toLowerCase();for(var o=0;o<i.length;o++)if(s==i[o].m_text){e.Pause(),i[o].HighlightTile(!0),$(e.m_div[0][0]).scrollTop(i[o].m_coordinates.y);break}}),t.TopicText.method("UnhighlightTilesInDataBar",function(t){for(var e=this.GetDataBarRef(),i=e.m_wordWeightDataTiles,s=0;s<i.length;s++)i[s].HighlightTile(!1);e.m_highlightIndex=-1,$(e.m_div[0][0]).scrollTop(0)}),t.TopicText.prototype.MouseBehavior=function(e,i,s){if(-1==e.m_level.m_highlightedTopic)switch(s){case t.Interaction.mouseover:e.m_panel.Update(i,t.Interaction.mouseover);for(var o=0;o<e.m_linkedViews.length;o++)t.Interaction.mouseover==e.m_linkedViews[o].update&&e.m_linkedViews[o].panel.Update(i,t.Interaction.mouseover);break;case t.Interaction.click:case t.Interaction.dblclick:e.m_panel.Update(i,t.Interaction.mouseover),e.m_panel.Pause(!0);for(var o=0;o<e.m_linkedViews.length;o++)t.Interaction.mouseover==e.m_linkedViews[o].update&&(e.m_linkedViews[o].panel instanceof t.DataBar&&e.m_linkedViews[o].panel.Update(i,t.Interaction.click),e.m_linkedViews[o].panel.Update(i,t.Interaction.mouseover)),e.m_linkedViews[o].panel.Pause(!0);break;case t.Interaction.mouseout:}else if(e.m_panel.IsPaused())switch(s){case t.Interaction.mouseover:break;case t.Interaction.click:case t.Interaction.dblclick:if(null==i||i.topicID==e.m_level.m_highlightedTopic){e.m_panel.Pause(!1),e.m_panel.Update(null,t.Interaction.mouseover);for(var o=0;o<e.m_linkedViews.length;o++)e.m_linkedViews[o].panel.Pause(!1),e.m_linkedViews[o].panel.Update(null,t.Interaction.mouseover)}else{e.m_panel.Pause(!1),e.m_panel.Update(i,t.Interaction.mouseover),e.m_panel.Pause(!0);for(var o=0;o<e.m_linkedViews.length;o++)e.m_linkedViews[o].panel.Pause(!1),t.Interaction.mouseover==e.m_linkedViews[o].update&&(e.m_linkedViews[o].panel instanceof t.DataBar&&e.m_linkedViews[o].panel.Update(i,t.Interaction.click),e.m_linkedViews[o].panel.Update(i,t.Interaction.mouseover)),e.m_linkedViews[o].panel.Pause(!0)}break;case t.Interaction.mouseout:}else switch(s){case t.Interaction.mouseover:e.m_panel.Update(i,t.Interaction.mouseover);for(var o=0;o<e.m_linkedViews.length;o++)t.Interaction.mouseover==e.m_linkedViews[o].update&&e.m_linkedViews[o].panel.Update(i,t.Interaction.mouseover);break;case t.Interaction.click:case t.Interaction.dblclick:e.m_panel.Update(i,t.Interaction.mouseover),e.m_panel.Pause(!0);for(var o=0;o<e.m_linkedViews.length;o++)t.Interaction.mouseover==e.m_linkedViews[o].update&&(e.m_linkedViews[o].panel instanceof t.DataBar&&e.m_linkedViews[o].panel.Update(i,t.Interaction.click),e.m_linkedViews[o].panel.Update(i,t.Interaction.mouseover)),e.m_linkedViews[o].panel.Pause(!0);break;case t.Interaction.mouseout:e.m_panel.Update(null,t.Interaction.mouseover);for(var o=0;o<e.m_linkedViews.length;o++)e.m_linkedViews[o].panel.Update(null,t.Interaction.mouseover)}},t.DataTile=function(e,i,s,o,a,n){t.DataShape.apply(this,arguments),this.m_dataShape=n},t.DataTile.inherits(t.DataShape),t.DataTile.method("ResizeOverTime",function(t){}),t.TopicTile=function(e,i,s,o,a,n,r){t.DataTile.apply(this,arguments),this.m_topicID=r;for(topicID in this.m_dataShape.m_fullTopicListRef)this.m_topicID==topicID&&(this.m_topicProportion=this.m_dataShape.m_fullTopicListRef[topicID][1]);this.m_topicProportion/=n.m_topicProportionSum,this.m_topicColor=this.m_level.m_topicColors[this.m_topicID],this.m_topicWords=this.m_level.m_topicWordLists[this.m_topicID]},t.TopicTile.inherits(t.DataTile),t.TopicTile.method("Draw",function(e){this.m_shapeGroup=this.m_panel.m_tileGroup.append("g").attr("class",t.DataBar.prototype.s_datashapeClassName).attr("id",t.DataBar.prototype.s_datashapeClassName+"_"+this.m_name).datum({topicID:this.m_topicID,color:this.m_level.m_topicColors[this.m_topicID],tileRef:this}).on(t.Interaction.click,function(e){this.m_clickTimerID?(clearTimeout(this.m_clickTimerID),this.m_clickTimerID=null,t.TopicTile.prototype.MouseBehavior(this,e,t.Interaction.dblclick)):this.m_clickTimerID=setTimeout(function(e){this.m_clickTimerID=null,t.TopicTile.prototype.MouseBehavior(this,e,t.Interaction.click)}.bind(this,e),250)}.bind(this)).on(t.Interaction.mouseover,function(e){t.TopicTile.prototype.MouseBehavior(this,e,t.Interaction.mouseover)}.bind(this)).on(t.Interaction.mouseout,function(){t.TopicTile.prototype.MouseBehavior(this,null,t.Interaction.mouseout)}.bind(this)),this.m_shapeGroup.append("rect").attr("x",this.m_coordinates.x).attr("y",this.m_coordinates.y+t.DataBar.prototype.s_elementSpacing).attr("width",this.m_panel.m_size.width).attr("height",t.TopicTile.prototype.s_tileDims.height+t.DataBar.prototype.s_elementSpacing).attr("fill",t.Level.prototype.s_palette.darkblue).style("opacity",0),this.m_shapeGroup.append("rect").attr("x",this.m_coordinates.x+t.DataBar.prototype.s_elementSpacing).attr("y",this.m_coordinates.y+t.DataBar.prototype.s_elementSpacing).attr("width",this.m_panel.m_size.width-2*t.DataBar.prototype.s_elementSpacing).attr("height",t.TopicTile.prototype.s_tileDims.height).style("fill",t.Level.prototype.s_palette.tile),this.m_highlightRect=this.m_shapeGroup.append("rect").attr("x",this.m_coordinates.x+t.DataBar.prototype.s_elementSpacing).attr("y",this.m_coordinates.y+t.DataBar.prototype.s_elementSpacing).attr("width",this.m_panel.m_size.width-2*t.DataBar.prototype.s_elementSpacing).attr("height",t.TopicTile.prototype.s_tileDims.height).style("fill",t.ShadeBlend(TWiC.DataShape.prototype.s_colorHighlight,t.Level.prototype.s_palette.tile)).style("opacity",0),this.m_title=this.m_shapeGroup.append("text").attr("x",this.m_coordinates.x+2*t.DataBar.prototype.s_elementSpacing).attr("y",this.m_coordinates.y+3*t.DataBar.prototype.s_elementSpacing),this.m_title.append("tspan").html("Topic&nbsp;").attr("fill",t.Level.prototype.s_palette.gold).style("font-family",t.Level.prototype.s_fontFamily).style("font-size",21),this.m_title.append("tspan").html(this.m_topicID).attr("fill",this.m_level.m_topicColors[this.m_topicID]).style("font-family",t.Level.prototype.s_fontFamily).style("font-size",21);var i=e*(t.TopicTile.prototype.s_tileDims.width-2*t.DataBar.prototype.s_elementSpacing);this.m_proportion=this.m_shapeGroup.append("rect").attr("class","topic_tile_proportion").attr("x",this.m_coordinates.x+3*t.TopicTile.prototype.s_topicCircleRadius).attr("y",this.m_coordinates.y+4*t.DataBar.prototype.s_elementSpacing).attr("width",i).attr("height",2*t.DataBar.prototype.s_elementSpacing).style("fill",this.m_level.m_topicColors[this.m_topicID]),this.m_proportionText=this.m_shapeGroup.append("text").attr("x",this.m_coordinates.x+i+4*t.TopicTile.prototype.s_topicCircleRadius).attr("y",this.m_coordinates.y+5.5*t.DataBar.prototype.s_elementSpacing),this.m_proportionText.append("tspan").html((100*this.m_topicProportion).toFixed(3)+"&nbsp;%").attr("fill",t.Level.prototype.s_palette.gold).style("font-family",t.Level.prototype.s_fontFamily).style("font-size",21).style("font-weight","bold")}),t.TopicTile.method("HighlightTile",function(t){var e=t?1:0;this.m_highlightRect.style("opacity",e)}),t.TopicTile.method("ResizeOverTime",function(e){this.m_shapeGroup.selectAll("rect").filter(function(){return"topic_tile_proportion"!=d3.select(this).attr("class")}).transition().duration(e.duration).attr("x",this.m_coordinates.x+t.DataBar.prototype.s_elementSpacing).attr("y",this.m_coordinates.y+t.DataBar.prototype.s_elementSpacing).attr("width",e.size.width)}),t.TopicTile.prototype.MouseBehavior=function(e,i,s){if(-1==e.m_level.m_highlightedTopic)switch(s){case t.Interaction.mouseover:e.m_panel.Update(i,t.Interaction.mouseover,!0);for(var o=0;o<e.m_panel.m_linkedViews.length;o++)t.Interaction.mouseover==e.m_panel.m_linkedViews[o].update&&e.m_panel.m_linkedViews[o].panel.Update(i,t.Interaction.mouseover);break;case t.Interaction.click:case t.Interaction.dblclick:e.m_panel.Pause(!1),e.m_panel.Update(i,t.Interaction.mouseover,!0),e.m_panel.Pause(!0);for(var o=0;o<e.m_panel.m_linkedViews.length;o++)t.Interaction.mouseover==e.m_panel.m_linkedViews[o].update&&(e.m_panel.m_linkedViews[o].panel.Pause(!1),e.m_panel.m_linkedViews[o].panel.Update(i,t.Interaction.mouseover)),e.m_panel.m_linkedViews[o].panel.Pause(!0);break;case t.Interaction.mouseout:}else if(e.m_panel.IsPaused())switch(s){case t.Interaction.mouseover:break;case t.Interaction.click:case t.Interaction.dblclick:if(i.topicID==e.m_level.m_highlightedTopic){e.m_panel.Pause(!1),e.m_panel.Update(null,t.Interaction.mouseover,!0);for(var o=0;o<e.m_panel.m_linkedViews.length;o++)e.m_panel.m_linkedViews[o].panel.Pause(!1),e.m_panel.m_linkedViews[o].panel.Update(null,t.Interaction.mouseover)}else{e.m_panel.Pause(!1),e.m_panel.Update(null,t.Interaction.mouseover,!0),e.m_panel.Update(i,t.Interaction.mouseover,!0),e.m_panel.Pause(!0);for(var o=0;o<e.m_panel.m_linkedViews.length;o++)t.Interaction.mouseover==e.m_panel.m_linkedViews[o].update&&(e.m_panel.m_linkedViews[o].panel.Pause(!1),e.m_panel.m_linkedViews[o].panel.Update(null,t.Interaction.mouseover),e.m_panel.m_linkedViews[o].panel instanceof t.DataBar&&e.m_panel.m_linkedViews[o].panel.Update({shapeRef:e},t.Interaction.click),e.m_panel.m_linkedViews[o].panel.Update(i,t.Interaction.mouseover)),e.m_panel.m_linkedViews[o].panel.Pause(!0)}break;case t.Interaction.mouseout:}else switch(s){case t.Interaction.mouseover:break;case t.Interaction.click:case t.Interaction.dblclick:e.m_panel.Pause(!0);for(var o=0;o<e.m_panel.m_linkedViews.length;o++)e.m_panel.m_linkedViews[o].panel.Pause(!0);break;case t.Interaction.mouseout:e.m_panel.Update(null,t.Interaction.mouseover,!0);for(var o=0;o<e.m_panel.m_linkedViews.length;o++)e.m_panel.m_linkedViews[o].panel.Update(null,t.Interaction.mouseover)}},t.TopicTile.prototype.s_tileDims={width:300,height:100},t.TopicTile.prototype.s_topicCircleRadius=15,t.MetaDataTile=function(e,i,s,o,a,n,r,l){t.DataTile.apply(this,arguments),this.m_text=r,this.m_value=l},t.MetaDataTile.inherits(t.DataTile),t.MetaDataTile.method("Draw",function(e){this.m_shapeGroup=this.m_panel.m_tileGroup.append("g").attr("class",t.DataBar.prototype.s_datashapeClassName).attr("id",t.DataBar.prototype.s_datashapeClassName+"_"+this.m_name),this.m_shapeGroup.append("rect").attr("x",this.m_coordinates.x+t.DataBar.prototype.s_elementSpacing).attr("y",this.m_coordinates.y+t.DataBar.prototype.s_elementSpacing).attr("width",this.m_panel.m_size.width-2*t.DataBar.prototype.s_elementSpacing).attr("height",t.MetaDataTile.prototype.s_tileDims.height).style("fill",t.Level.prototype.s_palette.tile),this.m_title=this.m_shapeGroup.append("text").attr("x",this.m_coordinates.x+2*t.DataBar.prototype.s_elementSpacing).attr("y",this.m_coordinates.y+3*t.DataBar.prototype.s_elementSpacing),this.m_title.append("tspan").html(this.m_text+":&nbsp;").attr("fill",t.Level.prototype.s_palette.gold).style("font-family",t.Level.prototype.s_fontFamily).style("font-size",21),this.m_title.append("tspan").html(e?this.m_value.toFixed(3):this.m_value).attr("fill",t.Level.prototype.s_palette.lightpurple).style("font-family",t.Level.prototype.s_fontFamily).style("font-size",21)}),t.MetaDataTile.method("ResizeOverTime",function(e){this.m_shapeGroup.selectAll("rect").transition().duration(e.duration).attr("x",this.m_coordinates.x+t.DataBar.prototype.s_elementSpacing).attr("y",this.m_coordinates.y+t.DataBar.prototype.s_elementSpacing).attr("width",e.size.width)}),t.MetaDataTile.prototype.s_tileDims={width:300,height:50},t.WordWeightTile=function(e,i,s,o,a,n,r,l,h){t.DataTile.apply(this,arguments),this.m_topicID=r,this.m_text=l,this.m_value=h},t.WordWeightTile.inherits(t.DataTile),t.WordWeightTile.method("Draw",function(e){this.m_shapeGroup=this.m_panel.m_tileGroup.append("g").attr("class",t.DataBar.prototype.s_datashapeClassName).attr("id",t.DataBar.prototype.s_datashapeClassName+"_"+this.m_name).datum({topicID:this.m_topicID,color:this.m_level.m_topicColors[this.m_topicID],tileRef:this}).on(t.Interaction.click,function(e){this.m_clickTimerID?(clearTimeout(this.m_clickTimerID),this.m_clickTimerID=null,t.WordWeightTile.prototype.MouseBehavior(this,e,t.Interaction.dblclick)):this.m_clickTimerID=setTimeout(function(e){this.m_clickTimerID=null,t.WordWeightTile.prototype.MouseBehavior(this,e,t.Interaction.click)}.bind(this,e),250)}.bind(this)).on(t.Interaction.mouseover,function(e){t.WordWeightTile.prototype.MouseBehavior(this,e,t.Interaction.mouseover)}.bind(this)).on(t.Interaction.mouseout,function(){t.WordWeightTile.prototype.MouseBehavior(this,null,t.Interaction.mouseout)}.bind(this)),this.m_shapeGroup.append("rect").attr("x",this.m_coordinates.x).attr("y",this.m_coordinates.y+t.DataBar.prototype.s_elementSpacing).attr("width",this.m_panel.m_size.width).attr("height",t.WordWeightTile.prototype.s_tileDims.height+t.DataBar.prototype.s_elementSpacing).attr("fill",t.Level.prototype.s_palette.darkblue).style("opacity",0),this.m_shapeGroup.append("rect").attr("x",this.m_coordinates.x+t.DataBar.prototype.s_elementSpacing).attr("y",this.m_coordinates.y+t.DataBar.prototype.s_elementSpacing).attr("width",this.m_panel.m_size.width-2*t.DataBar.prototype.s_elementSpacing).attr("height",t.WordWeightTile.prototype.s_tileDims.height).style("fill",t.Level.prototype.s_palette.tile),this.m_highlightRect=this.m_shapeGroup.append("rect").attr("x",this.m_coordinates.x+t.DataBar.prototype.s_elementSpacing).attr("y",this.m_coordinates.y+t.DataBar.prototype.s_elementSpacing).attr("width",this.m_panel.m_size.width-2*t.DataBar.prototype.s_elementSpacing).attr("height",t.WordWeightTile.prototype.s_tileDims.height).style("fill",t.ShadeBlend(TWiC.DataShape.prototype.s_colorHighlight,t.Level.prototype.s_palette.tile)).style("opacity",0),this.m_title=this.m_shapeGroup.append("text").attr("x",this.m_coordinates.x+2*t.DataBar.prototype.s_elementSpacing).attr("y",this.m_coordinates.y+3*t.DataBar.prototype.s_elementSpacing),this.m_title.append("tspan").html(this.m_text).attr("fill",this.m_level.m_topicColors[this.m_topicID]).style("font-family",t.Level.prototype.s_fontFamily).style("font-size",21);var i=this.m_value/e*(t.WordWeightTile.prototype.s_tileDims.width-2*t.DataBar.prototype.s_elementSpacing);this.m_proportion=this.m_shapeGroup.append("rect").attr("class","wordweight_tile_proportion").attr("x",this.m_coordinates.x+3*t.WordWeightTile.prototype.s_topicCircleRadius).attr("y",this.m_coordinates.y+4*t.DataBar.prototype.s_elementSpacing).attr("width",i).attr("height",2*t.DataBar.prototype.s_elementSpacing).style("fill",this.m_level.m_topicColors[this.m_topicID]),this.m_proportionText=this.m_shapeGroup.append("text").attr("x",this.m_coordinates.x+i+4*t.WordWeightTile.prototype.s_topicCircleRadius).attr("y",this.m_coordinates.y+5.5*t.DataBar.prototype.s_elementSpacing),this.m_proportionText.append("tspan").html(this.m_value.toFixed(3)+"&nbsp;%").attr("fill",t.Level.prototype.s_palette.gold).style("font-family",t.Level.prototype.s_fontFamily).style("font-size",21).style("font-weight","bold")}),t.WordWeightTile.method("HighlightTile",function(t){var e=t?1:0;this.m_highlightRect.style("opacity",e)}),t.WordWeightTile.method("ResizeOverTime",function(e){this.m_shapeGroup.selectAll("rect").filter(function(){return"wordweight_tile_proportion"!=d3.select(this).attr("class")}).transition().duration(e.duration).attr("x",this.m_coordinates.x+t.DataBar.prototype.s_elementSpacing).attr("y",this.m_coordinates.y+t.DataBar.prototype.s_elementSpacing).attr("width",e.size.width)}),t.WordWeightTile.prototype.MouseBehavior=function(e,i,s){if(-1==e.m_level.m_highlightedTopic)switch(s){case t.Interaction.mouseover:e.m_panel.Update(i,t.Interaction.mouseover,!0);for(var o=0;o<e.m_panel.m_linkedViews.length;o++)t.Interaction.mouseover==e.m_panel.m_linkedViews[o].update&&e.m_panel.m_linkedViews[o].panel.Update(i,t.Interaction.mouseover);break;case t.Interaction.click:case t.Interaction.dblclick:e.m_panel.Pause(!1),e.m_panel.Update(i,t.Interaction.mouseover,!0),e.m_panel.Pause(!0);for(var o=0;o<e.m_panel.m_linkedViews.length;o++)t.Interaction.mouseover==e.m_panel.m_linkedViews[o].update&&(e.m_panel.m_linkedViews[o].panel.Pause(!1),e.m_panel.m_linkedViews[o].panel.Update(i,t.Interaction.mouseover)),e.m_panel.m_linkedViews[o].panel.Pause(!0);break;case t.Interaction.mouseout:}else if(e.m_panel.IsPaused())switch(s){case t.Interaction.mouseover:break;case t.Interaction.click:case t.Interaction.dblclick:if(i.topicID==e.m_level.m_highlightedTopic){e.m_panel.Pause(!1),e.m_panel.Update(null,t.Interaction.mouseover,!0);for(var o=0;o<e.m_panel.m_linkedViews.length;o++)e.m_panel.m_linkedViews[o].panel.Pause(!1),e.m_panel.m_linkedViews[o].panel.Update(null,t.Interaction.mouseover)}else{e.m_panel.Pause(!1),e.m_panel.Update(null,t.Interaction.mouseover,!0),e.m_panel.Update(i,t.Interaction.mouseover,!0),e.m_panel.Pause(!0);for(var o=0;o<e.m_panel.m_linkedViews.length;o++)t.Interaction.mouseover==e.m_panel.m_linkedViews[o].update&&(e.m_panel.m_linkedViews[o].panel.Pause(!1),e.m_panel.m_linkedViews[o].panel.Update(null,t.Interaction.mouseover),e.m_panel.m_linkedViews[o].panel instanceof t.DataBar&&e.m_panel.m_linkedViews[o].panel.Update({shapeRef:e},t.Interaction.click),e.m_panel.m_linkedViews[o].panel.Update(i,t.Interaction.mouseover)),e.m_panel.m_linkedViews[o].panel.Pause(!0)}break;case t.Interaction.mouseout:}else switch(s){case t.Interaction.mouseover:break;case t.Interaction.click:case t.Interaction.dblclick:e.m_panel.Pause(!0);for(var o=0;o<e.m_panel.m_linkedViews.length;o++)e.m_panel.m_linkedViews[o].panel.Pause(!0);break;case t.Interaction.mouseout:e.m_panel.Update(null,t.Interaction.mouseover,!0);for(var o=0;o<e.m_panel.m_linkedViews.length;o++)e.m_panel.m_linkedViews[o].panel.Update(null,t.Interaction.mouseover)}},t.WordWeightTile.prototype.s_tileDims={width:300,height:100},t.WordWeightTile.prototype.s_topicCircleRadius=15,t}(TWiC||{}),TWiC=function(t){return t.s_domPrefix="twic_",t.s_lastUsedID=-1,t.Interaction={mouseover:"mouseover",mouseout:"mouseout",click:"click",dblclick:"dblclick"},t.ColorToHex=function(t){if("#"===t.substr(0,1))return t;var e=/(.*?)rgb\((\d+), (\d+), (\d+)\)/.exec(t),i=parseInt(e[2]),s=parseInt(e[3]),o=parseInt(e[4]),a=o|s<<8|i<<16;return e[1]+"#"+a.toString(16)},t.GetAvailableScreenSpace=function(){return{width:window.innerWidth,height:window.innerHeight}},t.GetUniqueID=function(){return t.s_lastUsedID++,t.s_domPrefix+t.s_lastUsedID.toString()},t.GetViewport=function(){var t=window,e="inner";return"innerWidth"in window||(e="client",t=document.documentElement||document.body),{width:t[e+"Width"],height:t[e+"Height"]}},t.ShadeBlend=function(t,e,i){var s=0>t?-1*t:t,o=Math.round,a=parseInt;if(null==e.length);if(e.length>7){var n=e.split(","),r=(i?i:0>t?"rgb(0,0,0)":"rgb(255,255,255)").split(","),l=a(n[0].slice(4)),h=a(n[1]),m=a(n[2]);return"rgb("+(o((a(r[0].slice(4))-l)*s)+l)+","+(o((a(r[1])-h)*s)+h)+","+(o((a(r[2])-m)*s)+m)+")"}var n=a(e.slice(1),16),r=a((i?i:0>t?"#000000":"#FFFFFF").slice(1),16),p=n>>16,_=n>>8&255,c=255&n;return"#"+(16777216+65536*(o(((r>>16)-p)*s)+p)+256*(o(((r>>8&255)-_)*s)+_)+(o(((255&r)-c)*s)+c)).toString(16).slice(1)},t.Container=function(e,i,s){this.m_coordinates={x:e.x,y:e.y},this.m_controlBar=i,this.m_panel=s,this.m_level=this.m_panel.m_level,this.m_name=t.GetUniqueID()},t.Container.method("Initialize",function(t){if(null!=this.m_controlBar)switch(this.m_controlBar.DetermineDimensions(),this.m_controlBar.m_orientation){case"top":case"bottom":this.m_size={width:this.m_panel.m_size.width,height:this.m_panel.m_size.height+this.m_controlBar.m_size.height};break;case"left":case"right":this.m_size={width:this.m_panel.m_size.width+this.m_controlBar.m_size.width,height:this.m_panel.m_size.height}}else this.m_size={width:this.m_panel.m_size.width,height:this.m_panel.m_size.height};this.m_div=t.append("div").attr("class","div_twic_container item").attr("id","div_twic_container_"+this.m_name).style("position","absolute").style("left",this.m_coordinates.x).style("top",this.m_coordinates.y).style("width",this.m_size.width).style("height",this.m_size.height).style("max-width",this.m_level.m_size.width).style("max-height",this.m_level.m_size.height).style("overflow","auto").on("mouseup",function(){this.m_level.m_resizeOccurred&&(this.m_level.m_resizeOccurred=!1,this.m_level.OrganizePanels())}.bind(this)),null!=this.m_controlBar&&this.m_controlBar.Initialize(this.m_div),this.m_panel.Initialize(this.m_div)}),t.Container.method("Update",function(t,e){this.m_panel.Update(t,e),null!=this.m_controlBar&&this.m_controlBar.Update(t,e)}),t.Container.method("Start",function(){this.m_panel.Start()}),t.Container.method("DeterminePosition",function(){if(this.m_controlBar)switch(this.m_controlBar.m_orientation){case"top":case"bottom":this.m_coordinates.y-=this.m_controlBar.m_size.width;break;case"left":this.m_coordinates.x-=this.m_controlBar.m_size.width}}),t.Container.method("SetPosition",function(t){this.m_coordinates.x=t.x,this.m_coordinates.y=t.y}),t.Container.method("SetSize",function(t){
if(this.m_controlBar)switch(this.m_controlBar.DetermineDimensions(),this.m_controlBar.m_orientation){case"top":case"bottom":this.m_panel.SetSize({width:t.width,height:t.height-this.m_controlBar.m_size.height}),this.m_size.width=this.m_panel.m_size.width,this.m_size.height=this.m_panel.m_size.height+this.m_controlBar.m_size.height;break;case"left":case"right":this.m_panel.SetSize({width:t.width-this.m_controlBar.m_size.width,height:t.height}),this.m_size.width=this.m_panel.m_size.width+this.m_controlBar.m_size.width,this.m_size.height=this.m_panel.m_size.height}else this.m_size={width:t.width,height:t.height},this.m_panel.SetSize({width:t.width,height:t.height})}),t.Level=function(){this.m_queue=new queue,this.m_coordinates={x:0,y:0},this.m_size={width:0,height:0},this.m_name="",this.m_div=null,this.m_objectCount=0,this.m_highlightedTopic=-1,this.m_graphViews=[],this.m_infoViews=[],this.m_corpusMap={},this.m_corpusInfo={},this.m_topicWordLists={},this.m_topicColors={},this.m_controlBar=null,this.m_graphPauseList=[],this.m_infoPauseList=[],this.m_resizeOccurred=!1,this.m_dataBar=null},t.Level.method("AddControlBar",function(t,e){this.m_controlBar=new TWiC.Control(t,e),this.m_controlBar.Initialize(this.m_div),this.AddBarText()}),t.Level.method("AddBarText",function(){this.m_controlBar.AddText(function(e){e.m_barText=e.m_controlGroup.append("text").attr("x",e.m_barThickness>>1).attr("y",.65*e.m_barThickness),e.m_barText.append("tspan").html("T").attr("fill",t.Level.prototype.s_palette.purple).style("font-family",t.Level.prototype.s_fontFamily).style("font-size",21).style("font-weight","bold"),e.m_barText.append("tspan").html("opic&nbsp;").attr("fill",t.Level.prototype.s_palette.purple).style("font-family",t.Level.prototype.s_fontFamily).style("font-size",21),e.m_barText.append("tspan").html("W").attr("fill",t.Level.prototype.s_palette.purple).style("font-family",t.Level.prototype.s_fontFamily).style("font-size",21).style("font-weight","bold"),e.m_barText.append("tspan").html("ords&nbsp;in&nbsp;").attr("fill",t.Level.prototype.s_palette.purple).style("font-family",t.Level.prototype.s_fontFamily).style("font-size",21),e.m_barText.append("tspan").html("C").attr("fill",t.Level.prototype.s_palette.purple).style("font-family",t.Level.prototype.s_fontFamily).style("font-size",21).style("font-weight","bold"),e.m_barText.append("tspan").html("ontext&nbsp;").attr("fill",t.Level.prototype.s_palette.purple).style("font-family",t.Level.prototype.s_fontFamily).style("font-size",21),e.m_barText.append("tspan").html("Corpus:&nbsp;").attr("fill",t.Level.prototype.s_palette.brown).style("font-family",t.Level.prototype.s_fontFamily).style("font-size",21),e.m_barText.append("tspan").html(this.m_corpusMap.name).attr("fill",t.Level.prototype.s_palette.lightblue).style("font-family",t.Level.prototype.s_fontFamily).style("font-size",21).style("font-weight","bold")}.bind(this))}),t.Level.method("AddDataToSpanBasedOnColor",function(t){var e=this.FindTopicIDByColor(t.style.color),i={color:t.style.color,topicID:e,locolor:this.m_topicColorsLoBlend[e],word:t.innerText};return d3.select(t).datum(i),i}),t.Level.method("AddPanel",function(e){var i=null;(e instanceof t.GraphView||e instanceof t.DataBar)&&(i=new t.Control(t.Control.prototype.s_defaultThickness,"top"));var s=new t.Container({x:e.m_coordinates.x,y:e.m_coordinates.y},i,e);e.SetContainer(s),null!=i&&i.SetContainer(s),e instanceof t.InformationView?this.m_infoViews.push(s):this.m_graphViews.push(s)}),t.Level.method("FindTopicIDByColor",function(t){for(var e=TWiC.ColorToHex(t),i=0;i<this.m_topicColors.length;i++)if(e==this.m_topicColors[i])return i;return-1}),t.Level.method("GetDataBar",function(){return this.m_dataBar}),t.Level.method("SetDataBar",function(t){this.m_dataBar=t}),t.Level.method("LoadJSON",function(t,e,i){var s=null;this.m_queue.defer(function(e){d3.json(t,function(t,i){s=i,this.m_corpusInfo=s,this.m_topicWordLists=s.topic_info[0],this.m_topicColors=s.topic_info[1],this.PreblendTopicColors(),e(null,s)}.bind(this))}.bind(this));var o=null;this.m_queue.defer(function(t){d3.json(e,function(e,i){o=i,this.m_corpusMap=o,t(null,o)}.bind(this))}.bind(this));var a=null;this.m_queue.defer(function(t){d3.json(i,function(e,i){a=i,this.m_corpusWordWeights=a,t(null,a)}.bind(this))}.bind(this))}),t.Level.method("Initialize",function(e,i,s){this.m_coordinates=e,this.m_size=i,this.m_name=t.GetUniqueID();var o=TWiC.GetAvailableScreenSpace(),a={width:parseInt(100*this.m_size.width/o.width).toString()+"%",height:parseInt(100*this.m_size.height/o.height).toString()+"%"};this.m_div=s.append("div").attr("class","div_twic_level").attr("id","twic_level_"+this.m_name).style("position","relative").style("width",a.width).style("height",a.height).style("max-width",a.width).style("max-height",a.height);for(var n=0;n<this.m_graphViews.length;n++)this.m_graphViews[n].Initialize(this.m_div);for(var n=0;n<this.m_infoViews.length;n++)this.m_infoViews[n].Initialize(this.m_div),this.m_infoViews[n].m_panel instanceof t.DataBar&&this.SetDataBar(this.m_infoViews[n].m_panel);this.Packery()}),t.Level.method("Start",function(){this.m_queue.await(function(){for(var t=0;t<this.m_graphViews.length;t++)this.m_graphViews[t].Start();for(var t=0;t<this.m_infoViews.length;t++)this.m_infoViews[t].Start()}.bind(this))}),t.Level.method("Pause",function(t){for(var e=0;e<this.m_graphViews.length;e++)if(t&&!this.m_graphViews[e].m_panel.IsPaused())this.m_graphPauseList.push(e),this.m_graphViews[e].m_panel.Pause(!0);else if(!t)for(var i=0;i<this.m_graphPauseList.length;i++)e==this.m_graphPauseList[i]&&(this.m_graphPauseList.splice(i,1),this.m_graphViews[e].m_panel.Pause(!1));for(var e=0;e<this.m_infoViews.length;e++)if(t&&!this.m_infoViews[e].m_panel.IsPaused())this.m_infoPauseList.push(e),this.m_infoViews[e].m_panel.Pause(!0);else if(!t)for(var i=0;i<this.m_infoPauseList.length;i++)e==this.m_infoPauseList[i]&&(this.m_infoPauseList.splice(i,1),this.m_infoViews[e].m_panel.Pause(!1))}),t.Level.method("Update",function(e,i){if(t.Interaction.dblclick==i){switch(this.Pause(!0),this.m_graphViews.length){case 1:for(var s=0;s<this.m_graphViews.length;s++)this.m_graphViews[s].m_panel.IsHidden()&&this.m_graphViews[s].m_panel.Hide(!1);for(var s=0;s<this.m_infoViews.length;s++)this.m_infoViews[s].m_panel.IsHidden()&&this.m_infoViews[s].m_panel.Hide(!1);var o=this.m_size.width>>1,a=this.m_size.height>>1;this.m_size.height>>1<=this.m_infoViews[0].m_size.height&&(a=this.m_size.height-this.m_infoViews[0].m_size.height),n={position:{x:0,y:0},size:{width:o,height:a},duration:2e3},this.m_graphViews[0].m_panel.Move(n,"start",function(e,i,s){var o={position:{x:0,y:i},size:{width:(this.m_size.width>>1)+(this.m_size.width>>2),height:this.m_size.height-i},duration:2e3};this.m_infoViews[0].m_panel.Move(o,"start",function(e,i,s){o={position:{x:(this.m_size.width>>1)+(this.m_size.width>>2),y:i},size:{width:this.m_size.width>>2,height:this.m_size.height-i},duration:2e3},this.m_infoViews[1].m_panel.Move(o,"end",function(e,i,s){this.m_graphViews[0].m_panel.OpenUnderlyingPanel(s,{x:e,y:0},{width:e,height:i-t.Control.prototype.s_defaultThickness});for(var o=0;o<this.m_graphViews.length;o++)this.m_graphViews[o].Update({topicID:this.m_highlightedTopic,color:this.m_topicColors[this.m_highlightedTopic]},t.Interaction.mouseover),this.m_graphViews[o].m_panel.Pause(!0);for(var o=0;o<this.m_infoViews.length;o++)this.m_infoViews[o].Update({topicID:this.m_highlightedTopic,color:this.m_topicColors[this.m_highlightedTopic]},t.Interaction.mouseover),this.m_infoViews[o].m_panel.Pause(!0);var a=$(this.m_div[0]);a.packery("appended",[$(this.m_graphViews[1].m_div[0])]);var n=a.find(".item");a.packery("bindUIDraggableEvents",n),a.packery("reloadItems"),this.m_graphViews[1].m_panel.Pause(!1),this.m_graphViews[1].Update({topicID:this.m_highlightedTopic,color:this.m_topicColors[this.m_highlightedTopic]},t.Interaction.mouseover),this.m_graphViews[1].m_panel.Pause(!0)}.bind(this,e,i,s))}.bind(this,e,i,s))}.bind(this,o,a,e));break;case 2:for(var s=0;s<this.m_graphViews.length;s++)this.m_graphViews[s].m_panel.IsHidden()&&this.m_graphViews[s].m_panel.Hide(!1);for(var s=0;s<this.m_infoViews.length;s++)this.m_infoViews[s].m_panel.IsHidden()&&this.m_infoViews[s].m_panel.Hide(!1);var o=this.m_size.width>>1,a=this.m_size.height>>1,n={position:{x:0,y:0},size:{width:o,height:a},duration:2e3};this.m_graphViews[0].m_panel.Move(n,"start",function(e,i,s){n={position:{x:o,y:0},size:{width:o,height:a},duration:2e3},this.m_graphViews[1].m_panel.Move(n,"start",function(e,i,s){n={position:{x:e,y:i},size:{width:e,height:i>>1},duration:1500},this.m_infoViews[1].m_panel.Move(n,"end",function(){}),n={position:{x:e,y:this.m_size.height-(i>>1)},size:{width:o,height:i>>1},duration:2e3},this.m_infoViews[0].m_panel.Move(n,"start",function(e,i,s){this.m_graphViews[1].m_panel.OpenUnderlyingPanel(s,{x:0,y:i},{width:e,height:i-t.Control.prototype.s_defaultThickness});for(var o=0;o<this.m_graphViews.length;o++)this.m_graphViews[o].m_panel.Pause(!1),this.m_graphViews[o].Update({topicID:this.m_highlightedTopic,color:this.m_topicColors[this.m_highlightedTopic]},t.Interaction.mouseover),this.m_graphViews[o].m_panel.Pause(!0);for(var o=0;o<this.m_infoViews.length;o++)this.m_infoViews[o].m_panel.Pause(!1),this.m_infoViews[o].Update({topicID:this.m_highlightedTopic,color:this.m_topicColors[this.m_highlightedTopic]},t.Interaction.mouseover),this.m_infoViews[o].m_panel.Pause(!0);var a=$(this.m_div[0]);a.packery("appended",[$(this.m_graphViews[2].m_div[0])]);var n=a.find(".item");a.packery("bindUIDraggableEvents",n),a.packery("reloadItems"),this.m_graphViews[2].m_panel.Pause(!1),this.m_graphViews[2].Update({topicID:this.m_highlightedTopic,color:this.m_topicColors[this.m_highlightedTopic]},t.Interaction.mouseover),this.m_graphViews[2].m_panel.Pause(!0)}.bind(this,o,a,s))}.bind(this,o,a,s))}.bind(this,o,a,e));break;case 3:for(var s=0;s<this.m_graphViews.length;s++)this.m_graphViews[s].m_panel.IsHidden()&&this.m_graphViews[s].m_panel.Hide(!1);for(var s=0;s<this.m_infoViews.length;s++)this.m_infoViews[s].m_panel.IsHidden()&&this.m_infoViews[s].m_panel.Hide(!1);var r=t.TopicBar.prototype.s_minHeight,o=this.m_size.width>>1,a=(this.m_size.height>>1)-(r>>1),n={position:{x:0,y:0},size:{width:o,height:a},duration:2e3};this.m_graphViews[0].m_panel.Move(n,"start",function(e,i){n={position:{x:e,y:0},size:{width:e,height:i},duration:2e3},this.m_graphViews[1].m_panel.Move(n,"start",function(e,i){n={position:{x:0,y:i+t.TopicBar.prototype.s_minHeight},size:{width:e,height:i},duration:2e3},this.m_graphViews[2].m_panel.Move(n,"start",function(t,e){}.bind(this,e,i))}.bind(this,e,i))}.bind(this,o,a)),n={position:{x:o,y:this.m_size.height-t.TopicBar.prototype.s_minHeight},size:{width:o,height:t.TopicBar.prototype.s_minHeight},duration:1500},this.m_infoViews[0].m_panel.Move(n,"end",function(e,i,s){n={position:{x:0,y:s},size:{width:i,height:t.TopicBar.prototype.s_minHeight},duration:1500},this.m_infoViews[0].m_panel.Move(n,"start",function(e,i,s){n={position:{x:i,y:s},size:{width:i,height:t.TopicBar.prototype.s_minHeight},duration:1e3},this.m_infoViews[1].m_panel.Move(n,"end",function(e,i,s){this.m_graphViews[2].m_panel.OpenUnderlyingPanel(e,{x:i,y:s+t.TopicBar.prototype.s_minHeight},{width:i,height:s-t.Control.prototype.s_defaultThickness});for(var o=-1==this.m_highlightedTopic?e.topicID:this.m_highlightedTopic,a={json:e.json,clusterIndex:e.clusterIndex,topicID:o,color:this.m_topicColors[o]},n=0;n<this.m_graphViews.length;n++)this.m_graphViews[n].Update(a,t.Interaction.mouseover),this.m_graphViews[n].m_panel.Pause(!0);for(var n=0;n<this.m_infoViews.length;n++)this.m_infoViews[n].Update(a,t.Interaction.mouseover),this.m_infoViews[n].m_panel.Pause(!0);var r=$(this.m_div[0]);r.packery("appended",[$(this.m_graphViews[3].m_div[0])]);var l=r.find(".item");r.packery("bindUIDraggableEvents",l),r.packery("reloadItems")}.bind(this,e,i,s))}.bind(this,e,i,s))}.bind(this,e,o,a));break;case 4:}this.Pause(!1)}}),t.Level.method("OrganizePanels",function(){$(this.m_div[0]).packery()}),t.Level.method("Packery",function(){var t=$(this.m_div[0]);t.packery({columnWidth:0,rowHeight:0});var e=t.find(".div_twic_container");t.packery("bindUIDraggableEvents",e)}),t.Level.method("PreblendTopicColors",function(){this.m_topicColorsLoBlend=[];for(var e=0;e<this.m_topicColors.length;e++)this.m_topicColorsLoBlend.push(t.ShadeBlend(TWiC.DataShape.prototype.s_colorLolight,this.m_topicColors[e]))}),t.Level.prototype.s_fontFamily="Inconsolata",t.Level.prototype.s_fontFamilyAlt="Fenwick",t.Level.prototype.s_fontSpacing={Inconsolata:"-3px"},t.Level.prototype.s_palette={darkblue:"#002240",gold:"#FAFAD2",purple:"#7F3463",brown:"#4C2F2E",green:"#17A31A",lightblue:"#19A2AE",beige:"#DFDAC4",lightpurple:"#D8D8FF",logold:t.ShadeBlend(-.5,"#FAFAD2"),deeppurple:"#15053C",hide:"#FB4645",minimize:"#FDB124",maximize:"#28C231",hide_highlight:"#3B0002",min_highlight:"#864502",max_highlight:"#0B5401",tile:"#0A2D50",link:"lightgray"},t.Level.prototype.s_twicLevels=[],t.Level.prototype.s_jsonDirectory="data/dickinson/input/json/",t.Level.prototype.Instance=function(){var e=new t.Level;return t.Level.prototype.s_twicLevels.push(e),e},t}(TWiC||{}),TWiC=function(t){return t.Panel=function(e,i,s){this.m_coordinates=e,this.m_size=i,this.m_name=t.GetUniqueID(),this.m_level=s,this.m_linkedViews=[],this.m_div=null,this.m_svg=null,this.m_groupOverlay=null,this.m_panelRect=null,this.m_paused=!1,this.m_controlBar=null,this.m_underlyingPanelOpen=!1,this.m_hidden=!1,null!=this.m_level&&this.m_level.AddPanel(this)},t.Panel.method("Initialize",function(){}),t.Panel.method("Start",function(){}),t.Panel.method("Update",function(t,e){}),t.Panel.method("Pause",function(t){this.m_paused=t}),t.Panel.method("IsPaused",function(){return this.m_paused}),t.Panel.method("IsUnderlyingPanelOpen",function(){return this.m_underlyingPanelOpen}),t.Panel.method("SetContainer",function(t){this.m_container=t,this.m_controlBar=this.m_container.m_controlBar}),t.Panel.method("SetPosition",function(t){this.m_coordinates.x=t.x,this.m_coordinates.y=t.y}),t.Panel.method("SetSize",function(t){this.m_size.width=t.width,this.m_size.height=t.height}),t.Panel.method("AddBarText",function(){}),t.Panel.method("AddLinkedView",function(t,e){this.m_linkedViews.push({panel:t,update:e})}),t.Panel.method("GetRectPath",function(e){switch(e){case"top":var i=t.TopRoundedRect(this.m_coordinates.x,this.m_coordinates.x,this.m_size.width,this.m_size.height,t.Panel.prototype.s_borderRadius);break;case"bottom":var i=t.BottomRoundedRect(this.m_coordinates.x,this.m_coordinates.y,this.m_size.width,this.m_size.height,t.Panel.prototype.s_borderRadius);break;case"left":var i=t.LeftRoundedRect(this.m_coordinates.x,this.m_coordinates.y,this.m_size.width,this.m_size.height,t.Panel.prototype.s_borderRadius);break;case"right":var i=t.RightRoundedRect(this.m_coordinates.x,this.m_coordinates.y,this.m_size.width,this.m_size.height,t.Panel.prototype.s_borderRadius)}return i}),t.Panel.method("Hide",function(e){if(e){this.m_recentDims={width:this.m_size.width,height:this.m_size.height+this.m_controlBar.m_size.height},this.m_recentPos={x:parseFloat(this.m_container.m_div.style("left")),y:parseFloat(this.m_container.m_div.style("top"))};var i={position:{x:this.m_recentPos.x,y:this.m_recentPos.y},size:{width:t.Panel.prototype.s_minimumPanelSize,height:t.Control.prototype.s_defaultThickness},duration:500};this.ToggleResize(!0)}else{this.m_recentPos={x:parseFloat(this.m_container.m_div.style("left")),y:parseFloat(this.m_container.m_div.style("top"))};var i={position:{x:this.m_recentPos.x,y:this.m_recentPos.y},size:{width:this.m_recentDims.width,height:this.m_recentDims.height},duration:500};this.ToggleResize(!1)}this.m_hidden=e,this.AddBarText(this.m_hidden),this.m_hidden?this.Move(i,"end",function(){$(this.m_level.m_div[0]).packery(),this.m_controlBar.m_barPath.transition().duration(10).attr("d",t.FullyRoundedRect(this.m_coordinates.x,this.m_coordinates.y,this.m_container.m_size.width,t.Control.prototype.s_defaultThickness,t.Panel.prototype.s_borderRadius))}.bind(this)):(this.m_controlBar.m_barPath.attr("d",t.TopRoundedRect(this.m_coordinates.x,this.m_coordinates.y,this.m_container.m_size.width,t.Control.prototype.s_defaultThickness,t.Panel.prototype.s_borderRadius)),this.Move(i,"end",function(){$(this.m_level.m_div[0]).packery()}.bind(this)))}),t.Panel.method("IsHidden",function(){return this.m_hidden}),t.Panel.method("MakeDraggable",function(){$(this.m_container.m_div[0]).draggable({start:function(){this.m_level.Pause(!0)}.bind(this),drag:function(){this.m_container.m_div.node().parentNode.appendChild(this.m_container.m_div.node()),this.m_level.Pause()}.bind(this),stop:function(){this.m_level.Pause(!1)}.bind(this)})}),t.Panel.method("MakeResizable",function(e){void 0===e&&(e=!0);var i=t.Panel.prototype.s_minimumPanelSize,s=t.Panel.prototype.s_minimumPanelSize;$(this.m_container.m_div[0]).resizable({alsoResize:"#"+$(this.m_container.m_div[0]).attr("id")+" .div_twic_control .twic_panel",aspectRatio:e,autoHide:!0,minWidth:i,minHeight:s,maxWidth:this.m_level.m_size.width,maxHeight:this.m_level.m_size.height,handles:"n, s, e, w, nw, ne, sw, se",resize:function(){this.OnResize(!1),this.m_level.m_resizeOccurred=!0}.bind(this)})}),t.Panel.method("Maximize",function(){this.m_hidden&&(this.m_hidden=!1,this.AddBarText(this.m_hidden),this.m_panelRectDiv.style("opacity",1));var t={size:{width:this.m_level.m_size.width,height:this.m_level.m_size.height},duration:1500};this.m_container.m_div.transition().duration(t.duration).style("width",t.size.width).style("height",t.size.height).tween("maximize-components",function(){return function(){this.OnResize(!1)}.bind(this)}.bind(this)).each("end",function(){this.m_level.OrganizePanels()}.bind(this))}),t.Panel.method("Minimize",function(){this.m_hidden&&(this.ToggleResize(!1),this.m_hidden=!1,this.AddBarText(this.m_hidden),this.m_panelRectDiv.style("opacity",1));var e={size:{width:t.Panel.prototype.s_minimumPanelSize,height:t.Panel.prototype.s_minimumPanelSize},duration:1500};this.m_container.m_div.transition().duration(e.duration).style("width",e.size.width).style("height",e.size.height).tween("minimize-components",function(){return function(){this.OnResize(!1)}.bind(this)}.bind(this)).each("end",function(){this.m_level.OrganizePanels()}.bind(this))}),t.Panel.method("Move",function(e,i,s){e.position&&this.m_container.SetPosition(e.position),e.size&&this.m_container.SetSize(e.size),this.m_container.m_div.transition().duration(e.duration).style("left",this.m_container.m_coordinates.x).style("top",this.m_container.m_coordinates.y).style("width",this.m_container.m_size.width).style("height",this.m_container.m_size.height),this.m_div.transition().duration(e.duration).style("width",this.m_size.width).style("height",this.m_size.height).each("start",function(e,i,s){this.m_panelRectDiv.transition().duration(e.duration).style("width",e.size.width).style("height",e.size.height-this.m_controlBar.m_size.height),this.m_panelRectSvg.transition().duration(e.duration).attr("width",e.size.width).attr("height",e.size.height-this.m_controlBar.m_size.height).attr("viewBox","0 0 "+e.size.width+" "+(e.size.height-this.m_controlBar.m_size.height)),this.m_panelRect.transition().duration(e.duration).attr("d",t.BottomRoundedRect(0,0,e.size.width,e.size.height-this.m_controlBar.m_size.height,t.Panel.prototype.s_borderRadius)),this.m_svg.transition().duration(e.duration).attr("width",this.m_size.width).attr("height",this.m_size.height).each("end",function(){"end"==i&&s()}.bind(this,i,s)),"start"==i&&s()}.bind(this,e,i,s)),this.m_controlBar.m_size.width=this.m_size.width,this.m_controlBar.m_div.transition().duration(e.duration).style("width",this.m_size.width).each("start",function(t){this.m_controlBar.m_barPath.transition().duration(t.duration).attr("d",this.m_controlBar.GetRectPath()),this.m_controlBar.m_svg.transition().duration(t.duration).attr("width",this.m_size.width).attr("viewBox","0 0 "+this.m_size.width+" "+this.m_controlBar.m_size.height)}.bind(this,e))}),t.Panel.method("OnResize",function(e){var i=!0;void 0!==e&&(i=e);var s=parseFloat(this.m_container.m_div.style("width")),o=parseFloat(this.m_container.m_div.style("height")),a=this.m_controlBar?this.m_controlBar.m_size.height:0;this.m_controlBar&&(this.m_controlBar.m_size.width=s,this.m_controlBar.m_div.style("width",s),this.m_controlBar.m_svg.attr("width",s).attr("viewBox","0 0 "+s+" "+a)),this.m_size.width=Math.abs(s),this.m_size.height=Math.abs(o-a);var n=this.m_size.width,r=this.m_size.height;this.m_div.style("width",n).style("height",r),this.m_svg.attr("width",n).attr("height",r),this.m_panelRectDiv.style("width",n).style("height",r),this.m_panelRectSvg.attr("width",n).attr("height",r).attr("viewBox","0 0 "+n+" "+r),s>parseInt(this.m_div.style("max-width"))&&(this.m_div.style("max-width",s),this.m_panelRectDiv.style("max-width",s)),o>parseInt(this.m_div.style("max-height")+a)&&(this.m_div.style("max-height",o-a),this.m_panelRectDiv.style("max-height",o-a)),this.m_panelRect.attr("d",t.BottomRoundedRect(0,0,n,r,t.Panel.prototype.s_borderRadius)),this.m_container.m_div.node().parentNode.appendChild(this.m_container.m_div.node()),i&&$(this.m_level.m_div[0]).packery(),this.m_controlBar&&this.m_controlBar.UpdateBarPath(this.m_controlBar.GetRectPath()),$(this.m_level.m_div.node().parentNode).hide().show(0)}),t.Panel.method("OpenUnderlyingPanel",function(t,e,i){return null}),t.Panel.method("ReappendShapes",function(){}),t.Panel.method("ToggleResize",function(t){$(this.m_container.m_div[0]).resizable({disabled:t,handles:"n, s, e, w, nw, ne, sw, se"})}),t.Panel.prototype.GetTopNTopics=function(t,e){for(var i=[],s=0;e>s;s++)i.push([]);for(s in t)for(var o=0;e>o;o++)t[s][0]==o+1&&(i[o]=[s,t[s][1]]);return i},t.Panel.prototype.s_borderRadius=15,t.Panel.prototype.s_minimumPanelSize=500,t.Panel.prototype.s_panelLevelBuffer=50,t.GraphView=function(e,i,s){t.Panel.apply(this,arguments),this.m_largestShapeRadius=16},t.GraphView.inherits(t.Panel),t.GraphView.prototype.Collide=function(t){var e=15,i=t.radius+this.m_largestShapeRadius+e,s=t.x-i,o=t.x+i,a=t.y-i,n=t.y+i;return function(e,i,r,l,h){if(e.point&&e.point!==t){var m=t.x-e.point.x,p=t.y-e.point.y,_=Math.sqrt(m*m+p*p),c=t.radius+e.point.radius;c>_&&(_=(_-c)/_*.5,t.x-=m*=_,t.y-=p*=_,e.point.x+=m,e.point.y+=p)}return i>o||s>l||r>n||a>h}},t.GraphView.prototype.MouseBehavior=function(e,i,s){if(e.IsPaused())switch(s){case t.Interaction.mouseover:break;case t.Interaction.click:case t.Interaction.dblclick:e.Pause(!1),e.Update(null,t.Interaction.mouseover);for(var o=0;o<e.m_linkedViews.length;o++)e.m_linkedViews[o].panel.Pause(!1),e.m_linkedViews[o].panel.Update(null,t.Interaction.mouseover);break;case t.Interaction.mouseout:}else switch(s){case t.Interaction.mouseover:break;case t.Interaction.click:case t.Interaction.dblclick:break;case t.Interaction.mouseout:}},t.GraphView.prototype.s_datashapeClassName="graph_shape",t.GraphView.prototype.s_datashapeClassSelect=".graph_shape",t.GraphView.prototype.s_datashapeTextClassName="graph_shape_text",t.GraphView.prototype.s_datashapeTextClassSelect=".graph_shape_text",t.GraphView.prototype.s_linkDistanceMod=100,t.CorpusView=function(e,i,s,o,a){t.GraphView.apply(this,arguments),this.m_radius=o,this.m_numberTopics=a,this.m_corpusCluster=null,this.m_nodes=[]},t.CorpusView.inherits(t.GraphView),t.CorpusView.method("Initialize",function(e){var i=this.m_controlBar?this.m_controlBar.m_size.height-1:0;this.m_panelRectDiv=e.append("div").attr("class","div_panel_rect").attr("id","div_panel_rect_"+this.m_name).style("position","absolute").style("left",this.m_coordinates.x).style("top",this.m_coordinates.y+i).style("width",this.m_size.width).style("height",this.m_size.height).style("max-width",this.m_size.width).style("max-height",this.m_size.height).style("border-radius",t.Panel.prototype.s_borderRadius),this.m_panelRectSvg=this.m_panelRectDiv.append("svg").attr("x",this.m_coordinates.x).attr("y",this.m_coordinates.y).attr("width",this.m_size.width).attr("height",this.m_size.height).attr("viewBox","0 0 "+this.m_size.width+" "+this.m_size.height),this.m_panelRect=this.m_panelRectSvg.append("path").attr("d",t.BottomRoundedRect(0,0,this.m_size.width,this.m_size.height,t.Panel.prototype.s_borderRadius)).attr("class","rect_twic_graph").attr("id","rect_twic_graph_corpusview_"+this.m_name).attr("fill",t.Level.prototype.s_palette.darkblue),this.m_div=e.append("div").attr("class","div_twic_graph_corpusview div_twic_graph twic_panel").attr("id","div_twic_graph_corpusview_"+this.m_name).style("max-width",this.m_size.width).style("max-height",this.m_size.height).style("width",this.m_size.width).style("height",this.m_size.height).style("background","transparent").style("border-radius",t.Panel.prototype.s_borderRadius).style("position","absolute").style("left",this.m_coordinates.x).style("top",this.m_coordinates.y+i),this.m_svg=this.m_div.append("svg").attr("class","svg_twic_graph").attr("id","svg_twic_graph_corpusview_"+this.m_name).attr("x",this.m_coordinates.x).attr("y",this.m_coordinates.y).attr("width",this.m_size.width).attr("height",this.m_size.height).attr("viewBox","0 0 "+this.m_size.width+" "+this.m_size.height),this.m_groupOverlay=this.m_svg.append("g").attr("class","group_twic_graph_corpusview_overlay").attr("id","group_twic_graph_corpusview_overlay_"+this.m_name),this.m_clickRectangle=this.m_groupOverlay.append("rect").attr("x",0).attr("y",0).attr("width",this.m_size.width).attr("height",this.m_size.height).attr("fill",t.Level.prototype.s_palette.darkblue).style("opacity",0).on(t.Interaction.click,function(){t.GraphView.prototype.MouseBehavior(this,null,t.Interaction.click)}.bind(this)),this.m_corpusCluster=new TWiC.TopicBullseye({x:this.m_size.width>>1,y:this.m_size.height-.6*this.m_size.height},this.m_radius,this.m_level.m_corpusMap.name,this.m_level,this,this.m_linkedViews,this.m_numberTopics,this.m_level.m_corpusMap.topics,this.m_level.m_corpusMap.name,!0),this.AddBarText(!1)}),t.CorpusView.method("Start",function(e){this.m_nodes.push({index:0,name:this.m_name});var i=this.m_groupOverlay.selectAll(".node").data(this.m_nodes).enter().append("g").attr("class","node").attr("id",function(t){return"node_"+t.index}).attr("x",this.m_corpusCluster.m_coordinates.x).attr("y",this.m_corpusCluster.m_coordinates.y).style("position","absolute");this.m_corpusCluster.Draw(i,[this.m_name]),this.HighlightAllDataShapes(),this.m_corpusCluster.AddTextTag(this.m_corpusCluster.m_title,14+.2*this.m_corpusCluster.m_radius,t.Level.prototype.s_palette.gold,{x:this.m_corpusCluster.m_coordinates.x-1.7*this.m_corpusCluster.m_radius,y:this.m_corpusCluster.m_coordinates.y+this.m_corpusCluster.m_radius+.3*this.m_corpusCluster.m_radius},1,this.m_groupOverlay),this.MakeResizable(!1),this.MakeDraggable()}),t.CorpusView.method("Update",function(e,i){t.Interaction.mouseover==i?this.m_paused||(null!=e?this.HighlightAllDataShapesWithTopic(e):this.HighlightAllDataShapes()):t.Interaction.dblclick==i&&(this.IsUnderlyingPanelOpen()||(this.Pause(!1),this.Update({topicID:this.m_level.m_highlightedTopic,color:this.m_level.m_topicColors[this.m_level.m_highlightedTopic]},t.Interaction.mouseover),this.Pause(!0),this.m_level.m_infoViews[0].m_panel.Pause(!0),this.m_level.Update(e,i)))}),t.CorpusView.method("AddBarText",function(e){this.m_controlBar.AddText(function(i){i.m_barText&&i.m_barText.selectAll("*").remove(),this.m_textFirstSet||(this.m_textPos={x:i.GetNextWidgetPos().x,y:i.GetNextWidgetPos().y},this.m_textFirstSet=!0),e?(i.m_barText=i.m_controlGroup.append("text").attr("x",this.m_textPos.x).attr("y",this.m_textPos.y),i.m_barPath.attr("fill",t.Level.prototype.s_palette.darkblue).style("opacity",1),i.m_barText.append("tspan").html("TWiC:&nbsp;").attr("fill",t.Level.prototype.s_palette.lightpurple).style("font-family",t.Level.prototype.s_fontFamily).style("font-size",25),i.m_barText.append("tspan").html("Corpus View").attr("fill",t.Level.prototype.s_palette.gold).style("font-family",t.Level.prototype.s_fontFamily).style("font-size",25)):(i.m_barText=i.m_controlGroup.append("text").attr("x",this.m_textPos.x).attr("y",this.m_textPos.y),i.m_barPath.attr("fill",t.Level.prototype.s_palette.darkblue).style("opacity",1),i.m_barText.append("tspan").html("TWiC:&nbsp;").attr("fill",t.Level.prototype.s_palette.lightpurple).style("font-family",t.Level.prototype.s_fontFamily).style("font-size",25),i.m_barText.append("tspan").html("Top&nbsp;").attr("fill",t.Level.prototype.s_palette.gold).style("font-family",t.Level.prototype.s_fontFamily).style("font-size",25),i.m_barText.append("tspan").html(10).attr("fill",t.Level.prototype.s_palette.green).style("font-family",t.Level.prototype.s_fontFamily).style("font-size",28),i.m_barText.append("tspan").html("&nbsp;topics in&nbsp;").attr("fill",t.Level.prototype.s_palette.gold).style("font-family",t.Level.prototype.s_fontFamily).style("font-size",25),i.m_barText.append("tspan").html(this.m_level.m_corpusMap.name).attr("fill",t.Level.prototype.s_palette.lightblue).style("font-family",t.Level.prototype.s_fontFamily).style("font-size",25))}.bind(this))}),t.CorpusView.method("DarkenAllDataShapes",function(){this.m_svg.selectAll(TWiC.CorpusView.prototype.s_datashapeClassSelect).style("fill",function(t){return t.locolor}).style("opacity",TWiC.DataShape.prototype.s_semihighlightedOpacity)}),t.CorpusView.method("HighlightAllDataShapes",function(){this.m_level.m_highlightedTopic=-1,this.m_svg.selectAll(TWiC.CorpusView.prototype.s_datashapeClassSelect).style("opacity",1).style("fill",function(t){return t.color})}),t.CorpusView.method("HighlightAllDataShapesWithTopic",function(t){this.m_level.m_highlightedTopic=t.topicID;this.m_svg.selectAll(TWiC.CorpusView.prototype.s_datashapeClassSelect).filter(function(e){return e.topicID==t.topicID}).style("opacity",1).style("fill",t.color);this.m_svg.selectAll(TWiC.CorpusView.prototype.s_datashapeClassSelect).filter(function(e){return e.topicID!=t.topicID}).style("opacity",1).style("fill",function(t){return t.locolor})}),t.CorpusView.method("Move",function(e,i,s){e.position&&this.m_container.SetPosition(e.position),e.size&&this.m_container.SetSize(e.size),this.m_container.m_div.transition().duration(e.duration).style("left",this.m_container.m_coordinates.x).style("top",this.m_container.m_coordinates.y).style("width",this.m_container.m_size.width).style("height",this.m_container.m_size.height),this.m_div.transition().duration(e.duration).style("width",this.m_size.width).style("height",this.m_size.height).each("start",function(e,i,s){this.m_panelRectDiv.transition().duration(e.duration).style("width",e.size.width).style("height",e.size.height-this.m_controlBar.m_size.height),this.m_panelRectSvg.transition().duration(e.duration).attr("width",e.size.width).attr("height",e.size.height-this.m_controlBar.m_size.height).attr("viewBox","0 0 "+e.size.width+" "+(e.size.height-this.m_controlBar.m_size.height)),this.m_panelRect.transition().duration(e.duration).attr("d",t.BottomRoundedRect(0,0,e.size.width,e.size.height-this.m_controlBar.m_size.height,t.Panel.prototype.s_borderRadius)),this.m_svg.transition().duration(e.duration).attr("width",this.m_size.width).attr("height",this.m_size.height).each("end",function(t,e){"end"==t&&e()}.bind(this,i,s)),"start"==i&&s()}.bind(this,e,i,s)),this.m_controlBar.m_size.width=this.m_size.width,this.m_controlBar.m_div.transition().duration(e.duration).style("width",this.m_size.width).each("start",function(t){this.m_controlBar.m_barPath.transition().duration(t.duration).attr("d",this.m_controlBar.GetRectPath()),this.m_controlBar.m_svg.transition().duration(t.duration).attr("width",this.m_size.width).attr("viewBox","0 0 "+this.m_size.width+" "+this.m_controlBar.m_size.height)}.bind(this,e))}),t.CorpusView.method("OpenUnderlyingPanel",function(e,i,s){for(var o=new t.CorpusClusterView({x:i.x,y:i.y},{width:s.width,height:s.height},this.m_level),a=0;a<this.m_linkedViews.length;a++)this.m_linkedViews[a].panel instanceof t.InformationView&&t.Interaction.mouseover==this.m_linkedViews[a].update&&o.AddLinkedView(this.m_linkedViews[a].panel,t.Interaction.mouseover);
this.AddLinkedView(o,t.Interaction.mouseover),o.AddLinkedView(this,t.Interaction.mouseover),this.m_level.m_infoViews[0].m_panel.AddLinkedView(o,t.Interaction.click),this.m_level.m_infoViews[1].m_panel.AddLinkedView(o,t.Interaction.click),this.m_level.m_infoViews[1].m_panel.AddLinkedView(o,t.Interaction.mouseover),o.m_container.Initialize(this.m_level.m_div),o.m_container.m_div.transition().delay(100).style("top",o.m_container.m_div.style("top")),o.m_container.Start(),o.m_div.style("opacity",0),o.m_controlBar.m_div.style("opacity",0),o.m_panelRectDiv.style("opacity",0),o.m_div.transition().delay(500).duration(3e3).style("opacity",1),o.m_controlBar.m_div.transition().delay(500).duration(3e3).style("opacity",1),o.m_panelRectDiv.transition().delay(500).duration(3e3).style("opacity",1),o.Pause(!0),this.m_underlyingPanelOpen=!0}),t.CorpusView.prototype.s_datashapeClassName="corpus_shape",t.CorpusView.prototype.s_datashapeClassSelect=".corpus_shape",t.CorpusView.prototype.s_datashapeTextClassName="corpus_shape_text",t.CorpusView.prototype.s_datashapeTextClassSelect=".corpus_shape_text",t.CorpusClusterView=function(e,i,s){t.GraphView.apply(this,arguments),this.m_twicObjects=[],this.m_objectsJSON=[],this.m_nodes=[],this.m_links=[],this.m_graph=null,this.b_positionsCalculated=!1,this.m_rootIndex=-1},t.CorpusClusterView.inherits(t.GraphView),t.CorpusClusterView.method("Initialize",function(e){this.m_container.SetPosition(this.m_coordinates),this.m_container.m_div.style("left",this.m_container.m_coordinates.x),this.m_container.m_div.style("top",this.m_container.m_coordinates.y),this.m_coordinates.x=0,this.m_coordinates.y=0;var i=this.m_controlBar?this.m_controlBar.m_size.height-1:0;this.m_panelRectDiv=e.append("div").attr("class","div_panel_rect").attr("id","div_panel_rect_"+this.m_name).style("position","absolute").style("left",this.m_coordinates.x).style("top",this.m_coordinates.y+i).style("width",this.m_size.width).style("height",this.m_size.height).style("max-width",this.m_size.width).style("max-height",this.m_size.height).style("border-radius",t.Panel.prototype.s_borderRadius),this.m_panelRectSvg=this.m_panelRectDiv.append("svg").attr("x",this.m_coordinates.x).attr("y",this.m_coordinates.y).attr("width",this.m_size.width).attr("height",this.m_size.height).attr("viewBox","0 0 "+this.m_size.width+" "+this.m_size.height),this.m_panelRect=this.m_panelRectSvg.append("path").attr("d",t.BottomRoundedRect(this.m_coordinates.x,this.m_coordinates.y,this.m_size.width,this.m_size.height,t.Panel.prototype.s_borderRadius)).attr("class","rect_twic_graph").attr("id","rect_twic_graph_corpusclusterview_"+this.m_name).attr("fill",t.Level.prototype.s_palette.darkblue),this.m_div=e.append("div").attr("class","div_twic_graph_corpusclusterview div_twic_graph twic_panel").attr("id","div_twic_graph_corpusclusterview_"+this.m_name).style("max-width",this.m_size.width).style("max-height",this.m_size.height).style("width",this.m_size.width).style("height",this.m_size.height).style("border-radius",t.Panel.prototype.s_borderRadius).style("position","absolute").style("left",this.m_coordinates.x).style("top",this.m_coordinates.y+i),this.m_svg=this.m_div.append("svg").attr("class","svg_twic_graph").attr("id","svg_twic_graph_corpusclusterview_"+this.m_name).attr("x",this.m_coordinates.x).attr("y",this.m_coordinates.y).attr("width",this.m_size.width).attr("height",this.m_size.height).attr("viewBox","-50 -50 "+(this.m_size.width+100)+" "+(this.m_size.height+100)),this.m_groupOverlay=this.m_svg.append("g").attr("class","group_twic_graph_corpusclusterview_overlay").attr("id","group_twic_graph_corpusclusterview_overlay_"+this.m_name),this.m_clickRectangle=this.m_groupOverlay.append("rect").attr("x",-87).attr("y",-50).attr("width",this.m_size.width+175).attr("height",this.m_size.height+100).attr("fill",t.Level.prototype.s_palette.darkblue).style("opacity",0).style("position","absolute").on(t.Interaction.click,function(){t.GraphView.prototype.MouseBehavior(this,null,t.Interaction.click)}.bind(this)),this.InitializeGraph()}),t.CorpusClusterView.method("InitializeGraph",function(){var e=Object.keys(this.m_level.m_corpusMap.children).length,i=Math.sqrt(1/Math.PI*(this.m_size.width*this.m_size.height/e));i>>=1;for(var s=0,o=0;e>o;o++)s+=this.m_level.m_corpusMap.children[o].dist2avg;s/=Object.keys(this.m_level.m_corpusMap.children).length,this.m_rootIndex=0,this.m_nodes.push({index:this.m_rootIndex,name:"",radius:i});for(var a=[],n=10,o=0;n>o;o++)a.push([]);for(var r in this.m_level.m_corpusMap.topics)this.m_level.m_corpusMap.topics[r][0]<n+1&&(a[this.m_level.m_corpusMap.topics[r][0]-1]=[r,this.m_level.m_corpusMap.topics[r][1]]);var l=new TWiC.TopicBullseye({x:0,y:0},i,t.CorpusClusterView.prototype.s_infoFlavorText,this.m_level,this,this.m_linkedViews,n,this.m_level.m_corpusMap.topics,this.m_nodes[0].name,!0);l.SetScaledRadius(!0),l.m_allowDblclick=!1,this.m_twicObjects.push(l),this.m_nodes[0].radius=l.m_size,this.m_linkDistLimits={min:this.m_level.m_corpusMap.children[0].dist2avg+this.m_nodes[0].radius,max:this.m_level.m_corpusMap.children[0].dist2avg+this.m_nodes[0].radius};for(var o=1;e>o;o++)this.m_linkDistLimits.min=Math.min(this.m_linkDistLimits.min,this.m_level.m_corpusMap.children[o].dist2avg+this.m_nodes[0].radius),this.m_linkDistLimits.max=Math.max(this.m_linkDistLimits.max,this.m_level.m_corpusMap.children[o].dist2avg+this.m_nodes[0].radius);this.b_adjustDistances=this.m_linkDistLimits.min<0;var h=Math.min(this.m_size.width,this.m_size.height);this.m_adjustedDistances=[];for(var o=0;e>o;o++){var m=this.m_level.m_corpusMap.children[o].dist2avg;this.b_adjustDistances&&(m+=this.m_linkDistLimits.min),this.m_adjustedDistances.push(m)}for(var p=100/(this.m_linkDistLimits.max-this.m_linkDistLimits.min),o=0;o<this.m_adjustedDistances.length;o++)this.m_adjustedDistances[o]-=this.m_linkDistLimits.min,this.m_adjustedDistances[o]*=p;for(var o=0;e>o;o++){var _=new TWiC.TopicBullseye({x:0,y:0},i,this.m_level.m_corpusMap.children[o].name,this.m_level,this,this.m_linkedViews,10,this.m_level.m_corpusMap.children[o].topics,o.toString(),!1);_.SetScaledRadius(!0);var c={name:this.m_level.m_corpusMap.children[o].name,dist2avg:this.m_adjustedDistances[o]*h/100,topics:this.m_level.m_corpusMap.children[o].topics,children:[]};this.m_objectsJSON.push(c),this.m_twicObjects.push(_)}for(var o=1;o<=this.m_objectsJSON.length;o++)this.m_nodes.push({index:o,name:this.m_objectsJSON[o-1].name}),this.m_links.push({source:o,target:this.m_rootIndex,value:this.m_objectsJSON[o-1].dist2avg});this.m_graph=d3.layout.force().nodes(this.m_nodes).links(this.m_links).size([this.m_size.width,this.m_size.height]).charge(function(t){return-5*t.radius}).gravity(.06).linkDistance(function(t){return t.value}).on("end",function(){this.m_graph.stop()}.bind(this))}),t.CorpusClusterView.method("InitializeGraph_ArchimedeanSpiral",function(){}),t.CorpusClusterView.method("ReappendShapes",function(){for(var t=0;t<this.m_twicObjects.length;t++)this.m_twicObjects[t].ReappendShape()}),t.CorpusClusterView.method("Start",function(){this.m_groupOverlay.selectAll(".link").data(this.m_links).enter().append("line").attr("class","link").attr("id",function(t){return"link"+(t.source-1)}).style("stroke-width",.5).style("stroke",t.Level.prototype.s_palette.lightgray).style("opacity",TWiC.DataShape.s_semihighlightedOpacity);for(index=1;index<this.m_twicObjects.length;index++)for(var e=1;e<this.m_nodes.length;e++)if(parseInt(this.m_twicObjects[index].m_name)+1==this.m_nodes[e].index){this.m_nodes[e].radius=this.m_twicObjects[index].m_size;break}this.m_groupOverlay.selectAll(".node").data(this.m_nodes).enter().append("g").attr("class","node").style("position","absolute").attr("id",function(t){return"node_"+t.index});for(this.m_twicObjects[0].Draw(this.m_groupOverlay.select(".node#node_0"),[]),this.m_twicObjects[0].AddTextTag("",20,t.Level.prototype.s_palette.gold,{x:this.m_twicObjects[0].m_coordinates.x,y:this.m_twicObjects[0].m_coordinates.y},0),this.m_twicObjects[0].m_size>this.m_largestShapeRadius&&(this.m_largestShapeRadius=this.m_twicObjects[0].m_size),index=1;index<this.m_twicObjects.length;index++)for(var e=1;e<this.m_nodes.length;e++)if(this.m_twicObjects[index].m_name==this.m_nodes[e].name){var i=this.m_objectsJSON[index-1].children;this.m_twicObjects[index].Draw(this.m_groupOverlay.select(".node#node_"+e),i);var s=this.m_level.m_topicColors[index-1];this.m_twicObjects[index].AddTextTag(this.m_nodes[e].name.toString(),20,s,{x:this.m_twicObjects[index].m_coordinates.x-(7*index.toString().length>>1),y:this.m_twicObjects[index].m_coordinates.y+1.6*this.m_twicObjects[index].m_radius},1),this.m_twicObjects[index].m_size>this.m_largestShapeRadius&&(this.m_largestShapeRadius=this.m_twicObjects[index].m_size)}setTimeout(function(){this.m_graph.start();for(var t=0;1e3>t;t++)this.Tick();this.m_graph.stop(),this.b_positionsCalculated=!0}.bind(this),10),this.AddBarText(!1),this.MakeResizable(!1),this.MakeDraggable()}),t.CorpusClusterView.method("Update",function(e,i){if(this.m_paused){if(t.Interaction.dblclick==i)if(this.IsUnderlyingPanelOpen())for(var s=0;s<this.m_linkedViews.length;s++)t.Interaction.dblclick==this.m_linkedViews[s].update&&(this.m_linkedViews[s].panel.Pause(!1),this.m_linkedViews[s].panel.Update({topicID:e.m_name},i),this.m_linkedViews[s].panel.Pause(!0));else this.m_level.Update(e,i)}else if(t.Interaction.dblclick==i)if(this.IsUnderlyingPanelOpen())for(var s=0;s<this.m_linkedViews.length;s++)t.Interaction.dblclick==this.m_linkedViews[s].update&&(this.m_linkedViews[s].panel.Pause(!1),this.m_linkedViews[s].panel.Update({topicID:e.m_name},i),this.m_linkedViews[s].panel.Pause(!0));else this.m_level.Update(e,i);else t.Interaction.mouseover==i&&(null!=e?this.HighlightAllDataShapesWithTopic(e):this.HighlightAllDataShapes())}),t.CorpusClusterView.method("AddBarText",function(e){this.m_controlBar.AddText(function(i){i.m_barText&&i.m_barText.selectAll("*").remove(),this.m_textFirstSet||(this.m_textPos={x:i.GetNextWidgetPos().x,y:i.GetNextWidgetPos().y},this.m_textFirstSet=!0),e?(i.m_barText=i.m_controlGroup.append("text").attr("x",this.m_textPos.x).attr("y",this.m_textPos.y),i.m_barPath.attr("fill",t.Level.prototype.s_palette.darkblue).style("opacity",1),i.m_barText.append("tspan").html("TWiC:&nbsp;").attr("fill",t.Level.prototype.s_palette.lightpurple).style("font-family",t.Level.prototype.s_fontFamily).style("font-size",25),i.m_barText.append("tspan").html("Corpus Cluster View").attr("fill",t.Level.prototype.s_palette.gold).style("font-family",t.Level.prototype.s_fontFamily).style("font-size",25)):(i.m_barText=i.m_controlGroup.append("text").attr("x",this.m_textPos.x).attr("y",this.m_textPos.y),i.m_barPath.attr("fill",t.Level.prototype.s_palette.darkblue).style("opacity",1),i.m_barText.append("tspan").html("TWiC:&nbsp;").attr("fill",t.Level.prototype.s_palette.lightpurple).style("font-family",t.Level.prototype.s_fontFamily).style("font-size",25),i.m_barText.append("tspan").html("Texts Clustered by Top Topic in the ").attr("fill",t.Level.prototype.s_palette.gold).style("font-family",t.Level.prototype.s_fontFamily).style("font-size",21),i.m_barText.append("tspan").html(Object.keys(this.m_level.m_topicColors).length).attr("fill",t.Level.prototype.s_palette.green).style("font-family",t.Level.prototype.s_fontFamily).style("font-size",24),i.m_barText.append("tspan").html("&nbsp;topics of&nbsp;").attr("fill",t.Level.prototype.s_palette.gold).style("font-family",t.Level.prototype.s_fontFamily).style("font-size",21),i.m_barText.append("tspan").html(this.m_level.m_corpusMap.name).attr("fill",t.Level.prototype.s_palette.lightblue).style("font-family",t.Level.prototype.s_fontFamily).style("font-size",21))}.bind(this))}),t.CorpusClusterView.method("ArchimedeanSpiral",function(t,e,i,s){for(var o=e+i,a=[],n=0,r=0;s>r;r++){var l=Math.sqrt(r+1);n+=Math.asin(1/l);var h=Math.cos(n)*(l*o),m=Math.sin(n)*(l*o);a.push({x:h,y:m})}var p=d3.svg.line().x(function(t){return this.m_size.width+t.x}.bind(this)).y(function(t){return this.m_size.height+t.y}.bind(this)).interpolate("cardinal");this.m_svg.append("path").attr("d",p(a)).attr("stroke","gray").attr("stroke-width",5).attr("fill","none");this.m_svg.selectAll("circle").data(a).enter().append("circle").attr("cx",function(t){return this.m_size.width+t.x}.bind(this)).attr("cy",function(t){return this.m_size.height+t.y}.bind(this)).attr("r",10);return a}),t.CorpusClusterView.method("DarkenAllDataShapes",function(){this.m_svg.selectAll(TWiC.CorpusClusterView.prototype.s_datashapeClassSelect).style("fill",function(t){return t.locolor}).style("opacity",TWiC.DataShape.prototype.s_semihighlightedOpacity);this.m_svg.selectAll(".text_info_rect").style("opacity",TWiC.DataShape.prototype.s_semihighlightedOpacity).style("stroke-opacity",TWiC.DataShape.prototype.s_semihighlightedOpacity),this.m_svg.selectAll(TWiC.CorpusClusterView.prototype.s_datashapeTextClassSelect).selectAll("tspan").style("opacity",TWiC.DataShape.prototype.s_semihighlightedOpacity),this.m_svg.selectAll(".link").style("opacity",TWiC.DataShape.prototype.s_unhighlightedOpacity).style("stroke",t.Level.prototype.s_palette.link).style("stroke-width",.5)}),t.CorpusClusterView.method("HighlightAllDataShapes",function(){this.m_level.m_highlightedTopic=-1,this.m_svg.selectAll(TWiC.CorpusClusterView.prototype.s_datashapeClassSelect).style("opacity",1).style("fill",function(t){return t.color}),this.m_svg.selectAll(TWiC.CorpusClusterView.prototype.s_datashapeTextClassSelect).style("opacity",1).style("stroke-opacity",1),this.m_svg.selectAll(TWiC.CorpusClusterView.prototype.s_datashapeTextClassSelect).selectAll("tspan").style("opacity",1),this.m_svg.selectAll(".link").style("opacity",TWiC.DataShape.prototype.s_semihighlightedOpacity+.3).style("stroke",t.Level.prototype.s_palette.link).style("stroke-width",.5)}),t.CorpusClusterView.method("HighlightAllDataShapesWithTopic",function(t){this.DarkenAllDataShapes(),this.m_level.m_highlightedTopic=t.topicID;var e=this.m_svg.selectAll(TWiC.CorpusClusterView.prototype.s_datashapeClassSelect).filter(function(e){return e.topicID==t.topicID}).style("fill",t.color).style("opacity",1),i=this.m_svg.selectAll(TWiC.CorpusClusterView.prototype.s_datashapeClassSelect).filter(function(e){return e.topicID!=t.topicID}).style("fill",function(t){return t.locolor}).style("opacity",TWiC.DataShape.prototype.s_semihighlightedOpacity);i.each(function(t){d3.select(this.parentNode).selectAll("tspan").style("opacity",TWiC.DataShape.prototype.s_semihighlightedOpacity)}),e.each(function(e){e.topicID!=t.topicID&&e.shapeRef.m_textRect.classed("text_info_rect")&&e.shapeRef.m_textRect.style("opacity",1).style("stroke-opacity",TWiC.DataShape.prototype.s_semihighlightedOpacity),d3.select(this.parentNode).selectAll(TWiC.CorpusClusterView.prototype.s_datashapeClassSelect).filter(function(e){return e.topicID!=t.topicID}).style("opacity",1).style("fill",function(t){return t.locolor}),d3.select(this.parentNode).selectAll("tspan").style("opacity",1),isNaN(parseInt(e.shapeRef.m_name))||e.shapeRef.m_panel.m_svg.selectAll("line#link"+e.shapeRef.m_name).style("opacity",1).style("stroke",e.shapeRef.m_panel.m_level.m_topicColors[e.shapeRef.m_name]).style("stroke-width",1)}),this.m_svg.selectAll(".text_info_rect").filter(function(e){return e.topicID==t.topicID}).style("opacity",1).style("stroke-opacity",1)}),t.CorpusClusterView.method("Move",function(e,i,s){e.position&&this.m_container.SetPosition(e.position),e.size&&this.m_container.SetSize(e.size),this.m_container.m_div.transition().duration(e.duration).style("left",this.m_container.m_coordinates.x).style("top",this.m_container.m_coordinates.y).style("width",this.m_container.m_size.width).style("height",this.m_container.m_size.height),this.m_div.transition().duration(e.duration).style("width",this.m_size.width).style("height",this.m_size.height).each("start",function(e,i,s){this.m_panelRectDiv.transition().duration(e.duration).style("width",e.size.width).style("height",e.size.height-this.m_controlBar.m_size.height),this.m_panelRectSvg.transition().duration(e.duration).attr("width",e.size.width).attr("height",e.size.height-this.m_controlBar.m_size.height).attr("viewBox","0 0 "+e.size.width+" "+(e.size.height-this.m_controlBar.m_size.height)),this.m_panelRect.transition().duration(e.duration).attr("d",t.BottomRoundedRect(0,0,e.size.width,e.size.height-this.m_controlBar.m_size.height,t.Panel.prototype.s_borderRadius)),this.m_svg.transition().duration(e.duration).attr("width",this.m_size.width).attr("height",this.m_size.height).each("end",function(){"end"==i&&s()}.bind(this,i,s)),"start"==i&&s()}.bind(this,e,i,s)),this.m_controlBar.m_size.width=this.m_size.width,this.m_controlBar.m_div.transition().duration(e.duration).style("width",this.m_size.width).each("start",function(t){this.m_controlBar.m_barPath.transition().duration(t.duration).attr("d",this.m_controlBar.GetRectPath()),this.m_controlBar.m_svg.transition().duration(t.duration).attr("width",this.m_size.width).attr("viewBox","0 0 "+this.m_size.width+" "+this.m_controlBar.m_size.height)}.bind(this,e))}),t.CorpusClusterView.method("OpenUnderlyingPanel",function(e,i,s){for(var o=new t.TextClusterView({x:i.x,y:i.y},{width:s.width,height:s.height},this.m_level,parseInt(e.m_title)),a=0;a<this.m_linkedViews.length;a++)this.m_linkedViews[a].panel instanceof t.InformationView&&t.Interaction.mouseover==this.m_linkedViews[a].update&&o.AddLinkedView(this.m_linkedViews[a].panel,t.Interaction.mouseover);this.m_level.m_graphViews[0].m_panel.AddLinkedView(o,t.Interaction.mouseover),o.AddLinkedView(this.m_level.m_graphViews[0].m_panel,t.Interaction.mouseover),this.AddLinkedView(o,t.Interaction.mouseover),o.AddLinkedView(this,t.Interaction.mouseover),this.AddLinkedView(o,t.Interaction.dblclick),this.m_level.m_infoViews[0].m_panel.AddLinkedView(o,t.Interaction.click),this.m_level.m_infoViews[1].m_panel.AddLinkedView(o,t.Interaction.click),this.m_level.m_infoViews[1].m_panel.AddLinkedView(o,t.Interaction.mouseover),o.m_container.Initialize(this.m_level.m_div),o.m_container.Start(),o.m_div.style("opacity",0),o.m_controlBar.m_div.style("opacity",0),o.m_panelRectDiv.style("opacity",0),o.m_div.transition().delay(500).duration(3e3).style("opacity",1),o.m_controlBar.m_div.transition().delay(500).duration(3e3).style("opacity",1),o.m_panelRectDiv.transition().delay(500).duration(3e3).style("opacity",1),this.m_underlyingPanelOpen=!0}),t.CorpusClusterView.method("ScrollToZoom",function(t){var e=function(e,i){d3.select("#twic_level_"+t.m_name).attr("transform","translate("+d3.event.translate+")scale("+d3.event.scale+")")};return e}),t.CorpusClusterView.method("TickAlt",function(){var t=parseInt(this.m_svg.attr("width")),e=parseInt(this.m_svg.attr("height"));this.m_nodes[this.m_rootIndex].x=t>>1,this.m_nodes[this.m_rootIndex].y=e>>1,this.m_svg.selectAll(".node").each(function(t){d3.select(this).selectAll("circle").attr("cx",t.x).attr("cy",t.y),d3.select(this).selectAll("path").attr("transform","translate("+t.x+","+t.y+")")}),this.m_svg.selectAll(".link").attr("x1",function(t){return t.source.x}).attr("y1",function(t){return t.source.y}).attr("x2",function(t){return t.target.x}).attr("y2",function(t){return t.target.y})}),t.CorpusClusterView.method("Tick",function(){var e=this.m_svg.selectAll(".link"),i=this.m_svg.selectAll(".node"),s=parseInt(this.m_svg.attr("width")),o=parseInt(this.m_svg.attr("height"));if(this.m_nodes[this.m_rootIndex].x=s>>1,this.m_nodes[this.m_rootIndex].y=o>>1,this.b_positionsCalculated)e.attr("x1",function(t){return t.source.firstX}).attr("y1",function(t){return t.source.firstY}).attr("x2",function(t){return t.target.firstX}).attr("y2",function(t){return t.target.firstY}),i.attr("transform",function(t){return"translate("+t.firstX+","+t.firstY+")"});else{i.attr("cx",function(t){return t.x=Math.max(t.radius,Math.min(s-t.radius,t.x))}.bind(this)).attr("cy",function(t){return t.y=Math.max(t.radius,Math.min(o-t.radius,t.y))}.bind(this));for(var a=d3.geom.quadtree(this.m_nodes),n=0,r=this.m_nodes.length;++n<r;)a.visit(t.GraphView.prototype.Collide(this.m_nodes[n]));e.attr("x1",function(t){return t.source.firstX=t.source.x,t.source.x}).attr("y1",function(t){return t.source.firstY=t.source.y,t.source.y}).attr("x2",function(t){return t.target.firstX=t.target.x,t.target.x}).attr("y2",function(t){return t.target.firstY=t.target.y,t.target.y}),i.attr("transform",function(t){return t.firstX=t.x,t.firstY=t.y,"translate("+t.x+","+t.y+")"})}}),t.CorpusClusterView.prototype.s_datashapeClassName="corpuscluster_shape",t.CorpusClusterView.prototype.s_datashapeClassSelect=".corpuscluster_shape",t.CorpusClusterView.prototype.s_datashapeTextClassName="corpuscluster_shape_text",t.CorpusClusterView.prototype.s_datashapeTextClassSelect=".corpuscluster_shape_text",t.CorpusClusterView.prototype.s_infoFlavorText="Topic Avg. of Corpus Topic Clusters",t.TextClusterView=function(e,i,s,o){t.GraphView.apply(this,arguments),this.m_twicObjects=[],this.m_objectsJSON=[],this.m_nodes=[],this.m_links=[],this.m_graph=null,this.m_clusterIndex=o,this.b_positionsCalculated=!1,this.m_rootIndex=-1,this.m_clusterSvgGroup=null,this.m_numberTopics=5},t.TextClusterView.inherits(t.GraphView),t.TextClusterView.method("Initialize",function(e){this.m_container.SetPosition(this.m_coordinates),this.m_container.m_div.style("left",this.m_container.m_coordinates.x),this.m_container.m_div.style("top",this.m_container.m_coordinates.y),this.m_coordinates.x=0,this.m_coordinates.y=0;var i=this.m_controlBar?this.m_controlBar.m_size.height-1:0;this.m_panelRectDiv=e.append("div").attr("class","div_panel_rect").attr("id","div_panel_rect_"+this.m_name).style("position","absolute").style("left",this.m_coordinates.x).style("top",this.m_coordinates.y+i).style("width",this.m_size.width).style("height",this.m_size.height).style("max-width",this.m_size.width).style("max-height",this.m_size.height).style("border-radius",t.Panel.prototype.s_borderRadius),this.m_panelRectSvg=this.m_panelRectDiv.append("svg").attr("x",this.m_coordinates.x).attr("y",this.m_coordinates.y).attr("width",this.m_size.width).attr("height",this.m_size.height).attr("viewBox","0 0 "+this.m_size.width+" "+this.m_size.height),this.m_panelRect=this.m_panelRectSvg.append("path").attr("d",t.BottomRoundedRect(this.m_coordinates.x,this.m_coordinates.y,this.m_size.width,this.m_size.height,t.Panel.prototype.s_borderRadius)).attr("class","rect_twic_graph").attr("id","rect_twic_graph_textclusterview_"+this.m_name).attr("fill",t.Level.prototype.s_palette.darkblue),this.m_div=e.append("div").attr("class","div_twic_graph_textclusterview div_twic_graph twic_panel").attr("id","div_twic_graph_textclusterview_"+this.m_name).style("width",this.m_size.width).style("height",this.m_size.height).style("max-width",this.m_size.width).style("max-height",this.m_size.height).style("border-radius",t.Panel.prototype.s_borderRadius).style("position","absolute").style("left",this.m_coordinates.x).style("top",this.m_coordinates.y+i),this.m_svg=this.m_div.append("svg").attr("class","svg_twic_graph").attr("id","svg_twic_graph_textclusterview_"+this.m_name).attr("x",this.m_coordinates.x).attr("y",this.m_coordinates.y).attr("width",this.m_size.width).attr("height",this.m_size.height).attr("viewBox","-50 -50 "+(this.m_size.width+100)+" "+(this.m_size.height+100)),this.m_groupOverlay=this.m_svg.append("g").attr("class","group_twic_graph_overlay").attr("id","group_twic_graph_overlay_textclusterview_"+this.m_name),this.m_clickRectangle=this.m_groupOverlay.append("rect").attr("x",-50).attr("y",-50).attr("width",this.m_size.width+100).attr("height",this.m_size.height+100).attr("fill",t.Level.prototype.s_palette.darkblue).style("opacity",0).on(t.Interaction.click,function(){t.GraphView.prototype.MouseBehavior(this,null,t.Interaction.click)}.bind(this)),this.m_clusterSvgGroup=this.m_groupOverlay.append("g").attr("id","clustersvg_group").attr("width",this.m_size.width).attr("height",this.m_size.height).attr("transform","translate("+.4*(this.m_coordinates.x+(this.m_size.width>>2))+","+.4*(this.m_coordinates.y+(this.m_size.height>>2))+") scale(0.75)"),this.AddBarText(!1),this.InitializeGraph()}),t.TextClusterView.method("InitializeGraph",function(){for(var e=this.m_level.m_corpusMap.children[this.m_clusterIndex].children.length,i=0,s=0;s<Object.keys(this.m_level.m_corpusMap.children).length;s++)i+=this.m_level.m_corpusMap.children[s].children.length;i/=Object.keys(this.m_level.m_corpusMap.children).length;var o=Math.sqrt(1/Math.PI*(this.m_size.width*this.m_size.height/e));o>>=1;var a=Math.sqrt(1/Math.PI*(this.m_size.width*this.m_size.height/i));a>>=1;for(var n=0,s=0;e>s;s++)n+=this.m_level.m_corpusMap.children[this.m_clusterIndex].children[s].dist2avg;n/=Object.keys(this.m_level.m_corpusMap.children[this.m_clusterIndex].children).length,this.m_linkDistLimits={min:this.m_level.m_corpusMap.children[this.m_clusterIndex].children[0].dist2avg,max:this.m_level.m_corpusMap.children[this.m_clusterIndex].children[0].dist2avg};for(var s=1;e>s;s++)this.m_linkDistLimits.min=Math.min(this.m_linkDistLimits.min,this.m_level.m_corpusMap.children[this.m_clusterIndex].children[s].dist2avg),this.m_linkDistLimits.max=Math.max(this.m_linkDistLimits.max,this.m_level.m_corpusMap.children[this.m_clusterIndex].children[s].dist2avg);this.b_adjustDistances=this.m_linkDistLimits.min<0;var r=Math.min(this.m_size.width,this.m_size.height);this.m_adjustedDistances=[];for(var s=0;e>s;s++){var l=this.m_level.m_corpusMap.children[this.m_clusterIndex].children[s].dist2avg;this.b_adjustDistances&&(l+=this.m_linkDistLimits.min),this.m_adjustedDistances.push(l)}0==this.m_linkDistLimits.min&&(this.m_linkDistLimits.min+=100);for(var h=100/(this.m_linkDistLimits.max-this.m_linkDistLimits.min),s=0;s<this.m_adjustedDistances.length;s++)this.m_adjustedDistances[s]-=this.m_linkDistLimits.min,this.m_adjustedDistances[s]*=h;this.m_rootIndex=0,this.m_nodes.push({index:this.m_rootIndex,name:t.TextClusterView.prototype.s_infoFlavorText,radius:a});for(var m=[],p=10,s=0;p>s;s++)m.push([]);for(var _ in this.m_level.m_corpusMap.children[this.m_clusterIndex].topics)this.m_level.m_corpusMap.children[this.m_clusterIndex].topics[_][0]<p+1&&(m[this.m_level.m_corpusMap.children[this.m_clusterIndex].topics[_][0]-1]=[_,this.m_level.m_corpusMap.children[this.m_clusterIndex].topics[_][1]]);this.m_clusterSvgGroup.append("g").attr("class","node").style("position","absolute").attr("id","node_"+this.m_rootIndex);var c=new TWiC.TopicBullseye({x:0,y:0},a,this.m_nodes[0].name,this.m_level,this,this.m_linkedViews,p,this.m_level.m_corpusMap.children[this.m_clusterIndex].topics,this.m_level.m_corpusMap.children[this.m_clusterIndex].name,!1);c.SetTextCount(e),c.SetPanelNodeIndex(0),c.SetScaledRadius(!0),c.m_allowDblclick=!1,this.m_twicObjects.push(c),this.m_objectsJSON.push({name:c.m_name,dist2avg:0,topics:m,children:[]}),this.m_nodes[0].radius=c.m_size;for(var s=0;e>s;s++){var d=new TWiC.TopicRectangle({x:0,y:0},{width:0,height:0},this.m_level.m_corpusMap.children[this.m_clusterIndex].children[s].name,this.m_level,this,this.m_linkedViews,this.m_clusterIndex,this.m_numberTopics);d.SetPanelNodeIndex(s),d.Load();var u={name:this.m_level.m_corpusMap.children[this.m_clusterIndex].children[s].name,dist2avg:this.m_adjustedDistances[s]*r/100,topics:this.m_level.m_corpusMap.children[this.m_clusterIndex].children[s].topics,children:[]};this.m_objectsJSON.push(u),this.m_twicObjects.push(d)}for(var s=0;s<this.m_objectsJSON.length;s++)if(this.m_rootIndex!=s){this.m_nodes.push({index:s,name:this.m_objectsJSON[s].name});var y=this.m_objectsJSON[s].dist2avg;a>y&&(y=a),this.m_links.push({source:s,target:this.m_rootIndex,value:y})}this.m_graph=d3.layout.force().nodes(this.m_nodes).links(this.m_links).size([this.m_size.width,this.m_size.height]).charge(-150).gravity(.06).linkDistance(function(e){return e.value+t.GraphView.prototype.s_linkDistanceMod})}),t.TextClusterView.method("Start",function(){this.m_level.m_queue.await(function(){this.m_clusterSvgGroup.selectAll(".link").data(this.m_links).enter().append("line").attr("class","link").attr("id",function(t){return"link"+t.source}).style("stroke-width",.5).style("stroke",t.Level.prototype.s_palette.lightgray).style("opacity",TWiC.TopicBullseye.s_semihighlightedOpacity);for(var e=0;e<this.m_twicObjects.length;e++)for(var i=0;i<this.m_nodes.length;i++)if(this.m_twicObjects[e].m_name==this.m_nodes[i].name){if(0==e)this.m_nodes[i].radius=this.m_twicObjects[e].m_size;else{var s=5,o=2*s*t.TopicRectangle.prototype.borderWidth,a={width:this.m_twicObjects[e].m_size.width+o,height:this.m_twicObjects[e].m_size.height+o};this.m_nodes[i].radius=Math.sqrt((a.width>>1)*(a.width>>1)+(a.height>>1)*(a.height>>1))}break}for(e=0;e<this.m_twicObjects.length;e++)for(var i=0;i<this.m_nodes.length;i++)if(this.m_twicObjects[e].m_name==this.m_nodes[i].name){if(t.TopicRectangle.prototype.s_shapeChar==this.m_twicObjects[e].m_shapeChar){this.m_twicObjects[e].Draw();var n=this.m_level.m_corpusMap.children[this.m_clusterIndex].children[e-1].name,r=this.m_level.m_corpusInfo.file_info[n][1];this.m_twicObjects[e].SetTitle(r)}else{this.m_twicObjects[e].Draw(this.m_svg.select(".node#node_"+e),[]);var r=""}this.m_twicObjects[e].AddTextTag(r,20,TWiC.Level.prototype.s_palette.gold,{x:this.m_twicObjects[e].m_coordinates.x-(7*r.length>>1),y:this.m_twicObjects[e].m_coordinates.y+2.75*this.m_twicObjects[e].m_radius},0)}if(this.m_svg.selectAll(".node").data(this.m_nodes).enter(),setTimeout(function(){this.m_graph.start();for(var t=1e3;t>0;--t)this.Tick();this.m_graph.stop(),this.b_positionsCalculated=!0}.bind(this),10),this.MakeResizable(!1),this.MakeDraggable(),-1!=this.m_level.m_highlightedTopic){var l=this.m_paused;this.Pause(!1),this.Update({topicID:this.m_level.m_highlightedTopic},t.Interaction.mouseover),this.Pause(l)}}.bind(this))}),t.TextClusterView.method("Update",function(e,i){if(this.m_paused){if(t.Interaction.dblclick==i){for(var s=0;s<this.m_linkedViews.length;s++)t.Interaction.dblclick==this.m_linkedViews[s].update&&this.m_linkedViews[s].panel.Update(e,i);d3.event.stopPropagation()}}else i&&t.Interaction.mouseover==i?null!=e?this.HighlightAllDataShapesWithTopic(e):this.HighlightAllDataShapes(!1):e&&e.topicID!=this.m_clusterIndex&&this.m_level.m_corpusMap.children[this.m_clusterIndex]&&(this.m_graph.stop(),this.m_clusterSvgGroup.selectAll("*").remove(),this.m_twicObjects=[],this.m_objectsJSON=[],this.m_nodes=[],this.m_links=[],this.m_graph=null,this.m_clusterIndex=e.topicID,this.b_positionsCalculated=!1,this.m_rootIndex=-1,this.m_controlBar.m_barText.selectAll("*").remove(),this.AddBarText(!1),this.InitializeGraph(),this.Start())}),t.TextClusterView.method("AddBarText",function(e){this.m_controlBar.AddText(function(i){i.m_barText&&i.m_barText.selectAll("*").remove(),this.m_textFirstSet||(this.m_textPos={x:i.GetNextWidgetPos().x,y:i.GetNextWidgetPos().y},this.m_textFirstSet=!0),e?(i.m_barText=i.m_controlGroup.append("text").attr("x",this.m_textPos.x).attr("y",this.m_textPos.y),i.m_barPath.attr("fill",t.Level.prototype.s_palette.darkblue).style("opacity",1),i.m_barText.append("tspan").html("TWiC:&nbsp;").attr("fill",t.Level.prototype.s_palette.lightpurple).style("font-family",t.Level.prototype.s_fontFamily).style("font-size",25),i.m_barText.append("tspan").html("Text Cluster View").attr("fill",t.Level.prototype.s_palette.gold).style("font-family",t.Level.prototype.s_fontFamily).style("font-size",25)):(i.m_barText=i.m_controlGroup.append("text").attr("x",this.m_textPos.x).attr("y",this.m_textPos.y),i.m_barPath.attr("fill",t.Level.prototype.s_palette.darkblue).style("opacity",1),i.m_barText.append("tspan").html("TWiC:&nbsp;").attr("fill",t.Level.prototype.s_palette.lightpurple).style("font-family",t.Level.prototype.s_fontFamily).style("font-size",25),i.m_barText.append("tspan").html("Texts with Top Topic of&nbsp;").attr("fill",t.Level.prototype.s_palette.gold).style("font-family",t.Level.prototype.s_fontFamily).style("font-size",21),i.m_barText.append("tspan").html(this.m_clusterIndex).attr("fill",this.m_level.m_topicColors[this.m_clusterIndex]).style("font-family",t.Level.prototype.s_fontFamily).style("font-size",24),
i.m_barText.append("tspan").html("&nbsp;in&nbsp;").attr("fill",t.Level.prototype.s_palette.gold).style("font-family",t.Level.prototype.s_fontFamily).style("font-size",21),i.m_barText.append("tspan").html(this.m_level.m_corpusMap.name).attr("fill",t.Level.prototype.s_palette.lightblue).style("font-family",t.Level.prototype.s_fontFamily).style("font-size",21))}.bind(this))}),t.TextClusterView.method("DarkenAllDataShapes",function(){var e=this.m_svg.selectAll(TWiC.TextClusterView.prototype.s_datashapeClassSelect);e.each(function(t){"path"==this.nodeName||"circle"==this.nodeName?d3.select(this).style("fill",t.locolor).style("opacity",TWiC.DataShape.prototype.s_semihighlightedOpacity):"rect"==this.nodeName?d3.select(this).style("stroke",t.locolor).style("stroke-opacity",TWiC.DataShape.prototype.s_semihighlightedOpacity):"g"==this.nodeName&&(d3.select(this).selectAll("rect").style("opacity",TWiC.DataShape.prototype.s_semihighlightedOpacity),d3.select(this).selectAll("path").style("opacity",TWiC.DataShape.prototype.s_semihighlightedOpacity))}),this.m_svg.selectAll(".text_info_rect").style("opacity",TWiC.DataShape.prototype.s_semihighlightedOpacity).style("stroke",function(t){return t.locolor}).style("stroke-opacity",TWiC.DataShape.prototype.s_semihighlightedOpacity),this.m_svg.selectAll(TWiC.TextClusterView.prototype.s_datashapeTextClassSelect).selectAll("tspan").style("opacity",0),this.m_clusterSvgGroup.selectAll(".link").style("opacity",TWiC.DataShape.prototype.s_unhighlightedOpacity).style("stroke",t.Level.prototype.s_palette.link).style("stroke-width",1)}),t.TextClusterView.method("HighlightAllDataShapes",function(e){this.m_level.m_highlightedTopic=-1;var i=this.m_svg.selectAll(TWiC.TextClusterView.prototype.s_datashapeClassSelect);i.each(function(t){"path"==this.nodeName||"circle"==this.nodeName?d3.select(this).style("fill",t.color).style("opacity",1):"rect"==this.nodeName?d3.select(this).style("stroke",t.color).style("opacity",1).style("stroke-opacity",1):"g"==this.nodeName&&(d3.select(this).selectAll("rect").style("opacity",1),d3.select(this).selectAll("path").style("opacity",1))}),this.m_svg.selectAll(".text_info_rect").style("opacity",1).style("stroke",function(t){return t.color}).style("stroke-opacity",1),e?this.m_svg.selectAll(TWiC.TextClusterView.prototype.s_datashapeTextClassSelect).selectAll("tspan").style("opacity",1):this.m_svg.selectAll(TWiC.TextClusterView.prototype.s_datashapeTextClassSelect).selectAll("tspan").style("opacity",0),this.m_clusterSvgGroup.selectAll(".link").style("opacity",TWiC.DataShape.prototype.s_semihighlightedOpacity+.3).style("stroke",t.Level.prototype.s_palette.link).style("stroke-width",1)}),t.TextClusterView.method("HighlightAllDataShapesWithTopic",function(e){this.DarkenAllDataShapes(),this.m_level.m_highlightedTopic=e.topicID;var i=this.m_svg.selectAll(TWiC.TextClusterView.prototype.s_datashapeClassSelect).filter(function(t){return t.topicID==e.topicID});i.each(function(i){"path"==this.nodeName||"circle"==this.nodeName?d3.select(this).style("fill",i.color).style("opacity",1):"rect"==this.nodeName?(d3.select(this).style("stroke",i.color).style("opacity",1).style("stroke-opacity",1),d3.select(this.parentNode.parentNode.parentNode).selectAll(".text_info_rect").style("opacity",1)):"g"==this.nodeName&&(d3.select(this).selectAll("rect").style("opacity",1),d3.select(this).selectAll("path").style("opacity",1));var s=d3.select(this.parentNode).selectAll(TWiC.TextClusterView.prototype.s_datashapeClassSelect).filter(function(t){return t.topicID!=e.topicID});s.each(function(t){"path"==this.nodeName||"circle"==this.nodeName?d3.select(this).style("fill",t.locolor).style("opacity",1):"rect"==this.nodeName?d3.select(this).style("stroke",t.locolor).style("stroke-opacity",1):"g"==this.nodeName&&(d3.select(this).selectAll("rect").style("opacity",1),d3.select(this).selectAll("path").style("opacity",1))}),i&&i.shapeRef&&(i.shapeRef.m_textTag.selectAll("tspan").style("opacity",1),t.TopicRectangle.prototype.s_shapeChar==i.shapeRef.m_shapeChar&&(i.shapeRef.m_textRect.style("opacity",1),d3.select(i.shapeRef.m_textRect.node().parentNode).selectAll("path").style("opacity",1)),isNaN(parseInt(i.shapeRef.m_name))||i.shapeRef.m_panel.m_clusterSvgGroup.select("line#link"+(i.shapeRef.m_panelNodeIndex+1)).style("opacity",1).style("stroke",i.shapeRef.m_panel.m_level.m_topicColors[i.shapeRef.m_clusterIndex]).style("stroke-width",2))});var s=this.m_svg.selectAll(".text_info_rect").filter(function(t){return t.topicID==e.topicID});s.each(function(t){d3.select(this).style("opacity",1).style("stroke",t.color).style("stroke-opacity",1).selectAll("path").style("opacity",1).style("fill",function(t){return t.color})})}),t.TextClusterView.method("Move",function(e,i,s){e.position&&this.m_container.SetPosition(e.position),e.size&&this.m_container.SetSize(e.size),this.m_container.m_div.transition().duration(e.duration).style("left",this.m_container.m_coordinates.x).style("top",this.m_container.m_coordinates.y).style("width",this.m_container.m_size.width).style("height",this.m_container.m_size.height),this.m_div.transition().duration(e.duration).style("width",this.m_size.width).style("height",this.m_size.height).each("start",function(e,i,s){this.m_panelRectDiv.transition().duration(e.duration).style("width",e.size.width).style("height",e.size.height-this.m_controlBar.m_size.height),this.m_panelRectSvg.transition().duration(e.duration).attr("width",e.size.width).attr("height",e.size.height-this.m_controlBar.m_size.height).attr("viewBox","0 0 "+e.size.width+" "+(e.size.height-this.m_controlBar.m_size.height)),this.m_panelRect.transition().duration(e.duration).attr("d",t.BottomRoundedRect(0,0,e.size.width,e.size.height-this.m_controlBar.m_size.height,t.Panel.prototype.s_borderRadius)),this.m_svg.transition().duration(e.duration).attr("width",this.m_size.width).attr("height",this.m_size.height).each("end",function(){"end"==i&&s()}.bind(this,i,s)),"start"==i&&s()}.bind(this,e,i,s)),this.m_controlBar.m_size.width=this.m_size.width,this.m_controlBar.m_div.transition().duration(e.duration).style("width",this.m_size.width).each("start",function(t){this.m_controlBar.m_barPath.transition().duration(t.duration).attr("d",this.m_controlBar.GetRectPath()),this.m_controlBar.m_svg.transition().duration(t.duration).attr("width",this.m_size.width).attr("viewBox","0 0 "+this.m_size.width+" "+this.m_controlBar.m_size.height)}.bind(this,e))}),t.TextClusterView.method("OpenUnderlyingPanel",function(e,i,s){for(var o=new t.TextView({x:i.x,y:i.y},{width:s.width,height:s.height},this.m_level),a=0;a<this.m_linkedViews.length;a++)this.m_linkedViews[a].panel instanceof t.InformationView&&t.Interaction.mouseover==this.m_linkedViews[a].update&&o.AddLinkedView(this.m_linkedViews[a].panel,t.Interaction.mouseover);if(this.m_level.m_graphViews[0].m_panel.AddLinkedView(o,t.Interaction.mouseover),o.AddLinkedView(this.m_level.m_graphViews[0].m_panel,t.Interaction.mouseover),this.m_level.m_graphViews[1].m_panel.AddLinkedView(o,t.Interaction.mouseover),o.AddLinkedView(this.m_level.m_graphViews[1].m_panel,t.Interaction.mouseover),this.AddLinkedView(o,t.Interaction.mouseover),o.AddLinkedView(this,t.Interaction.mouseover),this.AddLinkedView(o,t.Interaction.dblclick),this.m_level.m_infoViews[0].m_panel.AddLinkedView(o,t.Interaction.click),this.m_level.m_infoViews[1].m_panel.AddLinkedView(o,t.Interaction.click),this.m_level.m_infoViews[1].m_panel.AddLinkedView(o,t.Interaction.mouseover),o.m_container.Initialize(this.m_level.m_div,!0),o.m_container.Start(),o.m_div.style("opacity",0),o.m_controlBar.m_div.style("opacity",0),o.m_panelRectDiv.style("opacity",0),o.m_div.transition().delay(500).duration(3e3).style("opacity",1),o.m_controlBar.m_div.transition().delay(500).duration(3e3).style("opacity",1),o.m_panelRectDiv.transition().delay(500).duration(3e3).style("opacity",1),o.Update(e,t.Interaction.dblclick),-1!=this.m_level.m_highlightedTopic){var n=o.IsPaused();o.Pause(!1),o.Update(e,t.Interaction.mouseover),n&&o.Pause(!0)}else o.Update(null,t.Interaction.mouseover);this.m_underlyingPanelOpen=!0}),t.TextClusterView.method("Tick",function(){var e=this.m_svg.selectAll(".link"),i=this.m_svg.selectAll(".node"),s=parseInt(this.m_svg.attr("width")),o=parseInt(this.m_svg.attr("height"));if(this.m_nodes[this.m_rootIndex].x=s>>1,this.m_nodes[this.m_rootIndex].y=o>>1,this.b_positionsCalculated)e.attr("x1",function(t){return t.source.firstX}).attr("y1",function(t){return t.source.firstY}).attr("x2",function(t){return t.target.firstX}).attr("y2",function(t){return t.target.firstY}),i.attr("transform",function(t){return"translate("+t.firstX+","+t.firstY+")"});else{i.attr("cx",function(t){return t.x=Math.max(t.radius,Math.min(s-t.radius,t.x))}.bind(this)).attr("cy",function(t){return t.y=Math.max(t.radius,Math.min(o-t.radius,t.y))}.bind(this));for(var a=d3.geom.quadtree(this.m_nodes),n=0,r=this.m_nodes.length;++n<r;)a.visit(t.GraphView.prototype.Collide(this.m_nodes[n]));e.attr("x1",function(t){return t.source.firstX=t.source.x,t.source.x}).attr("y1",function(t){return t.source.firstY=t.source.y,t.source.y}).attr("x2",function(t){return t.target.firstX=t.target.x,t.target.x}).attr("y2",function(t){return t.target.firstY=t.target.y,t.target.y}),i.attr("transform",function(t){return t.firstX=t.x,t.firstY=t.y,"translate("+t.x+","+t.y+")"}),this.b_positionsCalculated=!0}}),t.TextClusterView.prototype.s_datashapeClassName="textcluster_shape",t.TextClusterView.prototype.s_datashapeClassSelect=".textcluster_shape",t.TextClusterView.prototype.s_datashapeTextClassName="textcluster_shape_text",t.TextClusterView.prototype.s_datashapeTextClassSelect=".textcluster_shape_text",t.TextClusterView.prototype.s_infoFlavorText="Topic Avg. of Text Cluster",t.TextView=function(e,i,s){t.GraphView.apply(this,arguments),this.m_data=null,this.m_filename=""},t.TextView.inherits(t.GraphView),t.TextView.method("Initialize",function(e){this.m_container.SetPosition(this.m_coordinates),this.m_container.m_div.style("left",this.m_container.m_coordinates.x),this.m_container.m_div.style("top",this.m_container.m_coordinates.y),this.m_container.m_div.style("overflow","hidden"),this.m_container.m_div[0][0].style["border-radius"]=t.Panel.prototype.s_borderRadius+"px",this.m_coordinates.x=0,this.m_coordinates.y=0;var i=this.m_controlBar?this.m_controlBar.m_size.height-t.Panel.prototype.s_borderRadius+4:0;this.m_panelRectDiv=e.append("div").attr("class","div_panel_rect").attr("id","div_panel_rect_"+this.m_name).style("position","absolute").style("left",this.m_coordinates.x).style("top",this.m_coordinates.y+i).style("width",this.m_size.width).style("height",this.m_size.height+t.Panel.prototype.s_borderRadius).style("max-width",this.m_level.m_size.width).style("max-height",this.m_level.m_size.height).style("overflow","hidden"),this.m_panelRectDiv[0][0].style["border-radius"]=t.Panel.prototype.s_borderRadius+"px",this.m_panelRectSvg=this.m_panelRectDiv.append("svg").attr("x",this.m_coordinates.x).attr("y",this.m_coordinates.y).attr("width",this.m_size.width).attr("height",this.m_size.height+t.Panel.prototype.s_borderRadius).attr("viewBox","0 0 "+this.m_size.width+" "+(this.m_size.height+t.Panel.prototype.s_borderRadius)),this.m_panelRect=this.m_panelRectSvg.append("path").attr("d",t.BottomRoundedRect(this.m_coordinates.x,this.m_coordinates.y,this.m_size.width,this.m_size.height+t.Panel.prototype.s_borderRadius,t.Panel.prototype.s_borderRadius)).attr("class","rect_twic_graph").attr("id","rect_twic_graph_textview_"+this.m_name).attr("fill",t.Level.prototype.s_palette.darkblue).style("position","absolute"),this.m_div=e.append("div").attr("class","div_twic_graph_textview div_twic_graph twic_panel").attr("id","div_twic_graph_textview_"+this.m_name).style("left",this.m_coordinates.x).style("top",this.m_coordinates.y+i).style("width",this.m_size.width).style("height",this.m_size.height).style("max-width",this.m_level.m_size.width).style("max-height",this.m_level.m_size.height).style("overflow","scroll").style("border-radius",t.Panel.prototype.s_borderRadius).style("position","absolute"),this.m_div.on(t.Interaction.click,function(){t.GraphView.prototype.MouseBehavior(this,null,t.Interaction.click)}.bind(this)),this.m_minDims={width:this.m_size.width,height:this.m_size.height},this.m_groupOverlay=this.m_div.append("g").attr("class","group_twic_graph_overlay").attr("id","group_twic_graph_overlay_textview_"+this.m_name).style("position","relative"),this.m_clickRectangle=this.m_groupOverlay.append("rect").attr("x",0).attr("y",0).attr("width",this.m_size.width).attr("height",this.m_size.height).attr("fill",t.Level.prototype.s_palette.darkblue).style("opacity",0).on(t.Interaction.click,function(){t.GraphView.prototype.MouseBehavior(this,null,t.Interaction.click)}.bind(this)),this.m_controlBar.m_barPath.attr("fill",t.Level.prototype.s_palette.darkblue).style("opacity",1),this.MakeResizable(!1),this.MakeDraggable()}),t.TextView.method("Start",function(){""!=this.m_filename&&this.Load()}),t.TextView.method("Update",function(e,i){this.IsPaused()||(t.Interaction.mouseover==i?null==e?this.HighlightAllWords():(this.DarkenAllWords(),this.HighlightTopicText(e)):(this.m_data=e,this.CreateHTMLFromJSON(e),this.AddBarText(!1),this.MakeResizable(),this.MakeDraggable(),this.Update(e,t.Interaction.mouseover),this.Pause(!0)))}),t.TextView.method("AddBarText",function(e){this.m_controlBar.AddText(function(i){e?(i.m_barText.selectAll("*").remove(),i.m_barText.append("tspan").html("TWiC:&nbsp;").attr("fill",t.Level.prototype.s_palette.lightpurple).style("font-family",t.Level.prototype.s_fontFamily).style("font-size",25),i.m_barText.append("tspan").html("Text View").attr("fill",t.Level.prototype.s_palette.gold).style("font-family",t.Level.prototype.s_fontFamily).style("font-size",25)):(this.m_textFirstSet||(this.m_textPos={x:i.GetNextWidgetPos().x,y:i.GetNextWidgetPos().y},this.m_textFirstSet=!0),i.m_barPath.attr("fill",t.Level.prototype.s_palette.darkblue).style("opacity",1),null==i.m_barText&&(i.m_barText=i.m_controlGroup.append("text").attr("x",this.m_textPos.x).attr("y",this.m_textPos.y)),null!=this.m_data&&(this.m_controlBar.m_barText.selectAll("*").remove(),i.m_barText.append("tspan").html("TWiC:&nbsp;").attr("fill",t.Level.prototype.s_palette.lightpurple).style("font-family",t.Level.prototype.s_fontFamily).style("font-size",25),i.m_barText.append("tspan").html('"'+this.m_data.json.title+'"').attr("fill",this.m_level.m_topicColors[this.m_data.clusterIndex]).style("font-family",t.Level.prototype.s_fontFamily).style("font-size",23),i.m_barText.append("tspan").html("&nbsp;from&nbsp;").attr("fill",t.Level.prototype.s_palette.gold).style("font-family",t.Level.prototype.s_fontFamily).style("font-size",21),i.m_barText.append("tspan").html("Topic Cluster "+this.m_data.clusterIndex).attr("fill",this.m_level.m_topicColors[this.m_data.clusterIndex]).style("font-family",t.Level.prototype.s_fontFamily).style("font-size",21),i.m_barText.append("tspan").html("&nbsp;in&nbsp;").attr("fill",t.Level.prototype.s_palette.gold).style("font-family",t.Level.prototype.s_fontFamily).style("font-size",21),i.m_barText.append("tspan").html(this.m_level.m_corpusMap.name).attr("fill",t.Level.prototype.s_palette.lightblue).style("font-family",t.Level.prototype.s_fontFamily).style("font-size",21)))}.bind(this))}),t.TextView.method("CreateHTMLFromJSON",function(e){var i=t.TextView.prototype.s_textStartPosition.x,s=t.TextView.prototype.s_textStartPosition.y,o=this.m_size.height+t.Panel.prototype.s_borderRadius,a=t.TopicBar.prototype.s_textInfo.yIncrement;this.m_groupOverlay.selectAll("*").remove(),this.m_topicText&&(this.m_topicText=null);for(var n=0;n<e.json.lines_and_colors.length;n++)s+=a,s>this.m_size.height&&(o+=a);$(this.m_div[0][0]).scrollTop(0),this.m_panelRectSvg.attr("height",o).attr("viewBox","0 0 "+this.m_size.width+" "+o),this.m_container.m_div.selectAll(".rect_twic_graph").remove(),this.m_panelRect=this.m_panelRectSvg.append("path").attr("d",t.BottomRoundedRect(0,0,this.m_size.width,o,t.Panel.prototype.s_borderRadius)).attr("class","rect_twic_graph").attr("id","rect_twic_graph_textview_"+this.m_name).attr("fill",t.Level.prototype.s_palette.darkblue).style("position","absolute"),this.m_container.m_div[0][0].style["border-radius"]=t.Panel.prototype.s_borderRadius+"px",this.m_div.style("border-radius",t.Panel.prototype.s_borderRadius),this.m_panelRectDiv[0][0].style["border-radius"]=t.Panel.prototype.s_borderRadius+"px",this.m_containerGroup=this.m_groupOverlay.append("g").attr("class","textview_container").style("width",this.m_size.width-t.TextView.prototype.s_borderWidth).style("height",this.m_size.height-t.TextView.prototype.s_borderWidth).style("position","relative").style("overflow","auto"),i=50,s=100,this.m_topicText=new t.TopicText({x:i,y:s},this.m_size,"",this.m_level,this,this.m_linkedViews,this.m_data),this.m_topicText.Draw(this.m_containerGroup);var r=this.m_container.m_div.style("display");this.m_container.m_div.style("display","none"),this.m_container.m_div.style("display",r)}),t.TextView.method("CreateTextSVGFromJSON",function(e){var i=t.TextView.prototype.s_textStartPosition.x,s=t.TextView.prototype.s_textStartPosition.y,o=this.m_size.height+t.Panel.prototype.s_borderRadius,a=t.TopicBar.prototype.s_textInfo.yIncrement;this.m_groupOverlay.selectAll("*").remove();for(var n=0;n<e.json.lines_and_colors.length;n++)s+=a,s>this.m_size.height&&(o+=a);this.m_svg.attr("width",this.m_size.width).attr("height",o).attr("viewBox","0 0 "+this.m_size.width+" "+o),$(this.m_div[0][0]).scrollTop(0),this.m_panelRectSvg.attr("height",o).attr("viewBox","0 0 "+this.m_size.width+" "+o),this.m_container.m_div.selectAll(".rect_twic_graph").remove(),this.m_panelRect=this.m_panelRectSvg.append("path").attr("d",t.BottomRoundedRect(0,0,this.m_size.width,o,t.Panel.prototype.s_borderRadius)).attr("class","rect_twic_graph").attr("id","rect_twic_graph_textview_"+this.m_name).attr("fill",t.Level.prototype.s_palette.darkblue).style("position","absolute"),this.m_container.m_div[0][0].style["border-radius"]=t.Panel.prototype.s_borderRadius+"px",this.m_div.style("border-radius",t.Panel.prototype.s_borderRadius),this.m_panelRectDiv[0][0].style["border-radius"]=t.Panel.prototype.s_borderRadius+"px",this.m_clickRectangle=this.m_groupOverlay.append("rect").attr("x",0).attr("y",0).attr("width",this.m_size.width).attr("height",o).attr("fill",t.Level.prototype.s_palette.darkblue).style("opacity",0).on(t.Interaction.click,function(){t.GraphView.prototype.MouseBehavior(this,null,t.Interaction.click)}.bind(this)),this.m_containerGroup=this.m_groupOverlay.append("g").attr("class","textview_container").style("width",this.m_size.width-t.TextView.prototype.s_borderWidth).style("height",this.m_size.height-t.TextView.prototype.s_borderWidth).style("position","relative").style("overflow","auto"),i=50,s=100;for(var n=0;n<e.json.lines_and_colors.length;n++){words=e.json.lines_and_colors[n][0].split(" ");i=50;for(var r,l=0;l<words.length;l++)if("-1"==e.json.lines_and_colors[n][1][l]||void 0==e.json.lines_and_colors[n][1][l])r=this.m_containerGroup.append("text").attr("class","text_word").attr("x",i).attr("y",s).attr("dx","0").attr("dy","0").attr("fill",t.Level.prototype.s_palette.gold).style("font-family",t.Level.prototype.s_fontFamily).style("font-size",22).style("opacity",1).html(words[l]+"&nbsp;"),i+=.66*r[0][0].offsetWidth;else{var h=this.m_level.m_topicColorsLoBlend[e.json.lines_and_colors[n][1][l]],m="",p="",_=words[l];'"'==words[l][0]||"'"==words[l][0]?(m=words[l][0],p="b",_=words[l].substring(1,words[l].length)):('"'==words[l][words[l].length-1]||"'"==words[l][words[l].length-1])&&(m=words[l][words[l].length-1],p="a",_=words[l].substring(0,words[l].length-1)),"b"==p&&(r=this.m_containerGroup.append("text").attr("class","text_word").attr("x",i).attr("y",s).attr("dx","0").attr("dy","0").attr("fill",t.Level.prototype.s_palette.gold).style("font-family",t.Level.prototype.s_fontFamily).style("font-size",22).style("opacity",1).html(m),i+=.66*r[0][0].offsetWidth),tempTempWord="a"==p?_:_+"&nbsp;",r=this.m_containerGroup.append("text").attr("class","text_coloredword").datum({topicID:e.json.lines_and_colors[n][1][l],locolor:h,color:this.m_level.m_topicColors[e.json.lines_and_colors[n][1][l]],word:tempTempWord}).attr("x",i).attr("y",s).attr("dx","0").attr("dy","0").attr("fill",this.m_level.m_topicColors[e.json.lines_and_colors[n][1][l]]).style("font-family",t.Level.prototype.s_fontFamily).style("font-size",22).style("opacity",1).html(tempTempWord),i+=.66*r[0][0].offsetWidth,"a"==p&&(r=this.m_containerGroup.append("text").attr("class","text_word").attr("x",i).attr("y",s).attr("dx","0").attr("dy","0").attr("fill",t.Level.prototype.s_palette.gold).style("font-family",t.Level.prototype.s_fontFamily).style("font-size",22).style("opacity",1).html(m+"&nbsp;"),i+=.66*r[0][0].offsetWidth)}s+=a,s>this.m_size.height&&(o+=a)}this.m_svg.selectAll(".text_coloredword").attr("height",o).on(t.Interaction.click,function(e){this.MouseBehavior(e,t.Interaction.click)}.bind(this)).on(t.Interaction.mouseover,function(e){this.MouseBehavior(e,t.Interaction.mouseover)}.bind(this)).on(t.Interaction.mouseout,function(e){this.MouseBehavior(null,t.Interaction.mouseout)}.bind(this)),this.m_svg.selectAll(".text_word").on(t.Interaction.click,function(e){-1!=this.m_level.m_highlightedTopic&&this.MouseBehavior(null,t.Interaction.click)}.bind(this));var c=this.m_container.m_div.style("display");this.m_container.m_div.style("display","none"),this.m_container.m_div.style("display",c)}),t.TextView.method("DarkenAllWords",function(){var e=this.m_level;this.m_div.selectAll(".text_word").style("color",t.Level.prototype.s_palette.logold);var e=this.m_level;this.m_div.selectAll(".text_coloredword").style("color",function(t){if(void 0==t){var i=e.AddDataToSpanBasedOnColor(this);return i.locolor}return t.locolor})}),t.TextView.method("DarkenTopicText",function(t){this.m_div.selectAll(".text_coloredword").style("color",function(t){return t.locolor})}),t.TextView.method("Hide",function(e){if(e){this.m_recentDims={width:this.m_size.width,height:this.m_size.height+this.m_controlBar.m_size.height,extendedHeight:parseFloat(this.m_div.attr("scrollHeight"))},this.m_recentPos={x:parseFloat(this.m_container.m_div.style("left")),y:parseFloat(this.m_container.m_div.style("top"))};var i={position:{x:this.m_recentPos.x,y:this.m_recentPos.y},size:{width:t.Panel.prototype.s_minimumPanelSize,height:t.Control.prototype.s_defaultThickness},duration:500};this.ToggleResize(!0)}else{this.m_recentPos={x:parseFloat(this.m_container.m_div.style("left")),y:parseFloat(this.m_container.m_div.style("top"))},this.m_panelRectDiv.style("opacity",1);var i={position:{x:this.m_recentPos.x,y:this.m_recentPos.y},size:{width:this.m_recentDims.width,height:this.m_recentDims.height},duration:500};this.m_container.SetPosition({x:parseFloat(this.m_container.m_div.style("left")),y:parseFloat(this.m_container.m_div.style("top"))}),this.ToggleResize(!1)}this.m_hidden=e,this.AddBarText(this.m_hidden),this.m_hidden?this.Move(i,"end",function(){this.m_level.OrganizePanels(),this.m_controlBar.m_barPath.transition().duration(10).attr("d",t.FullyRoundedRect(this.m_coordinates.x,this.m_coordinates.y,this.m_container.m_size.width,t.Control.prototype.s_defaultThickness,t.Panel.prototype.s_borderRadius)),this.m_panelRectDiv.style("opacity",0)}.bind(this),!1):(this.m_controlBar.m_barPath.attr("d",t.TopRoundedRect(this.m_coordinates.x,this.m_coordinates.y,this.m_container.m_size.width,t.Control.prototype.s_defaultThickness,t.Panel.prototype.s_borderRadius)),this.Move(i,"end",function(){this.m_level.OrganizePanels()}.bind(this),!0))}),t.TextView.method("HighlightAllWords",function(){var e=this.m_level;this.m_div.selectAll(".text_word").style("color",t.Level.prototype.s_palette.gold),this.m_div.selectAll(".text_coloredword").style("color",function(t){if(void 0==t){var i=e.AddDataToSpanBasedOnColor(this);return i.color}return t.color})}),t.TextView.method("HighlightTopicText",function(t){this.m_level.m_highlightedTopic=t.topicID;var e=this.m_level;this.m_div.selectAll(".text_coloredword").filter(function(i){if(void 0==i){var s=e.AddDataToSpanBasedOnColor(this);return s.topicID==t.topicID}return i.topicID==t.topicID}).style("color",function(t){return t.color}),this.m_div.selectAll(".text_coloredword").filter(function(i){if(void 0==i){var s=e.AddDataToSpanBasedOnColor(this,e);return s.topicID!=t.topicID}return i.topicID!=t.topicID}).style("color",function(t){return t.locolor})}),t.TextView.method("Load",function(){d3.json(this.m_filename,function(e,i){this.m_data=i.document;var s={json:this.m_data,clusterIndex:0,topicID:0,color:this.m_level.m_topicColors[0]},o=this.IsPaused();this.Pause(!1),this.Update(s,t.Interaction.click),o&&this.Pause(!0)}.bind(this))}),t.TextView.method("MouseBehavior",function(e,i){if(-1==this.m_level.m_highlightedTopic)switch(i){case t.Interaction.mouseover:this.Update(e,t.Interaction.mouseover);for(var s=0;s<this.m_linkedViews.length;s++)t.Interaction.mouseover==this.m_linkedViews[s].update&&this.m_linkedViews[s].panel.Update(e,t.Interaction.mouseover);break;case t.Interaction.click:case t.Interaction.dblclick:this.Update(e,t.Interaction.mouseover),this.Pause(!0);for(var s=0;s<this.m_linkedViews.length;s++)t.Interaction.mouseover==this.m_linkedViews[s].update&&(this.m_linkedViews[s].panel instanceof t.DataBar&&this.m_linkedViews[s].panel.Update(e,t.Interaction.click),this.m_linkedViews[s].panel.Update(e,t.Interaction.mouseover)),this.m_linkedViews[s].panel.Pause(!0);break;case t.Interaction.mouseout:}else if(this.IsPaused())switch(i){case t.Interaction.mouseover:break;case t.Interaction.click:case t.Interaction.dblclick:if(null==e||e.topicID==this.m_level.m_highlightedTopic){this.Pause(!1),this.Update(null,t.Interaction.mouseover);for(var s=0;s<this.m_linkedViews.length;s++)this.m_linkedViews[s].panel.Pause(!1),this.m_linkedViews[s].panel.Update(null,t.Interaction.mouseover)}else{this.Pause(!1),this.Update(e,t.Interaction.mouseover),this.Pause(!0);for(var s=0;s<this.m_linkedViews.length;s++)this.m_linkedViews[s].panel.Pause(!1),t.Interaction.mouseover==this.m_linkedViews[s].update&&(this.m_linkedViews[s].panel instanceof t.DataBar&&this.m_linkedViews[s].panel.Update(e,t.Interaction.click),this.m_linkedViews[s].panel.Update(e,t.Interaction.mouseover)),this.m_linkedViews[s].panel.Pause(!0)}break;case t.Interaction.mouseout:}else switch(i){case t.Interaction.mouseover:this.Update(e,t.Interaction.mouseover);for(var s=0;s<this.m_linkedViews.length;s++)t.Interaction.mouseover==this.m_linkedViews[s].update&&this.m_linkedViews[s].panel.Update(e,t.Interaction.mouseover);break;case t.Interaction.click:case t.Interaction.dblclick:this.Update(e,t.Interaction.mouseover),this.Pause(!0);for(var s=0;s<this.m_linkedViews.length;s++)t.Interaction.mouseover==this.m_linkedViews[s].update&&(this instanceof t.DataBar&&this.m_linkedViews[s].panel.Update(e,t.Interaction.click),this.m_linkedViews[s].panel.Update(e,t.Interaction.mouseover)),this.m_linkedViews[s].panel.Pause(!0);break;case t.Interaction.mouseout:this.Update(null,t.Interaction.mouseover);for(var s=0;s<this.m_linkedViews.length;s++)this.m_linkedViews[s].panel.Update(null,t.Interaction.mouseover)}}),t.TextView.method("Move",function(e,i,s,o){e.position&&this.m_container.SetPosition(e.position),e.size&&this.m_container.SetSize(e.size),this.m_container.m_div.transition().duration(e.duration).style("left",this.m_container.m_coordinates.x).style("top",this.m_container.m_coordinates.y).style("width",this.m_container.m_size.width).style("height",this.m_container.m_size.height),this.m_div.transition().duration(e.duration).style("width",this.m_size.width).style("height",this.m_size.height).each("start",function(e,i,s,o){this.m_panelRectDiv.transition().duration(e.duration).style("width",e.size.width).style("height",e.size.height),this.m_panelRectSvg.transition().duration(e.duration).attr("width",e.size.width).attr("height",e.size.height).attr("viewBox","0 0 "+e.size.width+" "+e.size.height),this.m_panelRect.transition().duration(e.duration).attr("d",t.BottomRoundedRect(0,0,e.size.width,e.size.height,t.Panel.prototype.s_borderRadius)).each("end",function(){"end"==i&&s()}.bind(this,i,s)),"start"==i&&s()}.bind(this,e,i,s,o)),this.m_controlBar.m_size.width=this.m_size.width,this.m_controlBar.m_div.transition().duration(e.duration).style("width",this.m_size.width).each("start",function(t){this.m_controlBar.m_barPath.transition().duration(t.duration).attr("d",this.m_controlBar.GetRectPath()),this.m_controlBar.m_svg.transition().duration(t.duration).attr("width",this.m_size.width).attr("viewBox","0 0 "+this.m_size.width+" "+this.m_controlBar.m_size.height)}.bind(this,e))}),t.TextView.method("OnResize",function(e){var i=!0;void 0!==e&&(i=e);var s=parseFloat(this.m_container.m_div.style("width")),o=parseFloat(this.m_container.m_div.style("height")),a=this.m_controlBar?this.m_controlBar.m_size.height:0;this.m_controlBar&&(this.m_controlBar.m_size.width=s,this.m_controlBar.m_div.style("width",s),this.m_controlBar.m_svg.attr("width",s).attr("viewBox","0 0 "+s+" "+a)),this.m_size.width=Math.abs(s),this.m_size.height=Math.abs(o-a);var n=this.m_size.width,r=this.m_size.height;this.m_div.style("width",n).style("height",r),this.m_panelRectDiv.style("width",n).style("height",r+t.Panel.prototype.s_borderRadius),this.m_panelRectSvg.attr("width",n).attr("height",r+t.Panel.prototype.s_borderRadius).attr("viewBox","0 0 "+n+" "+(r+t.Panel.prototype.s_borderRadius)),s>parseInt(this.m_div.style("max-width"))&&(this.m_div.style("max-width",s),this.m_panelRectDiv.style("max-width",s)),o>parseInt(this.m_div.style("max-height")+a)&&(this.m_div.style("max-height",o-a),this.m_panelRectDiv.style("max-height",o-a)),this.m_panelRect.attr("d",t.BottomRoundedRect(0,0,n,r+t.Panel.prototype.s_borderRadius,t.Panel.prototype.s_borderRadius)),this.m_container.m_div.node().parentNode.appendChild(this.m_container.m_div.node()),i&&$(this.m_level.m_div[0]).packery(),this.m_controlBar&&this.m_controlBar.UpdateBarPath(this.m_controlBar.GetRectPath()),$(this.m_level.m_div.node().parentNode).hide().show(0)}),t.TextView.method("SetText",function(e,i){this.m_filename=i?e:t.TopicRectangle.prototype.jsonDirectory+e}),t.TextView.prototype.s_borderWidth=5,t.TextView.prototype.s_textStartPosition={x:50,y:100},t.TextView.prototype.s_datashapeClassName="text_shape",t.TextView.prototype.s_datashapeClassSelect=".text_shape",t.TextView.prototype.s_datashapeTextClassName="text_shape_text",t.TextView.prototype.s_datashapeTextClassSelect=".text_shape_text",t.PublicationView=function(e,i,s,o,a){t.GraphView.apply(this,arguments),this.m_name=o,this.m_filename=a,this.m_objectsJSON=[],this.m_twicObjects=[],this.m_numberTopics=5},t.PublicationView.inherits(t.GraphView),t.PublicationView.method("Initialize",function(e){this.m_container.SetPosition(this.m_coordinates),this.m_container.m_div.style("left",this.m_container.m_coordinates.x),this.m_container.m_div.style("top",this.m_container.m_coordinates.y),this.m_coordinates.x=0,this.m_coordinates.y=0;var i=this.m_controlBar?this.m_controlBar.m_size.height-1:0;this.m_panelRectDiv=e.append("div").attr("class","div_panel_rect").attr("id","div_panel_rect_"+this.m_name).style("position","absolute").style("left",this.m_coordinates.x).style("top",this.m_coordinates.y+i).style("width",this.m_size.width).style("height",this.m_size.height).style("max-width",this.m_size.width).style("max-height",this.m_size.height),this.m_panelRectSvg=this.m_panelRectDiv.append("svg").attr("x",this.m_coordinates.x).attr("y",this.m_coordinates.y).attr("width",this.m_size.width).attr("height",this.m_size.height).attr("viewBox","0 0 "+this.m_size.width+" "+this.m_size.height),this.m_panelRect=this.m_panelRectSvg.append("path").attr("d",t.BottomRoundedRect(this.m_coordinates.x,this.m_coordinates.y,this.m_size.width,this.m_size.height,t.Panel.prototype.s_borderRadius)).attr("class","rect_twic_graph").attr("id","rect_twic_graph_publicationview_"+this.m_name).attr("fill",t.Level.prototype.s_palette.darkblue).style("position","absolute"),
this.m_div=e.append("div").attr("class","div_twic_graph_publicationview div_twic_graph twic_panel").attr("id","div_twic_graph_publicationview_"+this.m_name).style("left",this.m_coordinates.x).style("top",this.m_coordinates.y+i).style("width",this.m_size.width).style("height",this.m_size.height).style("max-width",this.m_size.width).style("max-height",this.m_size.height).style("overflow","scroll").style("border-radius",t.Panel.prototype.s_borderRadius).style("position","absolute"),this.m_svg=this.m_div.append("svg").attr("class","svg_twic_graph").attr("id","svg_twic_graph_publicationview_"+this.m_name).attr("x",this.m_coordinates.x).attr("y",this.m_coordinates.y).attr("width",this.m_size.width).attr("height",this.m_size.height).attr("viewBox","0 0 "+this.m_size.width+" "+this.m_size.height),this.m_groupOverlay=this.m_svg.append("g").attr("class","group_twic_graph_overlay").attr("id","group_twic_graph_overlay_publicationview_"+this.m_name),this.m_clickRectangle=this.m_groupOverlay.append("rect").attr("x",0).attr("y",0).attr("width",this.m_size.width).attr("height",this.m_size.height).attr("fill",t.Level.prototype.s_palette.darkblue).style("opacity",0).on(t.Interaction.click,function(){t.GraphView.prototype.MouseBehavior(this,null,t.Interaction.click)}.bind(this)),this.m_clusterSvgGroup=this.m_groupOverlay.append("g").attr("id","clustersvg_group").attr("width",this.m_size.width).attr("height",this.m_size.height),this.m_controlBar.m_barPath.attr("fill",t.Level.prototype.s_palette.darkblue).style("opacity",1),this.Load(),this.Start(),this.MakeDraggable(),this.m_underlyingPanelOpen=!0}),t.PublicationView.method("Start",function(){this.m_level.m_queue.await(function(){this.AddBarText(!1),this.MakeResizable(!1);for(var e=0,i=[],s=0,o=this.m_size.height>>4,a=this.m_size.height>>3,n=o,r=0,l=0;l<this.m_twicObjects.length;l++)l+1<this.m_twicObjects.length&&parseInt(this.m_data.texts[l].page)-1>e&&(i.push({start:n,mid:s>>1,r:r}),n+=s+a,s=0,e++),this.m_twicObjects[l].m_size.height+2*t.TopicRectangle.prototype.borderWidth*this.m_numberTopics>s&&(s=this.m_twicObjects[l].m_size.height+2*t.TopicRectangle.prototype.borderWidth*this.m_numberTopics,r=this.m_twicObjects[l].m_radius);i.push({start:n,mid:s>>1,r:r});var h=this.m_size.width>>4,m=h;e=0;for(var l=0;l<this.m_twicObjects.length;l++){if(parseInt(this.m_data.texts[l].page)-1>e&&(e++,m=h),this.m_twicObjects[l].m_coordinates={x:m,y:i[e].start+i[e].mid-(this.m_twicObjects[l].m_size.height>>1)},this.m_twicObjects[l].Draw(),l+1==this.m_twicObjects.length){var p=i[e].start+2*i[e].mid+i[e].r;this.m_svg.attr("height",p).attr("viewBox","0 0 "+this.m_size.width+" "+p),this.m_panelRectSvg.attr("height",p).attr("viewBox","0 0 "+this.m_size.width+" "+p),this.m_container.m_div.selectAll(".rect_twic_graph").remove(),this.m_panelRect=this.m_panelRectSvg.append("path").attr("d",t.BottomRoundedRect(0,0,this.m_size.width,p,t.Panel.prototype.s_borderRadius)).attr("class","rect_twic_graph").attr("id","rect_twic_graph_publicationview_"+this.m_name).attr("fill",t.Level.prototype.s_palette.darkblue).style("position","absolute"),this.m_div.style("border-radius",t.Panel.prototype.s_borderRadius),this.m_panelRectDiv.style("border-radius",t.Panel.prototype.s_borderRadius)}m+=h+this.m_twicObjects[l].m_size.width+2*t.TopicRectangle.prototype.borderWidth*this.m_numberTopics}e=0;for(var l=0;l<this.m_twicObjects.length;l++)parseInt(this.m_data.texts[l].page)-1>e&&e++,l+1<this.m_twicObjects.length&&this.m_data.texts[l+1].page==this.m_data.texts[l].page&&this.m_clusterSvgGroup.append("line").attr("stroke-linecap","square").attr("x1",this.m_twicObjects[l].m_coordinates.x+this.m_twicObjects[l].m_size.width+this.m_numberTopics*t.TopicRectangle.prototype.borderWidth).attr("y1",i[e].start+i[e].mid).attr("x2",this.m_twicObjects[l+1].m_coordinates.x-this.m_numberTopics*t.TopicRectangle.prototype.borderWidth).attr("y2",i[e].start+i[e].mid).style("stroke",t.Level.prototype.s_palette.gold).style("stroke-width",5).style("opacity",TWiC.TopicBullseye.s_semihighlightedOpacity),this.m_twicObjects[l].AddTextTag(this.m_data.texts[l].title,20,TWiC.Level.prototype.s_palette.gold,{x:this.m_twicObjects[l].m_coordinates.x-(7*this.m_data.texts[l].title.length>>1),y:this.m_twicObjects[l].m_coordinates.y+2.85*this.m_twicObjects[l].m_radius},0);for(var l=0;l<this.m_twicObjects.length;l++){var _=d3.select("#textrect_node_"+this.m_twicObjects[l].m_name);_.node().parentNode.appendChild(_.node())}this.HighlightAllDataShapes(!0)}.bind(this))}),t.PublicationView.method("Update",function(e,i){if(this.m_paused){if(i&&t.Interaction.dblclick==i){for(var s=0;s<this.m_linkedViews.length;s++)t.Interaction.dblclick==this.m_linkedViews[s].update&&this.m_linkedViews[s].panel.Update(e,i);d3.event.stopPropagation()}}else if(i&&t.Interaction.mouseover==i)null!=e?this.HighlightAllDataShapesWithTopic(e):this.HighlightAllDataShapes(!0);else if(i&&t.Interaction.dblclick==i){for(var s=0;s<this.m_linkedViews.length;s++)t.Interaction.dblclick==this.m_linkedViews[s].update&&this.m_linkedViews[s].panel.Update(e,i);d3.event.stopPropagation()}}),t.PublicationView.method("AddBarText",function(e){this.m_controlBar.AddText(function(i){e?(this.m_controlBar.m_barText.selectAll("*").remove(),i.m_barText.append("tspan").html("TWiC:&nbsp;").attr("fill",t.Level.prototype.s_palette.lightpurple).style("font-family",t.Level.prototype.s_fontFamily).style("font-size",25),i.m_barText.append("tspan").html("Publication View").attr("fill",t.Level.prototype.s_palette.gold).style("font-family",t.Level.prototype.s_fontFamily).style("font-size",25)):(this.m_textFirstSet||(this.m_textPos={x:i.GetNextWidgetPos().x,y:i.GetNextWidgetPos().y},this.m_textFirstSet=!0),i.m_barPath.attr("fill",t.Level.prototype.s_palette.darkblue).style("opacity",1),null==i.m_barText&&(i.m_barText=i.m_controlGroup.append("text").attr("x",this.m_textPos.x).attr("y",this.m_textPos.y)),null!=this.m_data&&(this.m_controlBar.m_barText.selectAll("*").remove(),i.m_barText.append("tspan").html("TWiC:&nbsp;").attr("fill",t.Level.prototype.s_palette.lightpurple).style("font-family",t.Level.prototype.s_fontFamily).style("font-size",25),i.m_barText.append("tspan").html('"'+this.m_data.title+'"').attr("fill",t.Level.prototype.s_palette.gold).style("font-family",t.Level.prototype.s_fontFamily).style("font-size",23)))}.bind(this))}),t.PublicationView.method("DarkenAllDataShapes",function(){var t=this.m_svg.selectAll(TWiC.PublicationView.prototype.s_datashapeClassSelect);t.each(function(t){"path"==this.nodeName||"circle"==this.nodeName?d3.select(this).style("fill",t.locolor).style("opacity",TWiC.DataShape.prototype.s_semihighlightedOpacity):"rect"==this.nodeName?d3.select(this).style("stroke",t.locolor).style("stroke-opacity",TWiC.DataShape.prototype.s_semihighlightedOpacity):"g"==this.nodeName&&(d3.select(this).selectAll("rect").style("opacity",TWiC.DataShape.prototype.s_semihighlightedOpacity),d3.select(this).selectAll("path").style("opacity",TWiC.DataShape.prototype.s_semihighlightedOpacity))}),this.m_svg.selectAll(TWiC.PublicationView.prototype.s_datashapeTextClassSelect).selectAll("tspan").style("opacity",0)}),t.PublicationView.method("HighlightAllDataShapes",function(t){var e=this.m_svg.selectAll(TWiC.PublicationView.prototype.s_datashapeClassSelect);e.each(function(t){"path"==this.nodeName||"circle"==this.nodeName?d3.select(this).style("fill",t.color).style("opacity",1):"rect"==this.nodeName?(d3.select(this).style("stroke",t.color).style("opacity",1).style("stroke-opacity",1),t.shapeRef&&t.shapeRef.m_textRect.classed("text_info_rect")&&t.shapeRef.m_textRect.attr("opacity",1).attr("stroke-opacity",1)):"g"==this.nodeName&&(d3.select(this).selectAll("rect").style("opacity",1),d3.select(this).selectAll("path").style("opacity",1))}),t?this.m_svg.selectAll(TWiC.PublicationView.prototype.s_datashapeTextClassSelect).selectAll("tspan").style("opacity",1):this.m_svg.selectAll(TWiC.PublicationView.prototype.s_datashapeTextClassSelect).selectAll("tspan").style("opacity",0)}),t.PublicationView.method("HighlightAllDataShapesWithTopic",function(t){this.DarkenAllDataShapes(),this.m_level.m_highlightedTopic=t.topicID;var e=this.m_svg.selectAll(TWiC.PublicationView.prototype.s_datashapeClassSelect).filter(function(e){return e.topicID==t.topicID});e.each(function(e){"path"==this.nodeName||"circle"==this.nodeName?d3.select(this).style("fill",e.color).style("opacity",1):"rect"==this.nodeName?(d3.select(this).style("stroke",e.color).style("opacity",1).style("stroke-opacity",1),d3.select(this.parentNode.parentNode.parentNode).selectAll(".text_info_rect").style("opacity",1),e.shapeRef&&e.shapeRef.m_textRect.classed("text_info_rect")&&e.shapeRef.m_textRect.datum().topicID!=t.topicID&&d3.select(this.parentNode.parentNode.parentNode).selectAll(".text_info_rect").style("stroke-opacity",TWiC.DataShape.prototype.s_semihighlightedOpacity)):"g"==this.nodeName&&(d3.select(this).selectAll("rect").style("opacity",1),d3.select(this).selectAll("path").style("opacity",1));var i=d3.select(this.parentNode).selectAll(TWiC.PublicationView.prototype.s_datashapeClassSelect).filter(function(e){return e.topicID!=t.topicID});i.each(function(t){"path"==this.nodeName||"circle"==this.nodeName?d3.select(this).style("fill",t.locolor).style("opacity",1):"rect"==this.nodeName?d3.select(this).style("stroke",t.locolor).style("stroke-opacity",1):"g"==this.nodeName&&(d3.select(this).selectAll("rect").style("opacity",1),d3.select(this).selectAll("path").style("opacity",1))}),e&&e.shapeRef&&e.shapeRef.m_textTag.selectAll("tspan").style("opacity",1)})}),t.PublicationView.method("Load",function(){this.m_level.m_queue.defer(function(t){d3.json(TWiC.Level.prototype.s_jsonDirectory+this.m_filename,function(e,i){this.m_data=i;for(var s=0;s<this.m_data.count;s++){for(var o={id:0,value:this.m_level.m_corpusInfo.file_info[this.m_data.texts[s].file][2][0]},a=0;a<this.m_level.m_corpusInfo.file_info[this.m_data.texts[s].file][2].length;a++)this.m_level.m_corpusInfo.file_info[this.m_data.texts[s].file][2][a]>o.value&&(o.id=a,o.value=this.m_level.m_corpusInfo.file_info[this.m_data.texts[s].file][2][a]);var n=new TWiC.TopicRectangle({x:0,y:0},{width:0,height:0},this.m_data.texts[s].file,this.m_level,this,this.m_linkedViews,o.id,this.m_numberTopics);n.Load(),n.SetTitle(this.m_data.texts[s].title);var r={name:this.m_data.texts[s].title,topics:this.m_level.m_corpusInfo.file_info[this.m_data.texts[s].file][2]};this.m_objectsJSON.push(r),this.m_twicObjects.push(n)}t(null,i)}.bind(this))}.bind(this))}),t.PublicationView.method("Move",function(e,i,s){e.position&&this.m_container.SetPosition(e.position),e.size&&this.m_container.SetSize(e.size),this.m_container.m_div.transition().duration(e.duration).style("left",this.m_container.m_coordinates.x).style("top",this.m_container.m_coordinates.y).style("width",this.m_container.m_size.width).style("height",this.m_container.m_size.height),this.m_div.transition().duration(e.duration).style("width",this.m_size.width).style("height",this.m_size.height).each("start",function(e,i,s){this.m_panelRectDiv.transition().duration(e.duration).style("width",e.size.width).style("height",e.size.height-this.m_controlBar.m_size.height),this.m_panelRectSvg.transition().duration(e.duration).attr("width",e.size.width).attr("height",e.size.height-this.m_controlBar.m_size.height).attr("viewBox","0 0 "+e.size.width+" "+(e.size.height-this.m_controlBar.m_size.height)),this.m_panelRect.transition().duration(e.duration).attr("d",t.BottomRoundedRect(0,0,e.size.width,e.size.height-this.m_controlBar.m_size.height,t.Panel.prototype.s_borderRadius)),this.m_svg.transition().duration(e.duration).attr("width",this.m_size.width).attr("height",this.m_size.height).each("end",function(){"end"==i&&s()}.bind(this,i,s)),"start"==i&&s()}.bind(this,e,i,s)),this.m_controlBar.m_size.width=this.m_size.width,this.m_controlBar.m_div.transition().duration(e.duration).style("width",this.m_size.width).each("start",function(t){this.m_controlBar.m_barPath.transition().duration(t.duration).attr("d",this.m_controlBar.GetRectPath()),this.m_controlBar.m_svg.transition().duration(t.duration).attr("width",this.m_size.width).attr("viewBox","0 0 "+this.m_size.width+" "+this.m_controlBar.m_size.height)}.bind(this,e))}),t.PublicationView.method("OpenUnderlyingPanel",function(e,i,s){for(var o=new t.TextView({x:i.x,y:i.y},{width:s.width,height:s.height},this.m_level),a=0;a<this.m_linkedViews.length;a++)this.m_linkedViews[a].panel instanceof t.InformationView&&o.AddLinkedView(this.m_linkedViews[a].panel,t.Interaction.mouseover);this.AddLinkedView(o,t.Interaction.mouseover),o.AddLinkedView(this,t.Interaction.mouseover),this.AddLinkedView(o,t.Interaction.dblclick),this.m_level.m_infoViews[0].m_panel.AddLinkedView(o,t.Interaction.click),o.m_container.Initialize(this.m_level.m_div),o.m_container.Start(),o.m_div.style("opacity",0),o.m_controlBar.m_div.style("opacity",0),o.m_panelRectDiv.style("opacity",0),o.m_div.transition().delay(500).duration(3e3).style("opacity",1),o.m_controlBar.m_div.transition().delay(500).duration(3e3).style("opacity",1),o.m_panelRectDiv.transition().delay(500).duration(3e3).style("opacity",1),o.Update(e,t.Interaction.dblclick),-1!=this.m_level.m_highlightedTopic?o.Update(e,t.Interaction.mouseover):o.Update(null,t.Interaction.mouseover),this.m_underlyingPanelOpen=!0}),t.PublicationView.prototype.s_datashapeClassName="publication_shape",t.PublicationView.prototype.s_datashapeClassSelect=".publication_shape",t.PublicationView.prototype.s_datashapeTextClassName="publication_shape_text",t.PublicationView.prototype.s_datashapeTextClassSelect=".publication_shape_text",t.InformationView=function(e,i,s){t.Panel.apply(this,arguments)},t.InformationView.inherits(t.Panel),t.TopicBar=function(e,i,s){t.InformationView.apply(this,arguments)},t.TopicBar.inherits(t.InformationView),t.TopicBar.method("Initialize",function(e){this.m_coordinates.x=0,this.m_coordinates.y=0,this.m_level.m_highlightedTopic=-1,this.m_div=e.append("div").attr("class","div_twic_info_topicbar div_twic_info twic_panel").attr("id","div_twic_info_topicbar_"+this.m_name).style("width",this.m_size.width).style("height",this.m_size.height).style("overflow","auto").style("border-radius",t.Panel.prototype.s_borderRadius).style("position","relative"),this.m_svg=this.m_div.append("svg").attr("class","svg_twic_info").attr("id","svg_twic_info_topicbar_"+this.m_name).attr("x",this.m_coordinates.x).attr("y",this.m_coordinates.y).attr("width",this.m_size.width).attr("height",this.m_size.height),this.m_groupOverlay=this.m_svg.append("g").attr("class","group_twic_topicbar"),this.m_panelRect=this.m_groupOverlay.append("rect").attr("class","rect_twic_topicbar").attr("id","rect_twic_topicbar_"+this.m_name).attr("x",this.m_coordinates.x).attr("y",this.m_coordinates.y).attr("width",this.m_size.width).attr("height",this.m_size.height).attr("fill",t.Level.prototype.s_palette.darkblue).attr("rx",t.Panel.prototype.s_borderRadius).attr("ry",t.Panel.prototype.s_borderRadius);for(var i,s=[],o=0;o<this.m_level.m_topicWordLists.length;o++){i="Topic "+o.toString()+": ";for(var a=0;a<this.m_level.m_topicWordLists[o].length;a++)i+=this.m_level.m_topicWordLists[o][a]+" ";s.push(i.trim())}for(var n=0,r=0,l=t.TopicBar.prototype.s_textInfo.fontSize;r<s.length;r++){var h=this.m_groupOverlay.append("rect").attr("class","topic_highlightrect").attr("id","topic_"+r).attr("fill",this.m_level.m_topicColors[r]),m=this.m_groupOverlay.append("text").attr("class","topic_wordlist").attr("id","topic_"+r).datum({id:r.toString()}).attr("x","0").attr("y",l).attr("dx","0").attr("dy","0").attr("fill",this.m_level.m_topicColors[r]).on(t.Interaction.click,function(e){if(1==parseInt(this.m_svg.select(".topic_highlightrect#topic_"+e.id).attr("opacity"))){var i=null;this.Update(i,t.Interaction.click);for(var s=0;s<this.m_linkedViews.length;s++)t.Interaction.click==this.m_linkedViews[s].update&&(this.m_linkedViews[s].panel.Pause(!1),this.m_linkedViews[s].panel.Update(i,t.Interaction.mouseover));this.Pause(!1)}else{var i={topicID:e.id,color:this.m_level.m_topicColors[e.id]};this.HighlightText(i);for(var s=0;s<this.m_linkedViews.length;s++)if(t.Interaction.click==this.m_linkedViews[s].update){var o=this.m_linkedViews[s].panel.IsPaused();o?(this.m_linkedViews[s].panel.Pause(!1),this.m_linkedViews[s].panel.Update(i,t.Interaction.mouseover),this.m_linkedViews[s].panel.Pause(!0)):(this.m_linkedViews[s].panel.Update(i,t.Interaction.mouseover),this.m_linkedViews[s].panel.Pause(!0))}this.Pause(!0)}}.bind(this)),p=textFlow(s[r],m[0][0],this.m_size.width,t.TopicBar.prototype.s_textInfo.fontSize,t.TopicBar.prototype.s_textInfo.yIncrement,!1),_=m.selectAll("tspan")[0].length;p=t.TopicBar.prototype.s_textInfo.yIncrement*_,h.datum({dy:n+p,height:p,lines:_}).attr("x",m.attr("x")).attr("y",parseInt(m.attr("y"))-parseInt(m.style("font-size"))).attr("width",this.m_size.width).attr("height",p).attr("opacity",0),l+=p,n+=p}this.m_svg.attr("height",n),this.m_panelRect.attr("height",n),this.MakeResizable(!1),this.MakeDraggable()}),t.TopicBar.method("HighlightText",function(t){-1!=this.m_level.m_highlightedTopic&&(d3.select(".topic_wordlist#topic_"+this.m_level.m_highlightedTopic).attr("fill",function(t){return this.m_level.m_topicColors[this.m_level.m_highlightedTopic]}.bind(this)),d3.select(".topic_highlightrect#topic_"+this.m_level.m_highlightedTopic).attr("fill",this.m_div.style("background-color")).attr("opacity","0")),d3.select(".topic_wordlist#topic_"+t.topicID).attr("fill",this.m_div.style("background-color")),d3.select(".topic_highlightrect#topic_"+t.topicID).attr("fill",t.color).attr("opacity","1"),this.m_level.m_highlightedTopic=t.topicID}),t.TopicBar.method("Update",function(e,i){if(this.m_paused)t.Interaction.click==i&&(this.m_svg.selectAll(".topic_wordlist").attr("fill",function(t){return this.m_level.m_topicColors[t.id]}.bind(this)),this.m_svg.selectAll(".topic_highlightrect").attr("fill",this.m_panelRect.attr("fill")).attr("opacity",0),this.m_level.m_highlightedTopic=-1);else if(null!=e){this.m_svg.select(".topic_wordlist#topic_"+e.topicID).attr("fill",this.m_panelRect.attr("fill")),this.m_svg.select(".topic_highlightrect#topic_"+e.topicID).attr("fill",e.color).attr("opacity",1);var s=this.m_svg.select(".topic_highlightrect#topic_"+e.topicID).datum().dy,o=this.m_svg.select(".topic_highlightrect#topic_"+e.topicID).datum().lines;$(this.m_div[0][0]).scrollTop(s-o*t.TopicBar.prototype.s_textInfo.yIncrement),this.m_level.m_highlightedTopic=e.topicID}else this.m_svg.selectAll(".topic_wordlist").attr("fill",function(t){return this.m_level.m_topicColors[t.id]}.bind(this)),this.m_svg.selectAll(".topic_highlightrect").attr("fill",this.m_panelRect.attr("fill")).attr("opacity",0),$(this.m_div[0][0]).scrollTop(0),this.m_level.m_highlightedTopic=-1}),t.TopicBar.method("MakeResizable",function(e){void 0===e&&(e=!0);var i=t.Panel.prototype.s_minimumPanelSize,s=t.TopicBar.prototype.s_minHeight;$(this.m_container.m_div[0]).resizable({alsoResize:"#"+$(this.m_container.m_div[0]).attr("id")+" .twic_panel",aspectRatio:e,autoHide:!0,minWidth:i,minHeight:s,maxWidth:this.m_level.m_size.width,maxHeight:this.m_level.m_size.height,handles:"n, s, e, w, nw, ne, sw, se",resize:function(){this.OnResize(!1),this.m_level.m_resizeOccurred=!0}.bind(this)}),$(this.m_container.m_div[0]).resizable("option","autoHide",!0)}),t.TopicBar.method("Move",function(t,e,i){t.position&&this.m_container.SetPosition(t.position),t.size&&this.m_container.SetSize(t.size),this.m_container.m_div.transition().duration(t.duration).style("left",this.m_container.m_coordinates.x).style("top",this.m_container.m_coordinates.y).style("width",this.m_container.m_size.width).style("height",this.m_container.m_size.height),this.m_div.transition().duration(t.duration).style("width",this.m_size.width).style("height",this.m_size.height).each(e,i),$(this.m_div[0][0]).scrollTop()}),t.TopicBar.method("OnResize",function(t){var e=!0;void 0!==t&&(e=t);var i=parseFloat(this.m_container.m_div.style("width")),s=parseFloat(this.m_container.m_div.style("height")),o=this.m_controlBar?this.m_controlBar.m_size.height:0;this.m_controlBar&&(this.m_controlBar.m_size.width=i,this.m_controlBar.m_div.style("width",i),this.m_controlBar.m_svg.attr("width",i).attr("viewBox","0 0 "+i+" "+o));({width:parseInt(this.m_svg.attr("width")),height:parseInt(this.m_svg.attr("height"))}),{width:i/this.m_size.width,height:s/this.m_size.height};this.m_size.width=Math.abs(i),this.m_size.height=Math.abs(s-o);var a=this.m_size.width,n=this.m_size.height;this.m_div.style("width",a).style("height",n),i>parseInt(this.m_div.style("max-width"))&&this.m_div.style("max-width",i),s>parseInt(this.m_div.style("max-height")+o)&&this.m_div.style("max-height",s-o),this.m_container.m_div.node().parentNode.appendChild(this.m_container.m_div.node()),e&&$(this.m_level.m_div[0]).packery(),$(this.m_level.m_div.node().parentNode).hide().show(0)}),t.TopicBar.prototype.s_minHeight=200,t.TopicBar.prototype.s_textInfo={yStart:-1400,yIncrement:30,fontSize:20},t.DataBar=function(e,i,s){t.InformationView.apply(this,arguments),this.m_topicDataTiles=[],this.m_metaDataTiles=[],this.m_wordWeightDataTiles=[],this.m_nextTilePos={x:0,y:0},this.m_highlightIndex=-1},t.DataBar.inherits(t.InformationView),t.DataBar.method("Initialize",function(e){this.m_container.SetPosition(this.m_coordinates),this.m_container.m_div.style("left",this.m_container.m_coordinates.x).style("top",this.m_container.m_coordinates.y).style("overflow","hidden").style("border-radius",t.Panel.prototype.s_borderRadius),this.m_coordinates.x=0,this.m_coordinates.y=0;var i=this.m_controlBar?this.m_controlBar.m_size.height-2:0;this.m_panelRectDiv=e.append("div").attr("class","div_panel_rect").attr("id","div_panel_rect_"+this.m_name).style("position","absolute").style("left",this.m_coordinates.x).style("top",this.m_coordinates.y+i).style("width",this.m_size.width).style("height",this.m_size.height).style("max-width",this.m_level.m_size.width).style("max-height",this.m_level.m_size.height).style("border-radius",t.Panel.prototype.s_borderRadius),this.m_panelRectSvg=this.m_panelRectDiv.append("svg").attr("x",this.m_coordinates.x).attr("y",this.m_coordinates.y).attr("width",this.m_size.width).attr("height",this.m_size.height).attr("viewBox","0 0 "+this.m_size.width+" "+this.m_size.height),this.m_panelRect=this.m_panelRectSvg.append("path").attr("d",t.BottomRoundedRect(this.m_coordinates.x,this.m_coordinates.y,this.m_size.width,this.m_size.height,t.Panel.prototype.s_borderRadius)).attr("class","rect_twic_graph").attr("id","rect_twic_graph_databar_"+this.m_name).attr("fill",t.Level.prototype.s_palette.darkblue).style("position","absolute"),this.m_div=e.append("div").attr("class","div_twic_graph_databar div_twic_graph twic_panel").attr("id","div_twic_graph_databar_"+this.m_name).style("left",this.m_coordinates.x).style("top",this.m_coordinates.y+i).style("width",this.m_size.width).style("height",this.m_size.height).style("max-width",this.m_level.m_size.width).style("max-height",this.m_level.m_size.height).style("border-radius",t.Panel.prototype.s_borderRadius).style("position","absolute"),this.m_svg=this.m_div.append("svg").attr("class","svg_twic_graph").attr("id","svg_twic_graph_databar_"+this.m_name).attr("x",this.m_coordinates.x).attr("y",this.m_coordinates.y).attr("width",this.m_size.width).attr("height",this.m_size.height).attr("viewBox","0 0 "+this.m_size.width+" "+this.m_size.height),this.m_minDims={width:this.m_size.width,height:this.m_size.height},this.m_groupOverlay=this.m_svg.append("g").attr("class","group_twic_graph_overlay").attr("id","group_twic_graph_overlay_databar_"+this.m_name),this.m_tileGroup=this.m_groupOverlay.append("g").attr("id","tile_group").attr("width",this.m_size.width).attr("height",this.m_size.height),this.m_controlBar.m_barPath.attr("fill",t.Level.prototype.s_palette.darkblue).style("opacity",1),this.AddBarText(t.DataBar.prototype.s_defaultTitle,""),this.MakeResizable(!1),this.MakeDraggable()}),t.DataBar.method("Start",function(){this.Update({shapeRef:this.m_level.m_graphViews[0].m_panel.m_corpusCluster},t.Interaction.click)}),t.DataBar.method("Update",function(e,i,s){if(t.Interaction.click==i){if(void 0===e.shapeRef){if(void 0!==e.word){this.m_tileGroup.selectAll("*").remove(),this.m_currentShape=e.shapeRef,this.m_topicDataTiles=[],this.m_wordWeightDataTiles=[],this.m_nextTilePos.y=0;var o=this.m_controlBar?this.m_controlBar.m_size.height-1:0,a=t.DataBar.prototype.s_defaultTitle,n="",r=0;a="Words of Topic",n=e.topicID,this.AddBarText(a,n,!1),this.m_hidden&&this.AddBarText("",0,!0),o+=this.DrawWordWeightTiles(o,e),this.m_svg.attr("width",this.m_size.width).attr("height",o).attr("viewBox","0 0 "+this.m_size.width+" "+o),this.m_minDims.width=this.m_size.width,this.m_minDims.height=o,$(this.m_div[0][0]).scrollTop(0),this.m_panelRectSvg.attr("height",o).attr("viewBox","0 0 "+this.m_size.width+" "+o),this.m_panelRectSvg.selectAll("*").remove(),this.m_panelRect=this.m_panelRectSvg.append("path").attr("d",t.BottomRoundedRect(0,0,this.m_size.width,o,t.Panel.prototype.s_borderRadius)).attr("class","rect_twic_graph").attr("id","rect_twic_graph_databar_"+this.m_name).attr("fill",t.Level.prototype.s_palette.darkblue).style("position","absolute"),this.m_container.m_div[0][0].style["border-radius"]=t.Panel.prototype.s_borderRadius+"px",this.m_div.style("border-radius",t.Panel.prototype.s_borderRadius),this.m_panelRectDiv[0][0].style["border-radius"]=t.Panel.prototype.s_borderRadius+"px"}}else if(e.shapeRef!=this.m_currentShape){this.m_tileGroup.selectAll("*").remove(),this.m_currentShape=e.shapeRef,this.m_topicDataTiles=[],this.m_wordWeightDataTiles=[],this.m_nextTilePos.y=0;var o=this.m_controlBar?this.m_controlBar.m_size.height-1:0,a=t.DataBar.prototype.s_defaultTitle,n="",r=0;if(e.shapeRef instanceof t.TopicBullseye){if(this.m_level.m_corpusMap.name==e.shapeRef.m_name)a=e.shapeRef.m_name;else if(isNaN(parseInt(e.shapeRef.m_name)))t.CorpusClusterView.prototype.s_infoFlavorText==e.shapeRef.m_name?a=e.shapeRef.m_name:t.TextClusterView.prototype.s_infoFlavorText==e.shapeRef.m_name&&(a=e.shapeRef.m_name,n=e.shapeRef.m_panel.m_clusterIndex);else{a="Topic Cluster",n=e.shapeRef.m_name;var l=e.shapeRef.m_panel;r=l.m_adjustedDistances[parseInt(e.shapeRef.m_title)]-(l.b_adjustDistances?l.m_linkDistLimits.min:0),r=Math.abs(r)}this.AddBarText(a,n,!1)}else if(e.shapeRef instanceof t.TopicRectangle){a=e.shapeRef.m_title;var l=e.shapeRef.m_panel;l.m_adjustedDistances&&(r=l.m_adjustedDistances[e.shapeRef.m_panelNodeIndex]-(l.b_adjustDistances?l.m_linkDistLimits.min:0),r=Math.abs(r)),this.AddBarText(a,n,!1)}this.m_hidden&&this.AddBarText("",0,!0),o+=this.DrawMetaDataTiles(o,e,r,e.shapeRef.m_textCount),o+=this.DrawTopicTiles(o,e),this.m_svg.attr("width",this.m_size.width).attr("height",o).attr("viewBox","0 0 "+this.m_size.width+" "+o),this.m_minDims.width=this.m_size.width,this.m_minDims.height=o,$(this.m_div[0][0]).scrollTop(0),this.m_panelRectSvg.attr("height",o).attr("viewBox","0 0 "+this.m_size.width+" "+o),this.m_panelRectSvg.selectAll("*").remove(),this.m_panelRect=this.m_panelRectSvg.append("path").attr("d",t.BottomRoundedRect(0,0,this.m_size.width,o,t.Panel.prototype.s_borderRadius)).attr("class","rect_twic_graph").attr("id","rect_twic_graph_databar_"+this.m_name).attr("fill",t.Level.prototype.s_palette.darkblue).style("position","absolute"),this.m_container.m_div[0][0].style["border-radius"]=t.Panel.prototype.s_borderRadius+"px",this.m_div.style("border-radius",t.Panel.prototype.s_borderRadius),this.m_panelRectDiv[0][0].style["border-radius"]=t.Panel.prototype.s_borderRadius+"px"}}else if(t.Interaction.mouseover==i&&!this.IsPaused()){var h=0==this.m_wordWeightDataTiles.length?this.m_topicDataTiles:this.m_wordWeightDataTiles;if(null!=e){for(var m=0;m<h.length;m++)if(e.topicID==h[m].m_topicID){h[m].HighlightTile(!0),this.m_highlightIndex=m,this.m_level.m_highlightedTopic=e.topicID,void 0===s&&$(this.m_div[0][0]).scrollTop(h[m].m_coordinates.y);break}}else{for(var m=0;m<h.length;m++)h[m].HighlightTile(!1);this.m_highlightIndex=-1,void 0===s&&$(this.m_div[0][0]).scrollTop(0)}}}),t.DataBar.method("AddBarText",function(e,i,s){this.m_controlBar.AddText(function(e,i,s){console.log("Bar Text"),console.log(e),this.m_controlGroup.selectAll("text").remove("*"),this.m_textFirstSet||(this.m_textPos={x:this.GetNextWidgetPos().x,y:this.GetNextWidgetPos().y},this.m_textFirstSet=!0),this.m_barText=this.m_controlGroup.append("text").attr("x",this.m_textPos.x).attr("y",this.m_textPos.y),s?(this.m_barPath.attr("fill",t.Level.prototype.s_palette.darkblue).style("opacity",1),this.m_barText.append("tspan").html("TWiC:&nbsp;").attr("fill",t.Level.prototype.s_palette.lightpurple).style("font-family",t.Level.prototype.s_fontFamily).style("font-size",25),this.m_barText.append("tspan").html("Data Bar").attr("fill",t.Level.prototype.s_palette.gold).style("font-family",t.Level.prototype.s_fontFamily).style("font-size",25)):(this.m_recentPanelTitle=e,this.m_recentPanelID=i,this.m_barPath.attr("fill",t.Level.prototype.s_palette.darkblue).style("opacity",1),this.m_barText.append("tspan").html("TWiC:&nbsp;").attr("fill",t.Level.prototype.s_palette.lightpurple).style("font-family",t.Level.prototype.s_fontFamily).style("font-size",25),this.m_barText.append("tspan").html(e).attr("fill",t.Level.prototype.s_palette.gold).style("font-family",t.Level.prototype.s_fontFamily).style("font-size",20),""!==i&&this.m_barText.append("tspan").html("&nbsp;"+i).attr("fill",this.m_panel.m_level.m_topicColors[i]).style("font-family",t.Level.prototype.s_fontFamily).style("font-size",21))}.bind(this.m_controlBar,e,i,s))}),t.DataBar.method("DrawMetaDataTiles",function(e,i,s,o){if(s>0){var a=new t.MetaDataTile({x:this.m_nextTilePos.x,y:this.m_nextTilePos.y},t.MetaDataTile.prototype.s_tileDims,"metadata_dist2avg",this.m_level,this,i.shapeRef,"Distance to Cluster Avg",s);this.m_nextTilePos.y+=t.MetaDataTile.prototype.s_tileDims.height+t.DataBar.prototype.s_elementSpacing,e+=t.MetaDataTile.prototype.s_tileDims.height+t.DataBar.prototype.s_elementSpacing,this.m_metaDataTiles.push(a),a.Draw(!0)}if(o>0){var a=new t.MetaDataTile({x:this.m_nextTilePos.x,y:this.m_nextTilePos.y},t.MetaDataTile.prototype.s_tileDims,"metadata_textcount",this.m_level,this,i.shapeRef,"Text Count",o);this.m_nextTilePos.y+=t.MetaDataTile.prototype.s_tileDims.height+t.DataBar.prototype.s_elementSpacing,e+=t.MetaDataTile.prototype.s_tileDims.height+t.DataBar.prototype.s_elementSpacing,this.m_metaDataTiles.push(a),a.Draw(!1)}return e}),t.DataBar.method("DrawTopicTiles",function(e,i){for(var s=Object.keys(i.shapeRef.m_fullTopicListRef).sort(function(t,e){return i.shapeRef.m_fullTopicListRef[t][1]-i.shapeRef.m_fullTopicListRef[e][1]}),o=[],a=s.length-1;a>=0;a--)o.push([s[a],i.shapeRef.m_fullTopicListRef[s[a]][1]]);for(var n=0,a=0;a<o.length;a++)this.m_topicDataTiles.push(new t.TopicTile({x:this.m_nextTilePos.x,y:this.m_nextTilePos.y},t.TopicTile.prototype.s_tileDims,"topic_"+o[a][0],this.m_level,this,i.shapeRef,o[a][0])),this.m_nextTilePos.y+=t.TopicTile.prototype.s_tileDims.height+t.DataBar.prototype.s_elementSpacing,e+=t.TopicTile.prototype.s_tileDims.height+t.DataBar.prototype.s_elementSpacing,n+=this.m_topicDataTiles[a].m_topicProportion;for(var a=0;a<o.length;a++)this.m_topicDataTiles[a].Draw(this.m_topicDataTiles[a].m_topicProportion/n);return e}),t.DataBar.method("DrawWordWeightTiles",function(e,i){for(var s=this.m_level.m_corpusWordWeights[i.topicID],o=Object.keys(s).sort(function(t,e){return s[t]-s[e]}),a=[],n=o.length-1;n>=0;n--)a.push([o[n],s[o[n]]]);for(var r=0,n=0;n<a.length;n++)this.m_wordWeightDataTiles.push(new t.WordWeightTile({x:this.m_nextTilePos.x,y:this.m_nextTilePos.y},t.WordWeightTile.prototype.s_tileDims,a[n][0],this.m_level,this,null,i.topicID,a[n][0],a[n][1])),this.m_nextTilePos.y+=t.WordWeightTile.prototype.s_tileDims.height+t.DataBar.prototype.s_elementSpacing,e+=t.WordWeightTile.prototype.s_tileDims.height+t.DataBar.prototype.s_elementSpacing,
r+=this.m_wordWeightDataTiles[n].m_value;for(var n=0;n<a.length;n++)this.m_wordWeightDataTiles[n].Draw(r);return e}),t.DataBar.method("GetCurrentShape",function(){return this.m_currentShape}),t.DataBar.method("Hide",function(e,i){var s=void 0===i?!0:i;if(e){this.m_recentDims={width:this.m_size.width,height:this.m_size.height+this.m_controlBar.m_size.height,extendedHeight:parseFloat(this.m_svg.attr("height"))},this.m_recentPos={x:parseFloat(this.m_container.m_div.style("left")),y:parseFloat(this.m_container.m_div.style("top"))};var o={position:{x:this.m_recentPos.x,y:this.m_recentPos.y},size:{width:t.Panel.prototype.s_minimumPanelSize,height:t.Control.prototype.s_defaultThickness},duration:500};this.ToggleResize(!0)}else{this.m_recentPos={x:parseFloat(this.m_container.m_div.style("left")),y:parseFloat(this.m_container.m_div.style("top"))};var o={position:{x:this.m_recentPos.x,y:this.m_recentPos.y},size:{width:this.m_recentDims.width,height:this.m_recentDims.height},duration:500};this.ToggleResize(!1)}this.m_hidden=e,this.m_hidden?this.AddBarText("",0,!0):this.AddBarText(this.m_controlBar.m_recentPanelTitle,this.m_controlBar.m_recentPanelID,!1),this.m_hidden?this.Move(o,"end",function(){s&&this.m_level.OrganizePanels(),this.m_controlBar.m_barPath.transition().duration(10).attr("d",t.FullyRoundedRect(this.m_coordinates.x,this.m_coordinates.y,this.m_container.m_size.width,t.Control.prototype.s_defaultThickness,t.Panel.prototype.s_borderRadius))}.bind(this),!this.m_hidden):(this.m_controlBar.m_barPath.attr("d",t.TopRoundedRect(this.m_coordinates.x,this.m_coordinates.y,this.m_container.m_size.width,t.Control.prototype.s_defaultThickness,t.Panel.prototype.s_borderRadius)),this.Move(o,"end",function(){-1==this.m_level.m_highlightedTopic?$(this.m_div[0][0]).scrollTop(0):$(this.m_div[0][0]).scrollTop(this.m_topicDataTiles[this.m_highlightIndex].m_coordinates.y),s&&this.m_level.OrganizePanels()}.bind(this),!this.m_hidden))}),t.DataBar.method("Move",function(e,i,s,o){e.position&&this.m_container.SetPosition(e.position),e.size&&this.m_container.SetSize(e.size),this.m_container.m_div.transition().duration(e.duration).style("left",this.m_container.m_coordinates.x).style("top",this.m_container.m_coordinates.y).style("width",this.m_container.m_size.width).style("height",this.m_container.m_size.height),this.m_div.transition().duration(e.duration).style("width",this.m_size.width).style("height",this.m_size.height-2).each("start",function(e,i,s,o){this.m_panelRectDiv.transition().duration(e.duration).style("width",e.size.width).style("height",e.size.height-this.m_controlBar.m_size.height-1),this.m_panelRectSvg.transition().duration(e.duration).attr("width",e.size.width).attr("height",(o?this.m_recentDims.extendedHeight:e.size.height)-this.m_controlBar.m_size.height).attr("viewBox","0 0 "+e.size.width+" "+((o?this.m_recentDims.extendedHeight:e.size.height)-this.m_controlBar.m_size.height)),this.m_panelRect.transition().duration(e.duration).attr("d",t.BottomRoundedRect(0,0,e.size.width,(o?this.m_recentDims.extendedHeight:e.size.height)-this.m_controlBar.m_size.height,t.Panel.prototype.s_borderRadius)).each("end",function(){"end"==i&&s()}.bind(this,i,s));var a=!1,n=this.m_size.width,r=(this.m_size.height,{width:this.m_minDims.width,height:this.m_minDims.height});n>this.m_minDims.width&&(r.width=n,a=!0),a&&this.m_svg.transition().duration(e.duration).attr("width",r.width).attr("height",r.height).attr("viewBox","0 0 "+r.width+" "+r.height);for(var l={size:{width:e.size.width-2*t.DataBar.prototype.s_elementSpacing},duration:e.duration},h=0;h<this.m_metaDataTiles.length;h++)this.m_metaDataTiles[h].ResizeOverTime(l);for(var h=0;h<this.m_topicDataTiles.length;h++)this.m_topicDataTiles[h].ResizeOverTime(l);"start"==i&&s()}.bind(this,e,i,s,o)),this.m_controlBar.m_size.width=this.m_size.width,this.m_controlBar.m_div.transition().duration(e.duration).style("width",this.m_size.width).each("start",function(t){this.m_controlBar.m_barPath.transition().duration(t.duration).attr("d",this.m_controlBar.GetRectPath()),this.m_controlBar.m_svg.transition().duration(t.duration).attr("width",this.m_size.width).attr("viewBox","0 0 "+this.m_size.width+" "+this.m_controlBar.m_size.height)}.bind(this,e)),this.m_highlightIndex>=0?($(this.m_div[0][0]).scrollTop(this.m_topicDataTiles[this.m_highlightIndex].m_coordinates.y),this.m_topicDataTiles[this.m_highlightIndex].HighlightTile(!0)):$(this.m_div[0][0]).scrollTop(0)}),t.DataBar.method("OnResize",function(e){var i=!0;void 0!==e&&(i=e);var s=parseFloat(this.m_container.m_div.style("width")),o=parseFloat(this.m_container.m_div.style("height")),a=this.m_controlBar?this.m_controlBar.m_size.height:0;this.m_controlBar&&(this.m_controlBar.m_size.width=s,this.m_controlBar.m_div.style("width",s),this.m_controlBar.m_svg.attr("width",s).attr("viewBox","0 0 "+s+" "+a)),this.m_size.width=Math.abs(s),this.m_size.height=Math.abs(o-a);var n=this.m_size.width,r=this.m_size.height;this.m_div.style("width",n).style("height",r);var l=!1,h={width:this.m_minDims.width,height:this.m_minDims.height};n>this.m_minDims.width&&(h.width=n,l=!0),l&&this.m_svg.attr("width",h.width).attr("height",h.height).attr("viewBox","0 0 "+h.width+" "+h.height);for(var m={size:{width:this.m_size.width-2*t.DataBar.prototype.s_elementSpacing},duration:5},p=0;p<this.m_metaDataTiles.length;p++)this.m_metaDataTiles[p].ResizeOverTime(m);for(var p=0;p<this.m_topicDataTiles.length;p++)this.m_topicDataTiles[p].ResizeOverTime(m);this.m_panelRectDiv.style("width",n).style("height",r+t.Panel.prototype.s_borderRadius),this.m_panelRectSvg.attr("width",n).attr("height",r+t.Panel.prototype.s_borderRadius).attr("viewBox","0 0 "+n+" "+(r+t.Panel.prototype.s_borderRadius)),s>parseInt(this.m_div.style("max-width"))&&(this.m_div.style("max-width",s),this.m_panelRectDiv.style("max-width",s)),o>parseInt(this.m_div.style("max-height")+a)&&(this.m_div.style("max-height",o-a),this.m_panelRectDiv.style("max-height",o-a)),this.m_panelRect.attr("d",t.BottomRoundedRect(0,0,n,r+t.Panel.prototype.s_borderRadius,t.Panel.prototype.s_borderRadius)),this.m_container.m_div.node().parentNode.appendChild(this.m_container.m_div.node()),i&&$(this.m_level.m_div[0]).packery(),this.m_controlBar&&this.m_controlBar.UpdateBarPath(this.m_controlBar.GetRectPath()),$(this.m_level.m_div.node().parentNode).hide().show(0)}),t.DataBar.prototype.s_datashapeClassName="databar_shape",t.DataBar.prototype.s_datashapeClassSelect=".databar_shape",t.DataBar.prototype.s_datashapeTextClassName="databar_shape_text",t.DataBar.prototype.s_datashapeTextClassSelect=".databar_shape_text",t.DataBar.prototype.s_defaultTitle="Information Panel",t.DataBar.prototype.s_elementSpacing=15,t}(TWiC||{});